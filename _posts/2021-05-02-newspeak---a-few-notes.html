---
date: 2021-05-02 12:51
author: mzimmerm
layout: post
title: Newspeak - a few notes
excerpt: Running, notes on Newspeak
tags: 
- newspeak
- programming
categories: 
- category-newspeak
- category-blog
- category-programming
---
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3d484da">1. This document: Introduction to Newspeak on Webassembly (Wasm)</a></li>
<li><a href="#orgb24b0d8">2. Changelog</a></li>
<li><a href="#orgef290a7">3. Notation</a>
<ul>
<li>
<ul>
<li><a href="#org19e5dd7">3.0.1. Message (function) names notation in text</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org10d1e85">4. Perhaps the best high level summary of Newspeak</a></li>
<li><a href="#org8b291c4">5. Newspeak: A quickstart.  Explore the IDE.  Then develop CounterApp, package it and deploy it</a>
<ul>
<li><a href="#org17c8680">5.1. Run the online version of the Newspeak IDE.  Read docs, watch videos</a></li>
<li><a href="#orgba53dc6">5.2. Build, run, and debug the CounterApp in Newspeak (in the online version)</a></li>
<li><a href="#org5383775">5.3. Download, install, and start a local Newspeak webserver</a></li>
<li><a href="#orgaadf932">5.4. Deploy CounterApp as standalone app into local Newspeak webserver</a></li>
</ul>
</li>
<li><a href="#org427a0ce">6. Newspeak is different.  An ide-driven journey around the Newspeak platform</a>
<ul>
<li><a href="#org6d24e33">6.1. Motivation of writing this journey</a></li>
<li><a href="#orgb4743ce">6.2. Dependencies and modularity: Perhaps the hardest part of Newspeak difference</a></li>
<li><a href="#org9c92a01">6.3. Starting the journey</a></li>
<li><a href="#orgb541611">6.4. Namespaces and Modules</a>
<ul>
<li><a href="#org3923d4e">6.4.1. Top level classes in the IDE</a></li>
<li><a href="#org6e890f7">6.4.2. Discussion of Modules</a></li>
<li><a href="#org982e2bc">6.4.3. Discussion of Namespaces</a></li>
<li><a href="#org2b1038d">6.4.4. Namespaces and existence of global namespace in the IDE</a></li>
</ul>
</li>
<li><a href="#orgcfab820">6.5. Class structure, factory constructors, platform and manifest, modules API</a>
<ul>
<li><a href="#org061e3a5">6.5.1. Section TL;DR:</a></li>
<li><a href="#org36553ab">6.5.2. Top level classes in the IDE - expanded</a></li>
<li><a href="#orge6745be">6.5.3. Newspeak class structure</a></li>
<li><a href="#org7c19284">6.5.4. Factory constructors</a></li>
<li><a href="#org853369e">6.5.5. The manifest object</a>
<ul>
<li><a href="#org5c57cbf">6.5.5.1. What is in the manifest object?</a></li>
<li><a href="#org66a7ed8">6.5.5.2. Why is the manifest object significant, and what role does it play in Newspeak?</a></li>
</ul>
</li>
<li><a href="#org953587a">6.5.6. The platform object</a>
<ul>
<li><a href="#org1594af0">6.5.6.1. What is in the platform object?</a></li>
<li><a href="#orge5a7812">6.5.6.2. Why is the platform object significant, and what role does it play in Newspeak?</a></li>
</ul>
</li>
<li><a href="#orgd13d91d">6.5.7. Common and distinct roles of platform and manifest in modules</a></li>
</ul>
</li>
<li><a href="#org4633bc8">6.6. Modules: Application, library, test, general</a>
<ul>
<li><a href="#org8a546aa">6.6.1. Application and library in computing</a></li>
<li><a href="#orgdefd475">6.6.2. Application and library API in computing</a></li>
<li><a href="#org4ee700c">6.6.3. Application and library modules in Newspeak</a></li>
<li><a href="#org98fdcd0">6.6.4. Newspeak modules API summary</a></li>
<li><a href="#org29bc453">6.6.5. Newspeak modules API zoo</a></li>
<li><a href="#org608a145">6.6.6. Newspeak platform and manifest objects summary</a></li>
</ul>
</li>
<li><a href="#org465e425">6.7. Newspeak recipy for writing modules API</a>
<ul>
<li>
<ul>
<li><a href="#orgd9476b0">6.7.0.1. 1. General module with NO dependencies: API of module with no dependencies</a>
<ul>
<li><a href="#org112593c">6.7.0.1.1. Example:</a></li>
</ul>
</li>
<li><a href="#org7062cfa">6.7.0.2. 2. General module with dependencies: API of module with dependencies</a>
<ul>
<li><a href="#org53a173a">6.7.0.2.1. Example:</a></li>
</ul>
</li>
<li><a href="#org0efa847">6.7.0.3. 3. Library module: API of module that needs to be distributed for use in other modules</a>
<ul>
<li><a href="#orgebc4316">6.7.0.3.1. Example:</a></li>
</ul>
</li>
<li><a href="#org818d945">6.7.0.4. 4. App module: API of module that needs to be distributed as an App</a>
<ul>
<li><a href="#org0292410">6.7.0.4.1. Example:</a></li>
</ul>
</li>
<li><a href="#orgb451316">6.7.0.5. <span class="todo TODO">TODO</span> 5. Test module: TODO</a></li>
<li><a href="#orgbc1116c">6.7.0.6. <span class="todo TODO">TODO</span> 6. Test module configuration: TODO</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3f7b274">6.8. Hello World in Newspeak</a>
<ul>
<li><a href="#org8047503">6.8.1. Section Summary</a></li>
<li><a href="#org9128238">6.8.2. 1. Hello World from Workspace</a></li>
<li><a href="#orgf5b8d03">6.8.3. 2. Hello World from general module</a></li>
<li><a href="#orgc4a4799">6.8.4. 3. Hello World App</a></li>
<li><a href="#org7bffa18">6.8.5. 4. Hello World App using 3rd party dependency</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc577a6a">7. Newspeak: Using it and installing it.  Online vs.  local installation</a>
<ul>
<li><a href="#orge001de9">7.1. Simple methods to install and run Newspeak</a>
<ul>
<li><a href="#org362edd2">7.1.1. Installation method 1: No installation or setup, run Newspeak online</a></li>
<li><a href="#org8609b11">7.1.2. Installation method 2: Download and start a local Newspeak webserver</a></li>
<li><a href="#org3c90d9c">7.1.3. Installation method 3: Download or setup a local Electron version of Newspeak on MacOS or Windows</a></li>
</ul>
</li>
<li><a href="#org28ccd5c">7.2. System specific methods to install and run Newspeak</a>
<ul>
<li><a href="#org68de2cb">7.2.1. Installation method 4: Setup a local Newspeak webserver from code on Github.</a></li>
<li><a href="#orgfde56e0">7.2.2. Installation method 5: Manual setup which will produce an equivalent of Installation method 2 (local Newspeak webserver)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2cdf4f7">8. <span class="todo IN_PROGRESS">IN-PROGRESS</span> Programming in Newspeak</a>
<ul>
<li><a href="#orgcd8c075">8.1. The Newspeak IDE</a>
<ul>
<li><a href="#org899c43c">8.1.1. Updating the IDE</a>
<ul>
<li><a href="#org2d7d91c">8.1.1.1. Updating the online version</a></li>
<li><a href="#org67c8205">8.1.1.2. Updating your local Newspeak webserver, installed for all platforms as shown in Installation method 2 (local Newspeak webserver).</a></li>
</ul>
</li>
<li><a href="#org2853966">8.1.2. Updading a single class that was fixed on Github source into local Newspeak webserver (thus IDE)</a></li>
</ul>
</li>
<li><a href="#orgafd7607">8.2. Saving changes in Newspeak</a>
<ul>
<li><a href="#org1aa0e14">8.2.1. Saving changes inside the browser</a></li>
<li><a href="#orga7e210e">8.2.2. Saving changes outside the browser:</a></li>
</ul>
</li>
<li><a href="#orga43a173">8.3. <span class="todo IN_PROGRESS_NOW">IN-PROGRESS-NOW</span> Snippets of wisdom from various sources</a></li>
</ul>
</li>
<li><a href="#orge701dcb">9. <span class="todo IN_PROGRESS">IN-PROGRESS</span> Q&amp;A - answers should be either here directly, or link to an earlier section</a>
<ul>
<li><a href="#org3c1c3d3">9.1. How do I save my changes?</a></li>
<li><a href="#org35d76b7">9.2. How would I build and deploy a Newspeak application?</a></li>
<li><a href="#orgd61b4a2">9.3. How do I bring dependencies into modules to be distributed?</a></li>
<li><a href="#org15a4f6c">9.4. When or why to refresh the online IDE?</a></li>
<li><a href="#org2400758">9.5. Why do some classes show the [deploy] [run] [debug[ links?</a></li>
<li><a href="#org9bf4124">9.6. Why do some test classes show the [run tests] [show tests] links?</a></li>
<li><a href="#org87db60b">9.7. How would I create and distribute a Newspeak App to run on the web, on mobile, or on desktop?</a></li>
<li><a href="#org080cbe2">9.8. How does Ampleforth work to create live literate Newspeak demos such as http://bracha.org/Literate/literate.html?</a></li>
<li><a href="#org66700fd">9.9. How does Newspeak displays itself in DOM and HTML?</a></li>
</ul>
</li>
<li><a href="#org2a458d6">10. The Newspeak UI, <code>HopscotchForHTML5</code>: Analysing it by digging though code; discovering <code>Subject</code> <code>Model</code> <code>Presenter</code> and <code>Fragment</code>; writing <code>CheckedItemApp</code> sample App with a UI app based on what we learned</a>
<ul>
<li><a href="#org4910947">10.1. If you wish to start at the end: Full code of HopscotchForHTML5 sample app</a></li>
<li><a href="#org9cfef77">10.2. Discovery of the <b>HopscotchForHTML5</b> class basics</a>
<ul>
<li><a href="#org701506c">10.2.1. Chapter goal</a></li>
<li><a href="#orgb71cfea">10.2.2. Chapter conclusion</a></li>
</ul>
</li>
<li><a href="#orgc85ff4d">10.3. The formulaic required repetitive methods of #isMyKind: and #isKindOfX</a></li>
<li><a href="#org3fbff6f">10.4. The <b>Subject</b> class: Factory constructor, instance methods, how Subject knows Presenter</a>
<ul>
<li><a href="#org95f479c">10.4.1. Chapter goal: Overview of the <b>Subject</b> class</a></li>
<li><a href="#orgc723230">10.4.2. The factory constructor <b>public class Subject onModel: aModel = (..)</b></a></li>
<li><a href="#orgfe0b0d0">10.4.3. The unimplemented (abstract) methods: <b>Subject&gt;&gt;#createPresenter</b> and <b>Subject&gt;&gt;#isMyKind: otherSubject</b></a>
<ul>
<li><a href="#orge556f34">10.4.3.1. The method <code>#Subject&gt;&gt;createPresenter</code> discovery from existing implementations</a></li>
</ul>
</li>
<li><a href="#orgebfc0c9">10.4.4. The method <b>Subject&gt;&gt;#presenter</b> creates the subject's presenter by calling the <b>Subject&gt;&gt;#createPresenter</b>, then associate the instances</a>
<ul>
<li><a href="#org2b9d4ac">10.4.4.1. Chapter goal</a></li>
<li><a href="#org801c63a">10.4.4.2. Where is Subject -&gt; Presenter association created? In <b>Subject&gt;&gt;#presenter</b></a></li>
<li><a href="#org40671b6">10.4.4.3. Where is Presenter -&gt; Subject association created? In the Presenter factory constructor <b>Presenter&gt;&gt;#class Presenter onSubject: aSubject = Fragment</b></a></li>
</ul>
</li>
<li><a href="#org42e82ed">10.4.5. Chapter conclusion about principles of writing rudimentary Hopscotch UI</a></li>
</ul>
</li>
<li><a href="#orge00d8b1">10.5. The <b>Presenter</b> class: Factory constructor, instance methods, how Presenter knows Subject</a>
<ul>
<li><a href="#org89011f5">10.5.1. Chapter goal: Overview of the <b>Presenter</b> class</a></li>
<li><a href="#org14dbdd3">10.5.2. The factory constructor <b>class Presenter onSubject: aSubject = Fragment (..)</b></a></li>
<li><a href="#org557a928">10.5.3. The unimplemented (abstract) methods: <b>Presenter&gt;&gt;#definition</b> and <b>Presenter&gt;&gt;#isMyKind: fragment</b></a>
<ul>
<li><a href="#org93e4f08">10.5.3.1. The method <b>Presenter&gt;&gt;#definition</b> - provides the UI view</a></li>
</ul>
</li>
<li><a href="#org39267e9">10.5.4. Instance methods on Presenter that create instances of Fragments</a></li>
<li><a href="#orgc4a7a1a">10.5.5. Presenter extends Fragment</a></li>
</ul>
</li>
<li><a href="#orgaf78778">10.6. The <b>Fragment</b> class</a></li>
<li><a href="#org7cbf877">10.7. Summary of <b>Subject</b> and it's model, <b>Presenter</b> and <b>Fragment</b>, their associations, and their lifecycle</a></li>
<li><a href="#orgefdb0e8">10.8. Back to <b>HopscotchForHTML5</b> and how it relates to <b>HopscotchForHTML5Runtime</b></a>
<ul>
<li><a href="#org4d11815">10.8.1. Chapter goal</a></li>
<li><a href="#orga02c8f9">10.8.2. The <b>HopscotchForHTML5</b> class</a></li>
<li><a href="#orgf718780">10.8.3. The <b>HopscotchForHTML5Runtime</b> class</a></li>
</ul>
</li>
<li><a href="#orgb3a4bfa">10.9. Using chapters above to write a simple Hopscotch UI App, the <b>CheckedItemApp</b></a>
<ul>
<li><a href="#org053d6d0">10.9.1. Chapter goal</a></li>
<li><a href="#org7ebbfcc">10.9.2. 1. Start coding the Application class <b>CheckedItemApp</b></a></li>
<li><a href="#orgc9ffbf8">10.9.3. 2. Add code to the <b>CheckedItemApp</b> which allows to "import" the Hopscotch module</a>
<ul>
<li><a href="#orgcffb4da">10.9.3.1. Add the packaging of the HopscotchForHTML5 module</a></li>
<li><a href="#org5d457b0">10.9.3.2. Add the hopscotchForHTML5 module that will allow us to build UI</a></li>
</ul>
</li>
<li><a href="#orged2b03b">10.9.4. 3. Write code for <b>CheckedItemUI</b>, the class showing the UI</a>
<ul>
<li><a href="#org8ea8a77">10.9.4.1. Class CheckedItemUI</a></li>
<li><a href="#orgdfadd5b">10.9.4.2. Class CheckedItemModel</a></li>
<li><a href="#orga25db13">10.9.4.3. Class CheckedItemSubject</a></li>
<li><a href="#orgfd0c34f">10.9.4.4. Class CheckedItemPresenter</a></li>
</ul>
</li>
<li><a href="#org519e122">10.9.5. 4. Integrate the <b>CheckedItemUI</b> into the <b>CheckedItemApp</b></a>
<ul>
<li><a href="#org81fc064">10.9.5.1. Package the <b>CheckedItemUI</b> class into the <b>CheckedItemApp</b></a></li>
<li><a href="#org74ed277">10.9.5.2. When the app runs in the <b>#main:args:</b> method, instantiate the <b>CheckedItemUI</b></a>
<ul>
<li><a href="#org5708783">10.9.5.2.1. Why did we added the line calling factory constructor of CheckedItemUI? Also, this leads to a change in CheckedItemUI.</a></li>
<li><a href="#orge9a6caa">10.9.5.2.2. What are the lines at the of <b>#main:args</b>?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org7661033">10.9.6. 5. Complete code and UI of the <b>CheckedItemApp</b></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6c58fab">11. Some of the more boring details</a>
<ul>
<li><a href="#org56fb847">11.1. HopscotchForHTML5: Analyzing senders of <b>Subject&gt;&gt;#presenter</b> and why <b>HopscotchWindow&gt;&gt;#openSubject: subject</b> should be invoked instead</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org3d484da" class="outline-2">
<h2 id="org3d484da"><span class="section-number-2">1</span> This document: Introduction to Newspeak on Webassembly (Wasm)</h2>
<div class="outline-text-2" id="text-1">
<p>
TL;DR: Newspeak is a modern, principled platform and language: dynamic, reflective, modular.  It supports both object-oriented and functional styles.  But having reached here, you probably already know that much.  The purpose of this document is to help starting with Newspeak version 3 (year 2021, runs on Webassembly).  Hopefully reduce reader's start time a bit.
</p>

<p>
Much of this document is collected from existing Newspeak sources:
</p>

<ul class="org-ul">
<li>The Newspeak google groups posts at <a href="https://groups.google.com/g/newspeaklanguage">https://groups.google.com/g/newspeaklanguage</a></li>
<li>The Newspeak core site at <a href="https://newspeaklanguage.org/">https://newspeaklanguage.org/</a></li>
<li>Gilad Bracha's Room 101 blog at <a href="https://gbracha.blogspot.com/">https://gbracha.blogspot.com/</a></li>
</ul>
</div>
</div>


<div id="outline-container-orgb24b0d8" class="outline-2">
<h2 id="orgb24b0d8"><span class="section-number-2">2</span> Changelog</h2>
<div class="outline-text-2" id="text-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Date</th>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">Author</th>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">Change</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2021-05-02</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Gilad Bracha</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Important clarifications and help throughout the document</td>
</tr>

<tr>
<td class="org-right">2021-05-04</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Milan Zimmermann</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Expanded on using the Newspeak IDE, mostly in the section <a href="#org17c8680">5.1</a></td>
</tr>

<tr>
<td class="org-right">2021-06-07</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Milan Zimmermann</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Wording changes and clarifications in several sections</td>
</tr>

<tr>
<td class="org-right">2021-07-05</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Milan Zimmermann</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Reworked the saving paragraph:  "lastSaved" vs "backup" in <a href="#orgafd7607">8.2</a></td>
</tr>

<tr>
<td class="org-right">2021-07-16</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Milan Zimmermann</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Added section <a href="#org427a0ce">Newspeak is different.  An ide-driven journey around the Newspeak platform</a></td>
</tr>

<tr>
<td class="org-right">2021-07-28</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Milan Zimmermann</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Added sections <a href="#org080cbe2">How does Ampleforth work to create live literate Newspeak demos such as http://bracha.org/Literate/literate.html?</a> and <a href="#org66700fd">How does Newspeak displays itself in DOM and HTML?</a></td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-orgef290a7" class="outline-2">
<h2 id="orgef290a7"><span class="section-number-2">3</span> Notation</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org19e5dd7" class="outline-4">
<h4 id="org19e5dd7"><span class="section-number-4">3.0.1</span> Message (function) names notation in text</h4>
<div class="outline-text-4" id="text-3-0-1">
<p>
We needed a brief introduction to explain a notation used in this document.
</p>

<p>
Newspeak is a class based, message based system.  All runtime operations are message sends (method calls).
</p>

<p>
What do we mean by a 'message'?  Think of it as a method or function name with parameter names (method signature). 
What do we mean by a 'message send'? T hink of it as calling (invoking) the method or function
</p>

<p>
In fact, we may use 'method name' and 'message name' interchangeably, although it is not quite precise.  Same for 'send a message' and 'call (or invoke) a method'
</p>

<p>
Here is the notation we want to introduce: When you see in text, something like <code>Rectangle &gt;&gt; #initWidth: width andHeight: height</code>, it means: "class <i>Rectangle</i> has a method named <i>initWith:andHeight</i>, with first parameter name <i>width</i> and second parameter name <i>height</i>".  If you see just <code>#initWidth: width andHeight: height</code> it means the same, but we assume the class name "Rectangle" is clear from context.  Depending on context, it could also mean "in some piece of code, we called method  <code>#initWidth: width andHeight: height</code> on an instance of a Rectangle.
</p>

<p>
Sometimes the parameter names are not included and we shorten the signature to <code>#initWidth:andHeight:</code>
</p>

<p>
Examples:
</p>
<ul class="org-ul">
<li><code>#main: platform args: args</code></li>
<li><code>#usingPlatform: platform</code></li>
</ul>
</div>
</div>
</div>


<div id="outline-container-org10d1e85" class="outline-2">
<h2 id="org10d1e85"><span class="section-number-2">4</span> Perhaps the best high level summary of Newspeak</h2>
<div class="outline-text-2" id="text-4">
<p>
For me it is this article's summary is perhaps the best high level summary of Newspeak:  <a href="https://bracha.org/newspeak-modules.pdf">Modules as Objects in Newspeak</a>. Let me paste it here removing references that would not make sense in another context:
</p>

<p>
<i>Like Self, all computation - even an object's own access to its internal structure  is performed by invoking methods on objects. Newspeak is class-based. Classes can be nested arbitrarily. Since all names denote method invocations, all classes are virtual; in particular, superclasses are virtual, so all classes act as mixins. Unlike its predecessors, there is no static state in Newspeak, nor is there a global namespace. Modularity in Newspeak is based exclusively on class nesting. There are no separate modularity constructs such as packages. Top level classes act as module definitions, which are independent, immutable, self-contained parametric namespaces. They can be instantiated into modules which may be stateful and mutually recursive.</i>
</p>

<p>
This is a beautiful summary. But it is also not easy to "visualize" how is this tranfered to practice in Newspeak.
</p>

<p>
This document is both a personal experience of learning Newspeak, an an attempt of making sense of the practical ways the above text means for a Newspeak user.
</p>
</div>
</div>



<div id="outline-container-org8b291c4" class="outline-2">
<h2 id="org8b291c4"><span class="section-number-2">5</span> Newspeak: A quickstart.  Explore the IDE.  Then develop CounterApp, package it and deploy it</h2>
<div class="outline-text-2" id="text-5">
<p>
TL;DR: This quickstart section attempts to provide an incremental introduction to Newspeak.  First, we introduce the Newspeak online IDE, then we build and deploy a sample Newspeak app called <code>CounterApp</code>.  A spoiler: we can look ahead and run the app we will be building - the <code>CounterApp</code> - online at <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=CounterApp.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=CounterApp.vfuel</a>. 
</p>
</div>

<div id="outline-container-org17c8680" class="outline-3">
<h3 id="org17c8680"><span class="section-number-3">5.1</span> Run the online version of the Newspeak IDE.  Read docs, watch videos</h3>
<div class="outline-text-3" id="text-5-1">
<p>
TL;DR: This section introduces the online version of Newspeak IDE, and how to use it.
</p>

<p>
This is a brief section.  Starting with Newspeak is easy.  We just point the browser to <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a>.
</p>

<p>
In more detail, let us try the following:
</p>

<ul class="org-ul">
<li>Action: In a new browser tab, open the Newspeak online IDE at <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a></li>
<li>Result: The Newspeak IDE opens, similar to
<img src="/img/newspeak---a-few-notes.org-newspeak-ide-start.png" alt="nil"/></li>
<li>Action: To edit source code: Click the "Newspeak Source" link
<img src="/img/newspeak---a-few-notes.org-go-to-newspeak-source.png" alt="nil"/></li>
<li>Result: A new page opens, showing Newspeak classes, similar to
<img src="/img/newspeak---a-few-notes.org-newspeak-source.png" alt="nil"/></li>
<li>Note: The blue links are classes.  To view, or change them, click the class link</li>
<li>Action: Click the "+" beside the "Root" to add a class.</li>
<li>Result: A class editor opens, with a template of a new class definition.  At first, let's just create a dummy class by editing the template
<img src="/img/newspeak---a-few-notes.org-newspeak-source-defining-a-new-class.png" alt="nil"/></li>
<li>Action: Click the checkbox on the top right <img src="/img/newspeak---a-few-notes.org-accept-image.png" alt="nil"/> to "Accept" the new class definition.  Note: Clicking the "Accept" button is important.  If you make any code changes, or workspace code changes, do not forget to click "Accept", otherwise your changes will be lost immediately after moving away from the source editing page.  See the discussions in <a href="#orgafd7607">Chapter Saving changes in Newspeak</a>.</li>

<li>Result: The class now appears in the list of classes (may need to scroll down, classes are sorted alphabetically)
<img src="/img/newspeak---a-few-notes.org-my-new-class-now-added.png" alt="nil"/></li>
<li>Action: Return back to the main page by pressing the browser "Back" button, to get back to
<img src="/img/newspeak---a-few-notes.org-newspeak-ide-start.png" alt="nil"/></li>
<li>To run some Newspeak expressions, click the "Workspaces" link
<img src="/img/newspeak---a-few-notes.org-go-to-workspaces.png" alt="nil"/>
<ul class="org-ul">
<li>Result: A new page opens, similar to
<img src="/img/newspeak---a-few-notes.org-workspaces.png" alt="nil"/></li>
</ul></li>
<li>To run some simple one-liner code, type for example "1+2" into the text field, and press keyboard <b>Shift + ENTER</b>.  This will evaluate the expression and print a result "3"
<ul class="org-ul">
<li>Result: expression "1+2" was evaluated to "3"
<img src="/img/newspeak---a-few-notes.org-workspaces-expression.png" alt="nil"/></li>
</ul></li>
<li>To run multi-line Newspeak code, type the code line by line.  Press keyboard <b>ENTER</b> to open new lines.  When ready to run the code, <b>highlight all lines, then press keyboard Shift + ENTER</b> to run the code.  Another term for running code like this, is "evaluating all highlighted lines").  The image below shows the Workspace after the <b>Shift + ENTER</b> was pressed, showing the evaluated code, and the result of the evaluated code: <code>2</code>.
<img src="/img/newspeak---a-few-notes.org-workspaces-multiline-expression.png" alt="nil"/>
<ul class="org-ul">
<li>The image above uses a white-mode image, as the dark-mode pages do not show highlight too well.</li>
<li>When running multi-line code, we can paste it from outside, instead of typing it.</li>
</ul></li>
<li>To save our changes "now", click the diskette "Save" button <img src="/img/newspeak---a-few-notes.org-save-button.png" alt="nil"/>.  The changes are saved in the browser local storage.  See Notes below for discussion on the details.</li>
</ul>

<p>
Notes:
</p>

<ul class="org-ul">
<li>We are now using Newspeak, in its full power.</li>
<li>The browser tab opened on <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a> IS the Newspeak live IDE.</li>
<li>Everything we do in the IDE is alive, changes and actions have immediate responses in the running system.</li>
</ul>


<p>
Saving your changes:
</p>

<p>
<b>Any changes we make (for example: we add a class, we change a class, evaluate something in the workspace) are stored in the browser local storage in two entries: "lastSaved" and "backup".</b> The "Accept" button <img src="/img/newspeak---a-few-notes.org-accept-image.png" alt="nil"/> saves the changes in local storage under the key "backup", while the "Save" button <img src="/img/newspeak---a-few-notes.org-save-button.png" alt="nil"/>, saves the changes under the key "lastSaved".  See <a href="#orgafd7607">Chapter Saving changes in Newspeak</a> for details.
</p>

<p>
Documentation:
</p>

<ul class="org-ul">
<li>Some selected documentation sites and videos:
<ul class="org-ul">
<li>The core site for all Newspeak is <a href="https://newspeaklanguage.org/">https://newspeaklanguage.org/</a>.  It has <b>papers, talks, demos, and repo links.</b></li>
<li>A great start would be the last 2 videos on the "talks" tab <a href="https://newspeaklanguage.org/talks.html">https://newspeaklanguage.org/talks.html</a>
<ul class="org-ul">
<li>Live IDEs in the Web Browser: What's Holding Us Back - <a href="https://youtu.be/CJX_6B24Hho">https://youtu.be/CJX_6B24Hho</a></li>
<li>What is a Live Programming System? - <a href="https://youtu.be/VUfZ1sL4aps">https://youtu.be/VUfZ1sL4aps</a></li>
</ul></li>
</ul></li>
</ul>

<p>
Summary:
</p>

<ul class="org-ul">
<li>This section showed the simplest way of starting with Newspeak - we just point the browser to <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a> and start using it.
<ul class="org-ul">
<li>In "Workspaces", we can experiment with Newspeak expressions, or snippets of code.</li>
<li>In "Newspeak Source", we can experiment with adding Newspeak classes, or creating a Newspeak app, such as the app created in the next section.</li>
</ul></li>
</ul>

<p>
Potential "gotchas":
</p>

<ul class="org-ul">
<li>If you make code changes, do not forget to click the "Accept" button <img src="/img/newspeak---a-few-notes.org-accept-image.png" alt="nil"/>.  Otherwise your changes will be lost immediately after moving away from the source editing page.</li>
<li>What is the difference between The "Save" button <img src="/img/newspeak---a-few-notes.org-save-button.png" alt="nil"/>, and the "Accept" button <img src="/img/newspeak---a-few-notes.org-accept-image.png" alt="nil"/>? 
<ul class="org-ul">
<li>The "Accept" button is needed to save your changes beyond moving away from the editor.  For example, if you make a change to a class method, and do not click "Accept", your changes will be lost after pressing the browser "Back" button, browser "Reload" - generally any state changes.</li>
</ul></li>
</ul>

<p>
Next:
</p>

<p>
In the next section <a href="#orgba53dc6">5.2</a>, we show how to create a simple <code>CounterApp</code> in Newspeak.
</p>
</div>
</div>


<div id="outline-container-orgba53dc6" class="outline-3">
<h3 id="orgba53dc6"><span class="section-number-3">5.2</span> Build, run, and debug the CounterApp in Newspeak (in the online version)</h3>
<div class="outline-text-3" id="text-5-2">
<p>
TL;DR: This section describes 
</p>

<ul class="org-ul">
<li>How to create, run and debug a Newspeak app (<code>CounterApp</code>) in development mode, in the <b>online</b> Newspeak IDE.  To concentrate on the IDE handling applications, we use pre-existing code for the <code>CounterApp</code>.</li>
</ul>

<p>
Prerequisites:
</p>

<ul class="org-ul">
<li>We should write code of the <code>CounterApp</code>.  However, for us to skip any implementation details and concentrate on the IDE, in this section, we will simply borrow the code.  The code of the <code>CounterApp</code> already exists - in the Newspeak github repo at <a href="https://github.com/newspeaklanguage/newspeak">https://github.com/newspeaklanguage/newspeak</a>.  We borrow it without talking about Newspeak code until later.  To fulfill the prerequisite, do one of the following:
<ul class="org-ul">
<li>Clone the newspeak repo locally and find two files, <code>CounterApp.ns</code> and <code>CounterUI.ns</code> from there.</li>
<li>Alternatively, download the files <code>CounterApp.ns</code> and <code>CounterUI.ns</code> from Github to the local filesystem.  To do that, just click <a href="https://raw.githubusercontent.com/newspeaklanguage/newspeak/master/CounterUI.ns">https://raw.githubusercontent.com/newspeaklanguage/newspeak/master/CounterUI.ns</a>, then <a href="https://raw.githubusercontent.com/newspeaklanguage/newspeak/master/CounterApp.ns">https://raw.githubusercontent.com/newspeaklanguage/newspeak/master/CounterApp.ns</a>, then right-click and select "Save as&#x2026;" to save each file.</li>
<li>Either way, note the location of the two files.</li>
</ul></li>
</ul>


<p>
Notes: 
</p>

<ul class="org-ul">
<li>To deploy the <code>CounterApp</code>, this section uses the online Newspeak at <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a></li>
<li>However, a local Newspeak webserver could be used instead.
<ul class="org-ul">
<li>If we wanted to deploy the <code>CounterApp</code> in "production", we would need a local Newspeak - because there is no way to deploy the app to the online Newspeak site.</li>
<li>Deployment of the  <code>CounterApp</code> to "production" requires our "own" Newspeak, such as the local Newspeak webserver.  See <a href="#org5383775">5.3</a> for how to install Newspeak locally.</li>
</ul></li>
<li>We may ask, "what is an app in Newspeak"? In a nutshell, an "app" is an instance of a class - obviously.  But which class, and what does the class need, to be able to "live" or "run" inside a Newspeak IDE or Newspeak runtime? Read on for details (actually, the coding details are todo).</li>
</ul>

<p>
<b>Steps: To create and run the <code>CounterApp</code> (from existing code that we borrow from Newspeak Github), follow the Action/Result steps below:</b>
</p>

<ul class="org-ul">
<li>Action: In a new browser tab, open the online Newspeak IDE at <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a></li>
<li>Result: The Newspeak IDE opens, similar to <img src="/img/newspeak---a-few-notes.org-newspeak-ide-start.png" alt="nil"/>
<ul class="org-ul">
<li>Note: The "Did you know" section is a ever-changing hint system</li>
</ul></li>
<li>Action: Click "Newspeak Source" in <img src="/img/newspeak---a-few-notes.org-go-to-newspeak-source.png" alt="nil"/></li>
<li>Result: A new page opens, showing Newspeak classes, similar to <img src="/img/newspeak---a-few-notes.org-newspeak-source.png" alt="nil"/>
<ul class="org-ul">
<li>Note on the result: In the result, you should NOT see classes named <code>CounterApp</code> or <code>CounterUI</code>.  If you do, you have most likely run through this tutorial before, and the classes are already in your browser local storage.  To clean any local changes saved locally for the online Newspeak, you can clean them in the browser local storage.  See</li>
</ul></li>
<li><b>Motivation for the next action: We want to build the sample app <code>CounterApp</code>.  We choose to build it simply by downloading and compiling two files from the existing source from the Newspeak github repo.</b></li>
<li>Action:  <a id="org151c9f3"></a> In the top right of the page (in the same line where we see "Root +") <img src="/img/newspeak---a-few-notes.org-3-vertical-dots.png" alt="nil"/>, click the <b>vertical 3-dot</b> button on the far right.</li>
<li>Result: A popup  <img src="/img/newspeak---a-few-notes.org-compile-files.png" alt="nil"/> shows</li>

<li>Action: Click "Compile File(s)".  This will ask us to select files stored on disk, and compile them.</li>
<li>Result: OS file browser opens, and ask us to select files in the operating system file browser.</li>
<li>Action: Navigate to the directory where we checked out the Newspeak github repo, OR where we saved the source for the <code>.ns</code> files (see Prerequisites of this section).  Select <code>CounterApp.ns</code> and <code>CounterUI.ns</code></li>
<li>Result: <b>The classes from the selected <code>.ns</code> files compile, and show in your IDE.</b> In your class list (the list under Root +), you should now see a section similar to this <img src="/img/newspeak---a-few-notes.org-counter-classes.png" alt="nil"/>
<ul class="org-ul">
<li>Note 1: We have loaded the code of the  <code>CounterApp.ns</code> and
<code>CounterUI.ns</code> classes into Newspeak by running "Compile
file".  Alternatively, we could have added the classes through the IDE by
clicking the "+" button
<img src="/img/newspeak---a-few-notes.org-root-plus-button.png" alt="nil"/> and typing or pasting the code in.
Instead, we choose to load pre-existing files at the moment to concentrate on the process, not the code.</li>
<li>Note 2: click the <code>CounterApp</code> or <code>CounterUI</code> link.  This shows the corresponding class.</li>
<li>Note 3: The <code>CounterApp</code> shows links to <code>[deploy] [configuration] [run] [debug]</code>.  Why do only the "app" classes such as <code>CounterApp</code> (and no other classes) show the <code>[deploy] [configuration] [run] [debug]</code> links in the Newspeak IDE? The IDE decides to show those links based on the presence of a convention method <code>#packageUsing: manifest</code>.  See <a href="#org98fdcd0">Newspeak modules API summary</a> for what makes a module an App, a Library, or a Test Configuration, and how the IDE handles the API.</li>
</ul></li>
<li>Action: To save the classes we added, (<code>CounterApp</code> or <code>CounterUI</code>) in the browser local storage explicitly "now", click the diskette "Save" button <img src="/img/newspeak---a-few-notes.org-save-button.png" alt="nil"/></li>
<li>Result: The two classes are stored in the browser local storage.  To read more about details of the browser local storage, see <a href="#orgafd7607">Chapter Saving changes in Newspeak</a>.</li>
<li>Action: click the <b>[run]</b> link beside the  <code>CounterApp</code>.  This runs the code in the app (specifically, the <code>CounterUI</code> code).</li>
<li>Result: The counter app opens and runs in the same browser tab; it should look like this:  <img src="/img/newspeak---a-few-notes.org-counter-app-running.png" alt="nil"/> The code presents a counter (integer), and 3 buttons, which actions are to "increment", "decrement" and "reset" the counter.</li>
<li>Action: click "increment"</li>
<li>Result: counter increments by one.</li>
<li>Note: We can click [debug] instead of [run] and a debugger will open.</li>
</ul>

<p>
Summary: 
</p>

<ul class="org-ul">
<li>We have shown how to build, run, and debug, a Newspeak app <code>CounterApp</code> in "development mode", inside the online Newspeak IDE.</li>
<li>Newspeak online is similar to (but we dare say superior to) running, in "development mode", a Java, Android or Flutter application in IntelliJ, Eclipse, Visual Studio, Atom, Emacs, vi, or any IDE.</li>
<li>Your changes are always stored, as long as you "Accept".  See <a href="#orgafd7607">Chapter Saving changes in Newspeak</a> for saving changes details.</li>
</ul>

<p>
Next: 
</p>

<ul class="org-ul">
<li>Let's pretend the CounterApp is useful, usable, and production ready.</li>
<li>How do we deploy it for us to use it as a browser app "in production mode"? Read the <a href="#orgaadf932">Chapter Deploy CounterApp as standalone app into local Newspeak webserver</a> section.</li>
</ul>
</div>
</div>


<div id="outline-container-org5383775" class="outline-3">
<h3 id="org5383775"><span class="section-number-3">5.3</span> Download, install, and start a local Newspeak webserver</h3>
<div class="outline-text-3" id="text-5-3">
<p>
TL;DR: This section describes:
</p>

<ul class="org-ul">
<li>How to download, install, and start a <b>local Newspeak webserver</b>.</li>
<li>How opening a browser tab at <a href="http://localhost:8080/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">http://localhost:8080/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a> runs the local version of the Newspeak IDE (reaching the just installed local Newspeak webserver).</li>
</ul>

<p>
Prerequisites: 
</p>

<ul class="org-ul">
<li>Python is installed on your system.  This is needed for the <code>serve.sh</code> script to run an HTTP server.</li>
</ul>

<p>
Notes: 
</p>

<ul class="org-ul">
<li>You can use a server of your choice instead of the Python server needed by <code>serve.sh</code>.  Just place all the files downloaded in the sections below to your server's serving directory.</li>
<li>You can potentially skip this section.  However, if you want to deploy a Newspeak app such as the <code>CounterApp</code>, this section is needed.</li>
</ul>

<p>
<b>Action steps to download, install, and start using a local Newspeak webserver</b>
</p>

<ul class="org-ul">
<li>First, you may want to review the Newspeak downloads page at <a href="https://newspeaklanguage.org/downloads.html">https://newspeaklanguage.org/downloads.html</a>, in particular the <b>For all platforms</b> link.</li>
<li>Next, to install and start a local Newspeak webserver, you can 
<ul class="org-ul">
<li>Either download and unzip the file <b>servable.zip</b> from the link above (<a href="https://github.com/newspeaklanguage/newspeaklanguage.github.io/raw/master/servable.zip">https://github.com/newspeaklanguage/newspeaklanguage.github.io/raw/master/servable.zip</a>) to any directory, then start the Newspeak server by running <code>serve.sh</code> from the extracted file.</li>
<li><p>
Or run the following commands from the command line 
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #fcaf3e;">MY_SERVE_NEWSPEAK</span>=$<span style="color: #fcaf3e;">HOME</span>/software/newspeak/my-serve-http
mkdir --parent $<span style="color: #fcaf3e;">MY_SERVE_NEWSPEAK</span> || <span style="color: #e090d7;">echo</span> Unable to create directory $<span style="color: #fcaf3e;">MY_SERVE_NEWSPEAK</span> 
<span style="color: #e090d7;">cd</span> $<span style="color: #fcaf3e;">MY_SERVE_NEWSPEAK</span>
curl --location https://github.com/newspeaklanguage/newspeaklanguage.github.io/raw/master/servable.zip --output $<span style="color: #fcaf3e;">MY_SERVE_NEWSPEAK</span>/servable.zip
unzip -o servable.zip

<span style="color: #73d216;"># </span><span style="color: #73d216;">The directory just above "servable" must be the directory</span>
<span style="color: #73d216;"># </span><span style="color: #73d216;">where we saved the zip file, see above.</span>

<span style="color: #e090d7;">cd</span> servable
<span style="color: #73d216;"># </span><span style="color: #73d216;">Make serve.sh executable, and start the Newspeak local server.</span>
chmod u+x serve.sh
./serve.sh
</pre>
</div></li>
</ul></li>
<li>Expected Result: "serving at port 8080".  Note: In <b>servable.zip</b> there is a file <code>server.py</code>, which defines the Newspeak server port.  The port is set to 8080.  Edit the file and change port if needed.</li>
</ul>


<p>
To use the local Newspeak webserver, navigate browser to <a href="http://localhost:8080/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">http://localhost:8080/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a>.  This should open the locally hosted Newspeak IDE, started using the <code>./serve.sh</code> command. 
</p>

<p>
Your browser should show a page similar to 
  <img src="/img/newspeak---a-few-notes.org-local-ide.png" alt="nil"/>
</p>

<p>
Note: The use of the local version is the same as the use of the online version.  We can now start editing Newspeak code by clicking on the "Newspeak Source" link.
</p>

<p>
Summary: 
</p>

<ul class="org-ul">
<li>In this section we installed the local Newspeak webserver, and started using the served Newspeak IDE.</li>
<li>The installation method described here is the <a href="#org541fe06">Installation method 2 (local Newspeak webserver)</a></li>
</ul>

<p>
Next: <a href="#orgaadf932">Chapter Deploy <code>CounterApp</code> as standalone app into local Newspeak webserver</a>
</p>
</div>
</div>


<div id="outline-container-orgaadf932" class="outline-3">
<h3 id="orgaadf932"><span class="section-number-3">5.4</span> Deploy CounterApp as standalone app into local Newspeak webserver</h3>
<div class="outline-text-3" id="text-5-4">
<p>
TL;DR: This section describes 
</p>

<ul class="org-ul">
<li>How to create and deploy the <code>CounterApp</code> into the local version of Newspeak.</li>
<li>That the deployment is achieved by creating a deployable file, <code>CounterApp.vfuel</code>, in the online Newspeak at <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a> and placing it in the running local Newspeak webserver.</li>
<li>How to run the <code>CounterApp</code> from the local Newspeak webserver, by accessing the  <code>CounterApp.vfuel</code> from the local HTTP server.</li>
</ul>

<p>
Prerequisites: 
</p>

<ol class="org-ol">
<li>We have followed the online section <a href="#orgba53dc6">5.2</a>.  In that section, we have downloaded (from Newspeak Github) and compiled two classes <code>CounterApp</code> and <code>CounterUI</code> <b>while attached to the online Newspeak</b>.
<ul class="org-ul">
<li>This statement requires a "fine point" explanation. 
<ul class="org-ul">
<li>In the earlier section  <a href="#orgba53dc6">5.2</a>, the two classes, <code>CounterApp</code> and <code>CounterUI</code>, were saved to the browser local storage.</li>
<li>In this current section, we re-attach to online Newspeak at <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a>.</li>
<li>As explained in <a href="#orgafd7607">Chapter Saving changes in Newspeak</a>, the changes we made in the online version are still stored locally in the browser local storage.</li>
<li>So, when we re-attach to online Newspeak in this section, the classes <code>CounterApp</code> and <code>CounterUI</code> are still available.  We use them to "create the CounterApp" (by saving it "as victory fuels" - that is, as file <code>CounterApp.vfuel</code>) which is the app.</li>
<li>This app - the  file <code>CounterApp.vfuel</code> - can then be copied to the serving directory of local Newspeak, and can be opened from there.</li>
</ul></li>
</ul></li>
<li>We have installed the local version of Newspeak by following the section <a href="#org5383775">5.3</a>.*</li>
</ol>


<p>
Notes: 
</p>

<ul class="org-ul">
<li>We will create the deployable file, <code>CounterApp.vfuel</code> using the online Newspeak at <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a></li>
<li><b>However, apps can NOT be deployed to the online version, since that would require write access to the newspeak web site.  We can do the coding and create the deployable .vfuel file online (as described above), but the actual deployment and running of the standalone app has to be done in a Newspeak webserver we control.  We will show how to create a standalone local Newspeak webserver just a bit later.</b></li>
<li>We will deploy the deployable file with the standalone <code>CounterApp.vfuel</code>, into the local Newspeak webserver as  <a href="http://localhost:8080/primordialsoup.html?snapshot=CounterApp.vfuel">http://localhost:8080/primordialsoup.html?snapshot=CounterApp.vfuel</a>. (this link will only work when we finish all steps in this section)</li>
</ul>

<p>
One more "fine point" note:
</p>

<ul class="org-ul">
<li>This flipping between the online Newspeak and local Newspeak could be confusing.  We could have started by downloading Newspeak locally, and follow the whole tutorial in local Newspeak.  However, we thought that may discourage some people who want to "take the shortest path", and start online.</li>
</ul>


<p>
<b>Steps: <a id="orgd3e5383"></a> Now we have introduced the context, we start the core of this section: We create the deployable file, <code>CounterApp.vfuel</code> and deploy it to the local Newspeak, by following the Action/Result steps below:</b>
</p>

<ul class="org-ul">
<li>Action: Navigate to the online version of Newspeak at <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a> and click the "Newspeak Source"</li>
<li>Result: Under "Root" you should see an alphabetically organized list of classes, similar to <img src="/img/newspeak---a-few-notes.org-newspeak-source.png" alt="nil"/>, 
<ul class="org-ul">
<li>Note: If you followed the online section <a href="#orgba53dc6">5.2</a>, there should be <code>CounterApp</code> and <code>CounterUI</code> classes in the alphabetic list.</li>
</ul></li>
<li>Action: In the class list, find the <code>CounterApp</code>, and click the [deploy] to the right of the "CounterApp"</li>
<li>Result: a popup showing deployment options, starting with <code>asVictoryFuel</code>: <img src="/img/newspeak---a-few-notes.org-click-deploy-on-counter-app.png" alt="nil"/></li>
<li>Action: Select <code>asVictoryFuelWithMirrors</code>.  We choose the option 'asVictoryFuelWithMirrors' if our app uses the GUI (there's some mirror dependency in the UI) and 'asVictoryFuel' otherwise.</li>
<li>Result: After a long wait, a file named <code>CounterApp.vfuel</code> is created, and asked to be saved.</li>
<li>Action: Save the file <code>CounterApp.vfuel</code> on our disk to the directory where local Newspeak was deployed - for example <code>$HOME/software/newspeak/my-serve-http/servable</code></li>
<li>Result: <b>The counter app is now deployed to the local Newspeak webserver!</b></li>
</ul>


<p>
To prove the counter app is now deployed to the local Newspeak webserver, do the following:
</p>

<ul class="org-ul">
<li>Action: Open a new browser tab, and navigate to the just saved application  <code>CounterApp.vfuel</code> in the local Newspeak webserver as <a href="http://localhost:8080/primordialsoup.html?snapshot=CounterApp.vfuel">http://localhost:8080/primordialsoup.html?snapshot=CounterApp.vfuel</a></li>
<li>Result: In the new tab, you should see the "locally deployed" <code>CounterApp</code> is now running
<img src="/img/newspeak---a-few-notes.org-counter-app-local-run.png" alt="nil"/></li>
</ul>

<p>
Summary: 
</p>

<ul class="org-ul">
<li>In this section, using the online Newspeak, we built our "Newspeak production deployable" file <code>CounterApp.vfuel</code>, and deployed it to the local Newspeak version at <a href="http://localhost:8080/primordialsoup.html?snapshot=CounterApp.vfuel">http://localhost:8080/primordialsoup.html?snapshot=CounterApp.vfuel</a>.</li>
</ul>

<p>
Next: This is the end of coding, building and running the <code>CounterApp</code>
</p>
</div>
</div>
</div>


<div id="outline-container-org427a0ce" class="outline-2">
<h2 id="org427a0ce"><span class="section-number-2">6</span> Newspeak is different.  An ide-driven journey around the Newspeak platform</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org6d24e33" class="outline-3">
<h3 id="org6d24e33"><span class="section-number-3">6.1</span> Motivation of writing this journey</h3>
<div class="outline-text-3" id="text-6-1">
<p>
On this journey, I would like to walk back and capture some of my surprises, gotchas, but also amazement of simplicity during a journey of my first week (stretched over 2 months) starting with Newspeak.  But hopefully I manage to organize this journey into a somewhat streamlined story.  Actually "the first week" is not completely correct.  I did first discover Newspeak long time ago, almost when it started, read available articles back then, and covered the syntax which helped.  But I did not have time back then to get my hands on it properly.
</p>

<p>
Most learning, and often "unlearning" for me was the discovery different the Newspeak platform is, compared to most mainstream platforms, such as Java, Python, C++, even Smalltalk (with Smalltalk, Newspeak shares syntax and extreme late boundedness).
</p>

<p>
At this moment I should give readers some links to jump off here and do this alone.  If you found this, you probably already searched to learn about Newspeak.  But I hope, if you get back here after googling and reading the links, the rest of this text may still be helpful :) ..  so, some selected links:
</p>

<ul class="org-ul">
<li>First of all, the home of the Newspeak language <a href="https://newspeaklanguage.org/">https://newspeaklanguage.org/</a> has links to all documentation, videos, installers and more.</li>
<li>Second, to run Newspeak online, navigate to  <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=CounterApp.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=CounterApp.vfuel</a>.</li>
<li>Next, if I was to:
<ul class="org-ul">
<li>recommend selected few documents, it could be
<ul class="org-ul">
<li><a href="http://bracha.org/newspeak.pdf">The Newspeak programming platform</a>, an older document, briefly introduces both the syntax, and the core principles of Newspeak.</li>
<li><a href="https://newspeaklanguage.org/samples/Literate/Literate.html">Newspeak by example</a>  which is a live document, introduces the syntax of Newspeak, sort of a Jupyter notebook for Newspeak: reader can type and evaluate Newspeak expression in a web page, interleaved with document text.</li>
</ul></li>
<li>recommend a hands-on Newspeak introduction, it could be
<ul class="org-ul">
<li>Either use (still relevant where not Squeak dependent) <a href="https://newspeaklanguage.org/ns101/ns101.html">Newspeak on Squeak - A Guide for the Perplexed</a></li>
<li>Or follow the hands-on section <a href="#org8b291c4">Newspeak: A quickstart.  Explore the IDE.  Then develop CounterApp, package it and deploy it</a>.</li>
</ul></li>
</ul></li>
</ul>

<p>
Getting back to my first week journey; it is unfair to hikers, as my journey was at times, that of a wanderer almost lost in a forest; haphazardly reading all I can get my hands on, trying code snippets things in the IDE, re-tracing running and deploying the existing <code>CounterApp</code>, and overall, taking one step forward, then two steps back as the step forward discovered more unknowns.
</p>

<p>
Some concrete talk please!
</p>

<p>
OK.  But first one more paragraph of meta-talk.  Just a heads up, I will start using the word <b>platform</b> a lot.  Let me try explain what I mean by <i>platform</i> or <i>language platform</i>.  Often we think of learning a "computer language" as learning its syntax.  But syntax is only a small part of being able to be productive in the language.  There are all those things around the syntax, that are needed to be comfortable and productive with a "computer language": How is it installed, how we create projects to start writing a useful program, the core idioms, how to use programs written by other people in that language (the libraries), how the programs we write are packaged and send to users to use (building, packaging and installing apps), how to secure the resulting program.  It is all these things listed in the long sentence that I mean by the "language platform" or "platform". 
</p>

<p>
Newspeak syntax is not a major obstacle.  Well, it is quite different too, even for someone knowing Smalltalk, which Newspeak shares syntax with.  But one can get syntax basics from the links above.  Also, Newspeak syntax is a bit like speaking English.  Just different from the mainstream.  I will not address syntax too much here.
</p>

<p>
Newspeak is a principled language and <b>platform</b> (in the sense described).  Gilad Bracha and collaborating authors describe several principles (adherence to which removes many mainstream platforms' weaknesses).  Those principles are described in the above linked paper <a href="http://bracha.org/newspeak.pdf">The Newspeak programming platform</a> and other documents.
</p>

<p>
As this section title states, Newspeak is different. <b>Being different is not for fun.  Newspeak must be different to implement its core principles</b>
</p>

<ul class="org-ul">
<li>Dynamicity</li>
<li>Modularity (including how dependencies are provided)</li>
<li>Classes can be nested (nesting provides the core of modularity)</li>
<li>Security</li>
<li>Reflectivity</li>
<li>intentional lack of static state</li>
<li>support for both object-oriented and functional styles</li>
<li>the only operation is a message send</li>
</ul>


<p>
I will add one multi-item principle.
</p>
<ul class="org-ul">
<li>Everything in the Newspeak language is an object (instance of a class). 
<ul class="org-ul">
<li>Most(?) mainstream languages use separate concepts for packages, apps, modules, namespaces, classes.  They also use the filesystem a lot.</li>
<li>All concepts in the item above exist in Newspeak, but they are all implemented by objects.</li>
</ul></li>
</ul>

<p>
But, given a Newspeak object, how do we know it is a <b>module, a library, or an app</b>? The distinction between them is determined by:
</p>

<ol class="org-ol">
<li>the object's position in the class nesting and</li>
<li>presence of certain API (convention named methods such as <code>#main:platform args:args</code>. This is discussed in <a href="#org98fdcd0">Newspeak modules API summary</a> and other sections leading to it.</li>
</ol>

<p>
Given a Newspeak object, how does it acquire it's dependencies (objects it depends on to be functional)? This is one core point discussed at length in this text. See <a href="#orgb4743ce">Dependencies and modularity: Perhaps the hardest part of Newspeak difference</a> the links therein, and sections afer.
</p>

<p>
"Being different" does came at a steep initial learning curve (for me at least). 
</p>
</div>
</div>



<div id="outline-container-orgb4743ce" class="outline-3">
<h3 id="orgb4743ce"><span class="section-number-3">6.2</span> Dependencies and modularity: Perhaps the hardest part of Newspeak difference</h3>
<div class="outline-text-3" id="text-6-2">
<p>
This section is only a quick "look ahead summary" to provide more motivation and contex for the rest of the parent chapter.
</p>

<p>
Due to Newspeak's modularity, the process of bringing dependencies into a Newspeak program is different from mainstream language platforms. Because of it, large parts of this text deals with the topic of dependencies. 
</p>

<p>
As a look ahead summary we can say that 
</p>
<ul class="org-ul">
<li>Every computation in Newspeak starts at an instance of a top level class. Instances of top level classes are called modules.</li>
<li>Modules can be packaged and distributed.</li>
<li>Dependencies are also modules (which some distributed module depends on).</li>
<li>The <code>manifest</code> and <code>platform</code> objects are the vehicles of bringing dependencies to objects at runtime by passing them to some "convention" API methods to modules.</li>
<li>From modules, the dependencies are also available to the distributed module's nested classes and objects.</li>
</ul>

<p>
Later sections decribe the process of bringing dependencies into a Newspeak programs. We use the <i>manifest</i> passed to module APIs, from the manifest, dependency classes are stored on slots ("imported"), later picked up from slots when needed to instantiate.  <a href="#org4633bc8">Modules: Application, library, test, general</a>, the recipy section <a href="#org465e425">Newspeak recipy for writing modules API</a>, and the <a href="#org3f7b274">Hello World in Newspeak</a> and other sections are largely about bringing dependencies into modules and objects.
</p>
</div>
</div>


<div id="outline-container-org9c92a01" class="outline-3">
<h3 id="org9c92a01"><span class="section-number-3">6.3</span> Starting the journey</h3>
<div class="outline-text-3" id="text-6-3">
<p>
To do anything useful with Newspeak, we have to use the IDE.  There is no command line per se (there is, but it is inside the IDE.  It is called the Workspace).  So let us open the Newspeak IDE to look around.  Navigate to  <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=CounterApp.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=CounterApp.vfuel</a>.
</p>

<p>
We see something like
</p>


<div id="orge66203a" class="figure">
<p><img src="/img/newspeak---a-few-notes.org-local-ide.png" alt="nil"/>
</p>
</div>

<p>
Click the "Newspeak Source" link.
</p>

<p>
Each paragraph below is devoted to a feature that was surprising (to me) or unusual in some way. 
</p>
</div>
</div>


<div id="outline-container-orgb541611" class="outline-3">
<h3 id="orgb541611"><span class="section-number-3">6.4</span> Namespaces and Modules</h3>
<div class="outline-text-3" id="text-6-4">
</div>
<div id="outline-container-org3923d4e" class="outline-4">
<h4 id="org3923d4e"><span class="section-number-4">6.4.1</span> Top level classes in the IDE</h4>
<div class="outline-text-4" id="text-6-4-1">
<p>
Top level classes in the IDE are crucial as Newspeak modules in general, Apps and Libraries.
</p>

<p>
I the IDE, click on the "Newspeak Source" button. We see the word <b>Root</b> on top left, and below, a list of class names. 
</p>


<div id="org48154dd" class="figure">
<p><img src="/img/newspeak---a-few-notes.org-ide-full-page-classes-collapsed.png" alt="nil"/>
</p>
</div>

<p>
First: what is the "Root" on the top? According to documentation, this is the IDE's top namespace - <i>Root</i> is the name of the  namespace.
</p>

<p>
In Newspeak, each class in the screenshot above (AccessModifierTesting, and below) is called a <b>top level class</b>, and it belongs to the <i>Root namespace</i>.  Each <i>instance of a top level class</i> is referred to as a <b>module</b>, see <a href="#org6e890f7">Discussion of Modules</a>.  
</p>
</div>
</div>


<div id="outline-container-org6e890f7" class="outline-4">
<h4 id="org6e890f7"><span class="section-number-4">6.4.2</span> Discussion of Modules</h4>
<div class="outline-text-4" id="text-6-4-2">
<p>
In software in general, <i>Modules</i> are related to namespaces in a way that we cannot precisely define here.  See <a href="#org982e2bc">Discussion of Namespaces</a> as well.  But we can say this about modules: Modules are meant to be artifacts providing some useful non trivial functionality, without needing any help - apart from the help of "dependencies" - that is, help of other modules intended to provide some "sub functionality".  There must be a way to package and distribute modules.
</p>

<p>
In Newspeak, modularity is one of the key concepts. Modules, the key constructs of modularity, are based on class nesting.
</p>

<p>
Lets again quote from <a href="https://bracha.org/newspeak-modules.pdf">Modules as Objects in Newspeak</a>: 
</p>

<p>
<i>In Newspeak, nor is there a global namespace. Modularity in Newspeak is based exclusively on class nesting. There are no separate modularity constructs such as packages. Top level classes act as module definitions, which are independent, immutable, self-contained parametric namespaces. They can be instantiated into modules which may be stateful and mutually recursive.</i>
</p>

<p>
Newspeak basically uses the following definitions:
</p>

<ul class="org-ul">
<li><b><i>Module definition</i></b> or <b><i>Module class</i></b> is any <b><i>top level class</i></b>.  We will use the terms interchangeably.</li>
<li><b><i>Module</i></b> or <b><i>Newspeak module</i></b> is an <b><i>instance of any top level class</i></b>.</li>
</ul>

<p>
So, an instance of any class shown on the top level in the IDE is a <i>module</i>.
</p>

<p>
<b><i>Newspeak Module</i> is not only an empty new term.  It turns out, that, by nesting other classes, <i>modules</i> also satisfy what we normally want from software modules: they are self-contained elements of data and functionality which can be distributed or executed, given expected API.</b>  See <a href="#org98fdcd0">Newspeak modules API summary</a>. In addition, <i>Newspeak modules</i> cannot cross-access each other when deployed - unless one module explicitly requests another <i>module</i> or <i>module class</i> during packaging and building.  
</p>
</div>
</div>


<div id="outline-container-org982e2bc" class="outline-4">
<h4 id="org982e2bc"><span class="section-number-4">6.4.3</span> Discussion of Namespaces</h4>
<div class="outline-text-4" id="text-6-4-3">
<p>
<i>Namespaces</i> in softwware in general provide grouping and organization of artifacts used in programs (packages, classes, or functions).  A Java namespace example would be "org.mypackage".  All classes in that package belong to the namespace "org.mypackage".  Python concept of a package is similar. 
</p>

<p>
Most platforms and languages have a concept and need for a <b>global namespace</b>. How can we describe it? Perhaps a good high level description of a <i>global namespace</i> would go like this: In a program, we want to use other programs, classes, functions, or what have you, created by other developers, at compile time or runtime, depending on the platform.  If our Java program is in the "org.mypackage" and a class "org.mypackage.MyClass wants to use "org.apache.SomeClass", then at compile time or at runtime, the platform (Java, but e.g.  Python is equivalent) has to find "org.apache.SomeClass".  How does it do that? By looking through CLASSPATH or PYTHONPATH.  The CLASSPATH or PYTHONPATH play the role of the <i>global namespace</i>!  All other namespaces, such as "org.apache" belong to the <i>global namespace</i>.  In a Java or Python program, any class and it's instance at runtime has access to artifacts on the CLASSPATH or PYTHONPATH. For example, this code
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #73d216;">// </span><span style="color: #73d216;">In org.mypackage.MyClass: </span>
<span style="color: #8cc4ff;">Object</span> <span style="color: #fcaf3e;">newObject</span> = Class.forName(<span style="color: #e9b96e;">"org.apache.SomeClass"</span>).newInstance();
</pre>
</div>

<p>
Creates an instance of "org.apache.SomeClass" at runtime by finding it on CLASSPATH - on the <i>global namespace</i> of Java. As long as the classloader can find "org.apache.SomeClass" on the CLASSPATH, and SomeClass has the default constructor, an instance can be created - without "org.apache.SomeClass" ever being imported to the code. Instances of classes in "org.mypackage" can create instances of classes in "org.apache" and vice versa, without importing each other.  <b>This is why the availability of the <i>global namespace</i> harms modularity, as it enables "hidden dependencies" like the one described in this short Java example!</b> 
</p>

<p>
The Newspeak language does not have a <i>global namespace</i> but the Newspeak IDE does have a <i>global namespace</i> - the <i>Root</i> on top of the IDE we have seen in the previous chapter. There is some discussion regarding why that is in <a href="#org2b1038d">Namespaces and existence of global namespace in the IDE</a>.
</p>

<p>
The consequence of <i>no global namespace in the language</i> is that, at runtime (outside of IDE), a Newspeak module class must declare it's dependency on another module class explicitly, by storing the dependency class module definition ("import" it) on it's module slot! See how all classes needed at runtime are "imported" by holding on to them on module slots in code samples, including:
</p>
<ul class="org-ul">
<li>In <a href="#org7bffa18">4. Hello World App using 3rd party dependency</a> the <code>HelloTranslatorLib</code> holds on to the <code>HelloTranslator</code></li>
<li>In <a href="#org818d945">4. App module: API of module that needs to be distributed as an App</a> <code>RecipyWithDepApp</code> holds on to the <code>RecipyWithDep</code>, and <code>RecipyNoDep</code>.</li>
</ul>

<p>
For the more complete language discussion of what a namespace is, and why a global namespace is not needed in the Newspeak language, see <a href="https://gbracha.blogspot.com/2008/12/living-without-global-namespaces.html">https://gbracha.blogspot.com/2008/12/living-without-global-namespaces.html</a>. 
</p>
</div>
</div>


<div id="outline-container-org2b1038d" class="outline-4">
<h4 id="org2b1038d"><span class="section-number-4">6.4.4</span> Namespaces and existence of global namespace in the IDE</h4>
<div class="outline-text-4" id="text-6-4-4">
<p>
The existence of the <i>Root namespace</i> in the Newspeak IDE describes one of my surprises - although I realized only later that I should be surprised.  I should have been surprised because there are many places in the Newspeak documentation describing that "Newspeak has no global namespace".  So I was wondering why this "Root", is not a global namespace? Turns out that it is! But there is an important distinction, <i>the Newspeak <b>language</b> does not have a global namespace while the Newspeak <b>IDE</b> does - it's name is "Root"</i>.
</p>

<p>
Next we can ask, why does the Newspeak IDE need a global namespace (Root), while the Newspeak language does not have one, in fact very intentionally does not have one?  The reason is, when working in the IDE, we want cross-access between the <i>module classes</i> (the <i>top level classes</i>).  At runtime, that is, after packaging and deployment of any Newspeak module (outside the IDE), only the modules intended to be used by other modules should be available!  Modules cannot freely cross-use each other, because there is no global namespace to find each other (or each other's class).  If a moduleA needs to use moduleB, moduleA must explicitly ask to include moduleB's definition (the class of moduleB) at the packaging stage. See also the text and links in <a href="#orgb4743ce">Dependencies and modularity: Perhaps the hardest part of Newspeak difference</a>.
</p>
</div>
</div>
</div>


<div id="outline-container-orgcfab820" class="outline-3">
<h3 id="orgcfab820"><span class="section-number-3">6.5</span> Class structure, factory constructors, platform and manifest, modules API</h3>
<div class="outline-text-3" id="text-6-5">
</div>
<div id="outline-container-org061e3a5" class="outline-4">
<h4 id="org061e3a5"><span class="section-number-4">6.5.1</span> Section TL;DR:</h4>
<div class="outline-text-4" id="text-6-5-1">
<p>
This section starts an IDE-lead step by step discovery of some core aspects we encounter when we first dig into the IDE and the classes on top: Newspeak class structure, app and library API, platform and manifest.
</p>
</div>
</div>


<div id="outline-container-org36553ab" class="outline-4">
<h4 id="org36553ab"><span class="section-number-4">6.5.2</span> Top level classes in the IDE - expanded</h4>
<div class="outline-text-4" id="text-6-5-2">
<p>
Let us expand each top level class in the "sources" screenshot above.  Well, maybe not all.  I expanded two in the screenshot below:
</p>


<div id="orgb1e48c8" class="figure">
<p><img src="/img/newspeak---a-few-notes.org-ide-full-page-classes-expanded.png" alt="nil"/>
</p>
</div>

<p>
Continue reading what we can learn from looking at the expanded classes.
</p>
</div>
</div>


<div id="outline-container-orge6745be" class="outline-4">
<h4 id="orge6745be"><span class="section-number-4">6.5.3</span> Newspeak class structure</h4>
<div class="outline-text-4" id="text-6-5-3">
<p>
First, we can see, each top level class has 4 sections.  Let's take the ActivationMirrorTestingConfiguration as an example
</p>

<ol class="org-ol">
<li>A collapsible class name section for the class, <code>ActivationMirrorTestingConfiguration</code> with two sub items
<ul class="org-ul">
<li>a message to class on top <code>#packageTestsUsing: manifest</code> in our class.  This message is a "core" constructor.  It is called the <b>Factory constructor</b>.</li>
<li>a list of <code>Slots</code>.  Slots are like "member variables".  Slots can only be created in the <i>factory constructor</i>!</li>
</ul></li>
<li>a list of <code>Classes</code>.  Those are nested classes of the class ActivationMirrorTestingConfiguration</li>
<li>a list of <code>Instance methods</code>.  Those are instance methods we can call on instances of ActivationMirrorTestingConfiguration</li>
<li>a list of <code>Class methods</code>.  Those are class methods we can call on the class ActivationMirrorTestingConfiguration.  They are "alternative constructors".</li>
</ol>

<p>
There is a plus ("+ ") symbol  in the header of some of them.  The reason there is no plus ("+ ") symbol beside slots, is that slots can only be added in the code of the <i>factory constructor</i>.  Add a slot from the  <i>factory constructor</i> code, and the added slot name will show in the IDE.
</p>
</div>
</div>


<div id="outline-container-org7c19284" class="outline-4">
<h4 id="org7c19284"><span class="section-number-4">6.5.4</span> Factory constructors</h4>
<div class="outline-text-4" id="text-6-5-4">
<p>
We mentioned the messages on top like <code>#packageTestsUsing: manifest</code> are called the <i>factory constructors</i>.
</p>

<p>
<b>The core role of a <i>factory constructor</i> is to create slots.  No other method can create slots!</b>
</p>

<p>
<b>The platform objects (objects that represent the Newspeak system), and / or the dependencies objects or classes (classes that need to be "imported" from the manifest) are passed to the factory constructor and held on slots.  From there, they are available to all nested classes and nested objects of the top level instance!</b>
</p>

<p>
<i>factory constructor</i> names on the <i>top level classes</i> have an eerily similar structure.  I was asking myself why, what do they have in common.  So I listed more of the factory constructor names.  Here is the list of the <i>factory constructors</i> on some top level classes:
</p>

<pre class="example" id="orgd42f98d">
class AccessModifierTesting                 usingPlatform:       platform  testFramework: minitest = (| etc
class AccessModifierTestingConfiguration    packageTestsUsing:   manifest = (| etc
class ActivationMirrorTesting               usingPlatform:       platform minitest: m = (| etc
class ActivationMirrorTestingConfiguration  packageTestsUsing:   manifest = (| etc
class ActorsForPrimordialSoup               usingPlatform:       platform = (| etc
class AliensForV8                           usingPlatform:       platform = ( etc
class Browsing                              usingPlatform:       platform ide: webIde = ( etc
class Collections                           usingPlatform:       platform = ( etc
class CollectionsForPrimordialSoup          usingInternalKernel: ik = ( etc
class CombinatorialParsing                  usingPlatform:       platform = ( etc
class RuntimeForV8                          packageUsing:        manifest = ( etc
class Streams                               usingPlatform:       platform = ( etc
</pre>

<p>
We can see that the factory constructors accept, at first position, one of 2 arguments
</p>

<ul class="org-ul">
<li><code>platform</code></li>
<li><code>manifest</code></li>
</ul>

<p>
If the constructor first argument is <code>platform</code>, the constructor name always <i>starts with</i>
</p>

<ul class="org-ul">
<li><code>#usingPlatform: platform</code></li>
</ul>

<p>
If the constructor first argument is <code>manifest</code>, the constructor name is always <b>exactly</b> one of
</p>

<ul class="org-ul">
<li><code>#packageUsing: manifest</code></li>
<li><code>#packageTestsUsing: manifest</code> (for tests only)</li>
</ul>

<p>
Clearly, <code>platform</code> and <code>manifest</code>, must be significant!
</p>

<p>
What are those objects? And what do they contain, why are they significant, and what role do they play in Newspeak? 
</p>
</div>
</div>


<div id="outline-container-org853369e" class="outline-4">
<h4 id="org853369e"><span class="section-number-4">6.5.5</span> The manifest object</h4>
<div class="outline-text-4" id="text-6-5-5">
</div>
<div id="outline-container-org5c57cbf" class="outline-5">
<h5 id="org5c57cbf"><span class="section-number-5">6.5.5.1</span> What is in the manifest object?</h5>
<div class="outline-text-5" id="text-6-5-5-1">
<p>
So what is in the manifest, why it is significant, and what role does it play in Newspeak?
</p>

<p>
We can look at the code, and ask what Newspeak passes into the <code>manifest</code> parameter.  We find that there is only one place that calls <code>#packageUsing: manifest</code>, and it passes for <code>manifest</code> the value of object <code>ide namespacing manifest</code>.  So we can examine what <code>ide namespacing manifest</code> contains.  In Workspace, let us evaluate it:
</p>

<pre class="example">
ide namespacing manifest
</pre>


<div id="org16b22ab" class="figure">
<p><img src="/img/newspeak---a-few-notes.org-ide-namespacing-manifest.png" alt="nil"/>
</p>
</div>

<p>
Drilling into the instance, we can see it is a map, and sorting by the key, we get
</p>

<pre class="example" id="orgd5d1d03">
at: AccessModifierTesting   AccessModifierTesting
at: AccessModifierTestingConfiguration   AccessModifierTestingConfiguration
at: ActivationMirrorTesting
  etc
</pre>

<p>
We see that the <b>manifest is a map containing exactly all top-level classes in the IDE - that is, all module classes known to the IDE!</b>
</p>

<p>
So we have a experiment based answer to what the manifest object contains.
</p>
</div>
</div>


<div id="outline-container-org66a7ed8" class="outline-5">
<h5 id="org66a7ed8"><span class="section-number-5">6.5.5.2</span> Why is the manifest object significant, and what role does it play in Newspeak?</h5>
<div class="outline-text-5" id="text-6-5-5-2">
<p>
OK, so we know what is in the <code>manifest</code> object that is passed to 
</p>

<ul class="org-ul">
<li><code>#packageUsing: manifest</code></li>
<li><code>#packageTestsUsing: manifest</code> (for tests only)</li>
</ul>

<p>
See <a href="#orgd13d91d">Chapter Common and distinct roles of platform and manifest in modules</a> for a discussion the significance and role of the <i>manifest</i> object.
</p>
</div>
</div>
</div>


<div id="outline-container-org953587a" class="outline-4">
<h4 id="org953587a"><span class="section-number-4">6.5.6</span> The platform object</h4>
<div class="outline-text-4" id="text-6-5-6">
</div>
<div id="outline-container-org1594af0" class="outline-5">
<h5 id="org1594af0"><span class="section-number-5">6.5.6.1</span> What is in the platform object?</h5>
<div class="outline-text-5" id="text-6-5-6-1">
<p>
As in manifest, we can ask: what is in the platform, why it is significant, and what role does it play in Newspeak?
</p>

<p>
We can look at the code, and ask what Newspeak passes into the <code>platform</code> parameter when calling, for example, <code>#usingPlatform: platform</code>.
</p>

<p>
This is little harder than with manifest, so let's cheat a bit.  In Workspace, let us evaluate <code>platform</code>
<img src="/img/newspeak---a-few-notes.org-workspace-eval-platform.png" alt="nil"/>
Drilling into the link "instance of PlatformWithHopscotch`number", we see a list of instances. Sorting the list, we can see it contains <code>instances</code> of a few classes that look like system classes:
</p>

<pre class="example" id="org0bc78aa">
instance of ActorsForPrimordialSoup
instance of CollectionsForPrimordialSoup
instance of FontsForHTML5
instance of GraphicsForHTML5
instance of HopscotchForHTML5
instance of JSForPrimordialSoup
instance of Kernel
instance of MirrorsForPrimordialSoup
instance of PrimordialFuel
instance of TextModule
</pre>

<p>
Classes of all of those instances also exist in the <code>manifest</code> object. 
</p>

<p>
From the above, we have a good indication as to what does the platform object contain: <b>the platform object contains instances of system classes from the manifest!</b>
</p>
</div>
</div>



<div id="outline-container-orge5a7812" class="outline-5">
<h5 id="orge5a7812"><span class="section-number-5">6.5.6.2</span> Why is the platform object significant, and what role does it play in Newspeak?</h5>
<div class="outline-text-5" id="text-6-5-6-2">
<p>
OK, so we know what is in the <code>platform</code> object that is passed to 
</p>

<ul class="org-ul">
<li><code>#usingPlatform: platform</code></li>
</ul>

<p>
See <a href="#orgd13d91d">Chapter Common and distinct roles of platform and manifest in modules</a> for a discussion the role of the <i>platform</i> object.
</p>
</div>
</div>
</div>


<div id="outline-container-orgd13d91d" class="outline-4">
<h4 id="orgd13d91d"><span class="section-number-4">6.5.7</span> Common and distinct roles of platform and manifest in modules</h4>
<div class="outline-text-4" id="text-6-5-7">
<p>
Why are the <code>platform</code> and <code>manifest</code> objects so important to appear again and again in the <i>top level classes factory parameters</i> as seen in <a href="#org7c19284">Factory constructors</a>
</p>

<p>
The answer is somewhat common for <code>manifest</code> and <code>platform</code>, so we describe their role in this common section.
</p>

<p>
And, the common need for either  <code>manifest</code> or <code>platform</code> is modularity.  But what does that mean?
</p>

<p>
We saw that the <i>modules</i> are DEFINED AS <i>instances of top level classes</i> in Newspeak.  So in this text, we will use the term <i>module</i> and <i>module instance</i> for such top level class or its instance.
</p>

<p>
And we saw that there is no global namespace in Newspeak.  Module instances, need other objects (dependencies) to do useful work.  In Newspeak, for a module instance to "contain" ANY dependency, such dependency must be on the module instance slot (slot is like the member variable).  Also, at the point of the module construction we MUST supply such dependency.  Because only the <i>factory constructor</i> can define slots, the <b>module factory constructor must be passed everything the module needs from outside</b>.  
</p>

<p>
This is where  <code>platform</code> and <code>manifest</code> come in.  They are "special" in the sense that they supply objects and classes needed by the module.  But each happens at a special point of the module lifecycle.  This is summarized in <a href="#org4633bc8">Modules: Application, library, test, general</a>
</p>

<p>
We know any Newspeak object can have only one "slot defining" constructor (called <i>factory constructor</i>.  So any module can <b>only have one of the following factory constructors</b>
</p>

<ul class="org-ul">
<li>Factory method passing manifest, named similar to <code>#package(Something)Using: manifest</code>  - manifest is needed during packaging (imports). Only App, Library, and Test configuration modules use this factory constructor.</li>
<li>Factory method passing platform, named similar to <code>#(doSomething)usingPlatform: platform</code> - platform is needed at runtime. For  App, Library, and Test configuration modules, method passing platform in an instance method.</li>
</ul>

<p>
Which method is used on which module type? Follow the next section <a href="#org4633bc8">Modules: Application, library, test, general</a>
</p>
</div>
</div>
</div>


<div id="outline-container-org4633bc8" class="outline-3">
<h3 id="org4633bc8"><span class="section-number-3">6.6</span> Modules: Application, library, test, general</h3>
<div class="outline-text-3" id="text-6-6">
<p>
This chapter is in a way the core why I started writing this whole big chapter <a href="#org427a0ce">6</a>
</p>
</div>

<div id="outline-container-org8a546aa" class="outline-4">
<h4 id="org8a546aa"><span class="section-number-4">6.6.1</span> Application and library in computing</h4>
<div class="outline-text-4" id="text-6-6-1">
<p>
In computing, a program may be an Application (App) or a Library.  This looks arbitrary, but not without merit.  On a high level, we have the following general requirements from an App, and from a Library:
</p>

<ol class="org-ol">
<li>An App must be able to <b>start execution</b> on the platform to which it is targeted (here, platform in the sense of "Linux platform", "Android platform", "Windows platform", and in our situation, the "Newspeak platform).</li>
<li>A Library must be able to be <b>instantiated, loaded or linked, then used</b>, at least in principle, by the caller App or Library on that platform.  The <i>used</i> library is often called a dependency.  The term <i>used</i> implies that the Library is <b>found</b> and <b>connected</b> to the App or Library which is using it.</li>
<li>In addition, we should be able to <b>package</b> both the App and the Library for distribution.</li>
</ol>

<p>
From the generic requirements above, App and Library need some way to perform the requirements.  Methods perform requirements, so we need some "convention" methods to perform the requirements 1, 2, 3.  Such convention methods represent an API, are are described in the following section.
</p>
</div>
</div>


<div id="outline-container-orgdefd475" class="outline-4">
<h4 id="orgdefd475"><span class="section-number-4">6.6.2</span> Application and library API in computing</h4>
<div class="outline-text-4" id="text-6-6-2">
<p>
Following the basic requirements from the previous section <a href="#org8a546aa">6.6.1</a> in mainstream computing, we need methods such as those below.  The names are arbitrary, but conventional, and represent the APIs understood on the platform:
</p>

<ul class="org-ul">
<li>For an App:
<ul class="org-ul">
<li>To perform requirement 3, <i>packaging</i>, let's call the method <code>#package</code>.</li>
<li>To perform requirement 1, <i>start execution</i>, let's call the method <code>#main</code></li>
</ul></li>
<li>For a Library:
<ul class="org-ul">
<li>To perform requirement 3, <i>packaging</i>, let's call the method <code>#packageLibrary</code></li>
<li>To perform requirement 2, <i>instantiate, load and use by the caller app</i>, let's call the method <code>#build</code></li>
</ul></li>
</ul>

<p>
A mainstream system has the advantage of access to a global namespace - generally a filesystem via a PATH, CLASSPATH, PYTHONPATH or similar.  We discussed that earlier as well.  Inside any of these methods, during execution, the program can look and find various artifacts in needs on the platform.  If we start the method equivalent to "#main" in Python, inside #main there may be a line of code such as <code>from graphics import Rectangle</code>.  So we need the Rectangle class.  No problem, we go to the classpath, find the namespace <i>graphics</i>, there lives the module <i>graphics</i>, and the class <i>Rectangle</i> is there.  We load it and continue. 
</p>
</div>
</div>


<div id="outline-container-org4ee700c" class="outline-4">
<h4 id="org4ee700c"><span class="section-number-4">6.6.3</span> Application and library modules in Newspeak</h4>
<div class="outline-text-4" id="text-6-6-3">
<p>
In Newspeak, everything is done via objects.  So App and Library must be an object.  Further, Newspeak starts all operations on the instances of top level classes, that is, on modules. (Modules are <i>instances of top level classes</i>, see <a href="#org6e890f7">Discussion of Modules</a>)
</p>

<p>
So in Newspeak, any App is a module, and any Library is a module.
</p>

<p>
But Newspeak cannot load anything globally.  If the API for the App and library was as defined above in <a href="#orgdefd475">Application and library API in computing</a>, applications would not run as there would be no way to bring anything from a construct such as the CLASSPATH.  In more detail if the App's <code>#main</code> method defined above was to run, and Newspeak would discover the equivalent of "import" (which is slot creation in factory constructors), it would not be able to find the "imported" dependency module.  It does not have the global namespace or access to the  PATH, CLASSPATH, PYTHONPATH or similar. 
</p>

<p>
<b>The solution is, in Newspeak, all the runtime dependencies (or rather their classes) must be passed to the <i>factory constructors</i></b>  
</p>

<p>
But, how is the solution implemented, in more details? Well, we simply add some objects to the Module factory constructors.  But which objects? 
</p>

<ul class="org-ul">
<li><b>To build (instantiate) a Library or execute and App</b>, we need to supply the capabilities of the Newspeak platform.  This IS provided by the <i>platform object</i> analyzed in <a href="#org953587a">The platform object</a>.  So <span class="underline">we will pass the <i>platform</i> object to the execution or instantiating methods</span>.</li>
<li><b>To package     a Library or an App</b>, we need to supply all classes the Library or App needs to "carry along" in it's package.  Such "carried along" classes become slots on the module object (the "carried along" classes play the role of "imported classes" in mainstream).  In the IDE, during development of the module we are packaging, we may have been creating our own top level classes (and their nested classes obviously) needed by the module we are packaging.  Those classes do not exist on the end-user system where we will send the package for building or execution.  So all those added classes have to be "carried along" in the package.  We have seen all available classes in the IDE, including those we may have added, are supplied by <a href="#org853369e">The manifest object</a>.  So <span class="underline">we will pass the <i>manifest</i> object to the packaging methods</span>.</li>
</ul>


<p>
So, in Newspeak, to supply dependencies, (due to intentional lack of global namespace), we will have to extend the signature names from previous chapter:
</p>

<ul class="org-ul">
<li>For an App:
<ul class="org-ul">
<li>To perform requirement 3, <i>packaging</i>, let's call the method <code>#packageUsing: manifest</code>.</li>
<li>To perform requirement 1, <i>start execution</i>, let's call the method <code>#main: platform args: args</code></li>
</ul></li>
<li>For a Library:
<ul class="org-ul">
<li>To perform requirement 3, <i>packaging</i>, let's call the method <code>#packageLibraryUsing: manifest</code></li>
<li>To perform requirement 2, <i>instantiate, load and use by the caller app</i>, let's call the method <code>#buildUsing: platform</code></li>
</ul></li>
</ul>
</div>
</div>



<div id="outline-container-org98fdcd0" class="outline-4">
<h4 id="org98fdcd0"><span class="section-number-4">6.6.4</span> Newspeak modules API summary</h4>
<div class="outline-text-4" id="text-6-6-4">
<p>
This section is a summary and reference of Application, library, and test modules API in Newspeak.  It is sort of the pinnacle of the parent section about Apps and Libraries. 
</p>

<p>
<b>As explained in the previous section, in Newspeak, compared to a mainstream platform which has access to global namespace, we have to change the API signatures described in <a href="#orgdefd475">Application and library API in computing</a> by passing the <i>platform</i> and the <i>manifest</i> object.</b>  We also change the signatures to match actual Newspeak names.
</p>

<p>
<b>Here are the APIs which define whether a Newspeak module is an App, a Library, a Test Configuration, or a General module</b>.  The requirements 1, 2, 3 refer to the requirements (roles) in  <a href="#orgdefd475">Application and library API in computing</a>. Please note that Newspeak is not using the terms "App module", "Library module", "General module", or "Test Configuration module". I find it a useful classification of modules though.
</p>

<ul class="org-ul">
<li><b>Newspeak App module</b> is defined by the presence of:
<ul class="org-ul">
<li>Factory constructor <code>#packageUsing: manifest</code>        which performs requirement 3, <i>packaging</i>. 
<ul class="org-ul">
<li>Implementations should set slots by pulling needed classes from the manifest</li>
</ul></li>
<li>Instance method     <code>#main: platform args: args</code>     which performs requirement 1, <i>start execution</i>.
<ul class="org-ul">
<li>Implementations should instantiate, from slot classes and platform objects, all object needed to run the app, then call methods on them as needed.  Examples of needed objects instantiating:
<ul class="org-ul">
<li><i>Slot1 usingPlatform: platform [and: otherObjects]</i> if Slot1 is Other module</li>
<li><i>Slot2 buildUsing: platform</i> if Slot1 is a Library module</li>
</ul></li>
</ul></li>
</ul></li>

<li><b>Newspeak Library module</b> is defined by the presence of:
<ul class="org-ul">
<li>Factory constructor <code>#packageLibraryUsing: manifest</code> which performs requirement 3, <i>packaging</i>.
<ul class="org-ul">
<li>Implementations should put all classes needed to build the distributed module to slots, from manifest.  Needed classes not on manifest should be created by calling A3RdPartyDependdency&gt;&gt;#packageLibraryUsing: manifest</li>
</ul></li>
<li>Instance method     <code>#buildUsing: platform</code>          which performs requirement 2, <i>instantiate, load and use by the caller app</i>.
<ul class="org-ul">
<li>Implementations should build, then return a working instance of the module we want to distribute, NOT the instance on which this #buildUsing is defined!! Building the distributed instance will possibly call other needed dependencies #buildUsing: or #usingPlatform" methods.  Examples of how needed dependencies :
<ul class="org-ul">
<li><i>Slot1 usingPlatform: platform [and: otherObjects]</i> if Slot1 is a General module</li>
<li><i>Slot2 buildUsing: platform</i> if Slot1 is a Library module</li>
</ul></li>
<li>Important note:  <b>If we want to distribute a module MyModule1 (this may or may not be a library module!), we have to create a separate top level Library Module, MyModule1Library for the purpose of distributing MyModule1</b>! The #buildUsing: implementation we are talking about here, is the  "MyModule1Lib&gt;&gt;#buildUsing:" method! -  NOT the  "MyModule1&gt;&gt;#buildUsing:" method, as this may not even exist on MyModule1!</li>
</ul></li>
</ul></li>

<li><b>Newspeak Test Configuration module</b> by convention ends with "Configuration", and is defined by the presence of:
<ul class="org-ul">
<li>Factory constructor <code>#packageTestsUsing: manifest</code>              which performs requirement 3, <i>packaging</i>
<ul class="org-ul">
<li>Implementations should put on slot the class of the Module being tested.</li>
</ul></li>
<li>Instance method     <code>#testModulesUsingPlatform: p minitest: m</code>  which performs requirement 2, <i>instantiate</i>, 
<ul class="org-ul">
<li>Implementations should call return instance of the tested class.  Example: ^{AccessModifierTesting usingPlatform: platform testFramework: minitest}</li>
<li>Note: If class MyTestModule has the test methods, MyTestModuleConfiguration must be created.  This is the class we are talking about</li>
</ul></li>
</ul></li>

<li><b>Newspeak General module</b> is <i>any other module</i> - any module that does not have any of the above API.  General modules <b>do not have any convention API name</b>.
<ul class="org-ul">
<li>However, we often find they have a <i>factory constructor</i> named <b>similar to</b> <code>#usingPlatform: platform [and: otherObjects]</code> which create a working instance. Note that the [and: otherObjects] portion is completely free, it can be named differently.  
<ul class="org-ul">
<li>These modules can for example be 
<ul class="org-ul">
<li>modules we distribute using the <i>Library Distribution module</i></li>
<li>tests we run using the <i>Test Configuration module</i></li>
</ul></li>
</ul></li>
</ul></li>
</ul>

<p>
Note that the methods which <b>perform the packaging</b>, are <i>factory constructors</i>, while the methods which perform <b>execution or build</b> are <i>instance methods</i>.  The reason is, a <i>factory constructor</i> is the only method which can store stuff in slots! So any classes modules need to "carry along" ("import" using manifest) must be put to slots during a factory constructor call.
</p>

<p>
Note that the IDE uses some of those methods to show appropriate action links.  For example,
</p>

<ul class="org-ul">
<li>The presence of method <code>#packageUsing: manifest</code> in the module, IDE shows links to <b>[deploy] [configurations] [run] [debug]</b></li>
<li>The presence of method <code>#packageTestsUsing: manifest</code> in the module, IDE shows links to <b>[run tests] [show tests]</b></li>
</ul>
</div>
</div>


<div id="outline-container-org29bc453" class="outline-4">
<h4 id="org29bc453"><span class="section-number-4">6.6.5</span> Newspeak modules API zoo</h4>
<div class="outline-text-4" id="text-6-6-5">
<p>
This section shows a terse list of "convention" API for various module types, with the role of the API. 
</p>

<p>
See <a href="#org98fdcd0">Newspeak modules API summary</a> for roles of the API methods. For motivation of the APIs, see earlier sections such as <a href="#org4633bc8">Modules: Application, library, test, general</a> and the whole section <a href="#org427a0ce">6</a>.
</p>

<p>
The table below summarizes APIs of all type of modules 
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Module type</th>
<th scope="col" class="org-left">Factory Constructor. Role=package</th>
<th scope="col" class="org-left">Note</th>
<th scope="col" class="org-left">Sep</th>
<th scope="col" class="org-left">Instance method. Role=build or execute</th>
<th scope="col" class="org-left">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Library</td>
<td class="org-left">#packageLibraryUsing: manifest</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">-</td>
<td class="org-left">#buildUsing: platform</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">App</td>
<td class="org-left">#packageUsing: manifest</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">-</td>
<td class="org-left">#main: platform args: args</td>
<td class="org-left">calls General modules Factory constructors, and/or Library module instance method, then appropriate methods to run app</td>
</tr>

<tr>
<td class="org-left">Test Configuration</td>
<td class="org-left">#packageTestsUsing: manifest</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">-</td>
<td class="org-left">#testModulesUsingPlatform: platform minitest: m</td>
<td class="org-left">calls Test module Factory constructor which runs tests</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">Factory Constructor.</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">-</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">General, needs platform + other module</td>
<td class="org-left">similar to #usingPlatform: platform [andModule: m1]</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">-</td>
<td class="org-left">Note: name is completely free</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">General, needs other module</td>
<td class="org-left">similar to #andModule: m1</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">-</td>
<td class="org-left">Note: name is completely free</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">General, with no dependencies</td>
<td class="org-left">#new</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">-</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Test</td>
<td class="org-left">#usingPlatform: platform testFramework: minitest</td>
<td class="org-left">runs tests</td>
<td class="org-left">-</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
Notes:
</p>

<ul class="org-ul">
<li>The <code>#usingPlatform: platform [andModule: m1]</code> is an example of a factory constructor which is passed the platform and a dependency which is module m1. The point is the the start of the method name <code>#usingPlatform:</code> is fixed, other parameters can be added for dependencies, in any free form.</li>
<li>The IDE, when we click [run] to run the App, the IDE calls the App's factory constructor <code>#packageUsing: manifest</code>, then the Instance method (run)</li>
</ul>

<p>
We can provide a "recipy" for how any App module should be written:
</p>

<ul class="org-ul">
<li>In the Factory Constructor <code>#packageUsing: manifest</code>, store any "carry along" (import) classes on slots</li>
<li>In the instance method <code>#main: platform args: args</code>
<ul class="org-ul">
<li>First use all (import) classes on slots to instantiate and build their modules:
<ul class="org-ul">
<li>For slots that are general modules classes, call their Factory constructors  <code>#usingPlatform: platform [andModule: m1]</code> to build instances of modules (dependencies)</li>
<li>For slots that are library modules classes, call their build instance methods, <code>#buildLibraryUsingPlatform: platform</code> to build instances of 3rd party modules (dependencies)</li>
</ul></li>
<li>Next, on the instances created just before, call appropriate methods to run the app</li>
</ul></li>
</ul>
</div>
</div>



<div id="outline-container-org608a145" class="outline-4">
<h4 id="org608a145"><span class="section-number-4">6.6.6</span> Newspeak platform and manifest objects summary</h4>
<div class="outline-text-4" id="text-6-6-6">
<p>
In a nutshell, 
</p>
<ul class="org-ul">
<li>We need <i>manifest</i> classes for packaging.  Manifest provides the classes needed to "bring along" (import) in the package.  Those "bring along" or "import" classes may not exist on the end-user system, so they need to be added to the package!</li>
<li>We need <i>platform</i> for execution.  Platform provides instances of "system classes".  Those "system classes instances" are assumed to exist on the end-user system, so we do not need to bring them along in the package!</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-org465e425" class="outline-3">
<h3 id="org465e425"><span class="section-number-3">6.7</span> Newspeak recipy for writing modules API</h3>
<div class="outline-text-3" id="text-6-7">
<p>
Sections above attempted to discover and describe modules API, see <a href="#org98fdcd0">Newspeak modules API summary</a>. This section will attempt to give a "recipy" about method signatures each module type requires.
</p>
</div>

<div id="outline-container-orgd9476b0" class="outline-5">
<h5 id="orgd9476b0"><span class="section-number-5">6.7.0.1</span> 1. General module with NO dependencies: API of module with no dependencies</h5>
<div class="outline-text-5" id="text-6-7-0-1">
<p>
While perhaps rare, this is the simplest case. If our module does not need any dependencies, not even from common classes such as collection:
</p>

<ul class="org-ul">
<li>provide a <i>factory constructor</i> <code>#new</code></li>
</ul>
</div>

<div id="outline-container-org112593c" class="outline-6">
<h6 id="org112593c"><span class="section-number-6">6.7.0.1.1</span> Example:</h6>
<div class="outline-text-6" id="text-6-7-0-1-1">
<pre class="example">
class RecipyNoDep new = ()
(
    public translate: text = (
      text = 'Hello World' ifTrue: [^ 'Hallo Welt'.].

      ^ 'unable to translate'.
    )  
)
</pre>

<p>
Note: Because <code>#new</code> is default, no need to name it. An equivalent would be 
</p>

<pre class="example">
class RecipyNoDep = ()
(
    public translate: text = (
      text = 'Hello World' ifTrue: [^ 'Hallo Welt'.].

      ^ 'unable to translate'.
    )  
)
</pre>
</div>
</div>
</div>


<div id="outline-container-org7062cfa" class="outline-5">
<h5 id="org7062cfa"><span class="section-number-5">6.7.0.2</span> 2. General module with dependencies: API of module with dependencies</h5>
<div class="outline-text-5" id="text-6-7-0-2">
<p>
If our module need some other module from IDE, such as collections, you have to pass it the <code>platform</code> object, and potentially other objects or classes our module depends on
</p>

<ul class="org-ul">
<li>provide a <i>factory constructor</i> <code>#usingPlatform: platform</code></li>
<li>OR if another module is needed, provide a <i>factory constructor</i> such as <code>#usingPlatform: platform andModule: translator</code></li>
</ul>
</div>

<div id="outline-container-org53a173a" class="outline-6">
<h6 id="org53a173a"><span class="section-number-6">6.7.0.2.1</span> Example:</h6>
<div class="outline-text-6" id="text-6-7-0-2-1">
<pre class="example">
class RecipyWithDep usingPlatform: platform andModule: translator = (
  |
  List = platform collections List.
  translator = translator.
  |
)
(
    public translate: fromRevertedList = (
      |sortedList|
      sortedList:: List new.
      sortedList add: (fromRevertedList at: 2).
      sortedList add: (fromRevertedList at: 1).

      ^ translator translate: ((sortedList at: 1), (sortedList at: 2)).
    )
)
</pre>

<p>
and we can use this in workspace as:
</p>

<pre class="example">
|sortListTranslator|
sortListTranslator:: RecipyWithDep  usingPlatform: platform andModule: (RecipyNoDep new).
sortListTranslator translate: {' World'. 'Hello'}.
</pre>

<p>
Note that the RecipyNoDep class could be passed instead of the instance; obviously the slot translator in RecipyWithDep would have to be a class, instantiated in #translate:
</p>
</div>
</div>
</div>


<div id="outline-container-org0efa847" class="outline-5">
<h5 id="org0efa847"><span class="section-number-5">6.7.0.3</span> 3. Library module: API of module that needs to be distributed for use in other modules</h5>
<div class="outline-text-5" id="text-6-7-0-3">
<p>
This next step describes an example of a module which is intended to be distributable as a library. In Newspeak, <b>this means such module must be both packageble and distributable</b> - the roles of "packageble" and "distributable" are achieved by implementing the 2 methods below. We call such modules informally <i>library modules</i>.
</p>

<p>
In the previous section, we introduced a general module <code>RecipyWithDep</code>. If we needed this module to be packagable as a library, add the following:
</p>

<ol class="org-ol">
<li>Add a <b>separate module</b> with a descriptive name (to make clear it is a library), such as <code>RecipyWithDepLib</code></li>
<li>In this <b>separate module</b>, provide the following API:
<ul class="org-ul">
<li>Factory constructor <code>#packageLibraryUsing: manifest</code>, which allows "imports"</li>
<li>Instance method     <code>#buildUsing: platform</code>, which allows dependencies to be pulled at construction time</li>
</ul></li>
</ol>

<p>
Note that in this case, <i>#buildUsing: platform</i> must not be added any other arguments. Any "carry along" (imported) classes that may be needed at build time, must be saved on slots in the <i>#packageLibraryUsing: manifest</i> factory constructor.
</p>
</div>

<div id="outline-container-orgebc4316" class="outline-6">
<h6 id="orgebc4316"><span class="section-number-6">6.7.0.3.1</span> Example:</h6>
<div class="outline-text-6" id="text-6-7-0-3-1">
<p>
To create a packageble and distributable library module for the above <code>RecipyWithDep</code>, create this library module 
</p>

<pre class="example">
class RecipyWithDepLib packageLibraryUsing: manifest = (
  |
  RecipyWithDep = manifest RecipyWithDep.
  RecipyNoDep   = manifest RecipyNoDep.
  |
) 
(
  public buildUsing: platform = (
     |revertedTranslator|
     revertedTranslator:: RecipyWithDep 
                    usingPlatform: platform 
                    andModule: (RecipyNoDep new).
     ^revertedTranslator.
  )
)
</pre>

<p>
Note how the library must store any "carry along" (imported) classes on slots during packaging, then instantiate them during building. 
</p>

<p>
Also note how the passing of <code>platform</code> moves from the constructor in the module, to the instance method in the library:
</p>
<ul class="org-ul">
<li>In the module <code>RecipyWithDep</code> , it is on the <i>factory constructor</i> <i>#usingPlatform: platform:</i></li>
<li>To the distribution library <code>RecipyWithDepLib</code>, it is on the <i>instance method</i> <i>#buildUsing: platform</i>.</li>
</ul>

<p>
Although intended for distribution, for testing this process, the library can be used in workspace as 
</p>

<pre class="example">
|sortListTranslatorLib sortListTranslator |
(* this would run on the developer's packaging system *)
sortListTranslatorLib:: RecipyWithDepLib packageLibraryUsing: ide namespacing manifest.

(* this would run on end-user runtime system *)
sortListTranslator:: sortListTranslatorLib buildUsing: platform.

sortListTranslator translate: {' World'. 'Hello'}.
(* Expected result: 'Hallo Welt' output string just below the Workspace line *)
</pre>
</div>
</div>
</div>


<div id="outline-container-org818d945" class="outline-5">
<h5 id="org818d945"><span class="section-number-5">6.7.0.4</span> 4. App module: API of module that needs to be distributed as an App</h5>
<div class="outline-text-5" id="text-6-7-0-4">
<p>
This next step describes an example of a module which is intended to be distributable as an App. In Newspeak, <b>this means such module must be both packageble and runnable</b> - the roles of "packageble" and "runnable" are achieved by implementing the 2 methods below. We call such modules informally <i>App modules</i>. In addition, this App uses 
</p>

<p>
If we need our module <code>RecipyWithDep</code> to be packagable as an App:
</p>

<ol class="org-ol">
<li>Generally, add a <b>separate module</b> with a descriptive name (to make clear it is a App)</li>
<li>In this <b>separate module</b>, provide the following API:
<ul class="org-ul">
<li>Factory constructor <code>#packageUsing: manifest</code></li>
<li>Instance method     <code>#main: platform args: args</code></li>
</ul></li>
</ol>

<p>
<b>Note 1:</b>
</p>

<p>
We sometimes see Newspeak App modules lacking the <code>#main: platform args: args</code> method. Such modules are used as library modules.
</p>

<p>
<b>Note 2:</b>
</p>

<p>
Compare the parallel role between the following methods for a Library module and an App module:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Library</th>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">App</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">#packageLibraryUsing: manifest</td>
<td class="org-left">- has role of -</td>
<td class="org-left">#packageUsing: manifest</td>
</tr>

<tr>
<td class="org-left">#buildUsing: platform</td>
<td class="org-left">- has role of -</td>
<td class="org-left">#main: platform args: args</td>
</tr>
</tbody>
</table>

<p>
We see that the packaging methods are equivalent. The library "build" method is equivalent to the App "main" method. If an App uses a Library, the library's <code>#buildUsing: platform</code> will be called in the App's <code>#main: platform args: args</code> method to build (create) the library's instance.
</p>

<p>
Basically, a Library module and App module play a similar role. However, an App module is intended to be <b>packaged, distributed and run</b> as a standalone App, while an Library module is intended to be <b>packaged, distributed and included in App modules</b>.
</p>
</div>

<div id="outline-container-org0292410" class="outline-6">
<h6 id="org0292410"><span class="section-number-6">6.7.0.4.1</span> Example:</h6>
<div class="outline-text-6" id="text-6-7-0-4-1">
<p>
We will create an App module  <code>RecipyWithDepApp</code>, which is a bit more complex App, in the sense it uses a pre-existing library module, defined in <a href="#org0efa847">3. Library module: API of module that needs to be distributed for use in other modules</a>.
</p>

<p>
To create a packageble and runnable App module <code>RecipyWithDepApp</code>, it must have methods <code>#packageUsing: manifest</code> and <code>#main: platform args: args</code>.  The App must also store at it's slots everything the <code>RecipyWithDep</code> needs for it's instantiation. Here is the code:
</p>

<pre class="example">
class RecipyWithDepApp packageUsing: manifest = (
  |
  RecipyWithDep = manifest RecipyWithDep.
  RecipyNoDep   = manifest RecipyNoDep.
  |
) 
(
  public main: platform args: args = (
     |revertedTranslator|
     revertedTranslator::  RecipyWithDep 
                    usingPlatform: platform 
                    andModule: (RecipyNoDep new).

    (revertedTranslator translate: {' World'. 'Hello'}) out.
  )
)
</pre>

<p>
Note how the App (same as the library) must store any "carry along" (imported) classes on slots during packaging, then instantiate them in #main#args: at runtime (for library, at build time). 
</p>

<p>
Also note how the passing of <code>platform</code> moves from the constructor in the module to the instance method in the App:
</p>
<ul class="org-ul">
<li>In the module <code>RecipyWithDep</code> , it is on the <i>factory constructor</i> <i>#usingPlatform: platform:</i></li>
<li>To the App <code>RecipyWithDepApp</code>, it is on thr <i>instance method</i> <i>#main: platform args: args</i>.</li>
</ul>

<p>
Also note, as you add the App class <code>RecipyWithDepApp</code> in the IDE, (using the "+ " button ), the IDE shows  <b>[deploy] [configurations] [run] [debug]</b> links beside it, recognizing the top level class as an App. 
</p>
</div>
</div>
</div>


<div id="outline-container-orgb451316" class="outline-5">
<h5 id="orgb451316"><span class="section-number-5">6.7.0.5</span> <span class="todo TODO">TODO</span> 5. Test module: TODO</h5>
</div>

<div id="outline-container-orgbc1116c" class="outline-5">
<h5 id="orgbc1116c"><span class="section-number-5">6.7.0.6</span> <span class="todo TODO">TODO</span> 6. Test module configuration: TODO</h5>
</div>
</div>


<div id="outline-container-org3f7b274" class="outline-3">
<h3 id="org3f7b274"><span class="section-number-3">6.8</span> Hello World in Newspeak</h3>
<div class="outline-text-3" id="text-6-8">
</div>
<div id="outline-container-org8047503" class="outline-4">
<h4 id="org8047503"><span class="section-number-4">6.8.1</span> Section Summary</h4>
<div class="outline-text-4" id="text-6-8-1">
<p>
This section will show several ways to create a 'Hello World' program in Newspeak, using different methods in increasing complexity.  The initial versions are due to Gilad Bracha's answer on the Newspeak group <a href="https://groups.google.com/g/newspeaklanguage/c/Cq2Ej0_THew">https://groups.google.com/g/newspeaklanguage/c/Cq2Ej0_THew</a>
</p>

<p>
All Hello Worlds are created by starting the Newspeak online IDE at <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a>, then following the steps.
</p>
</div>
</div>


<div id="outline-container-org9128238" class="outline-4">
<h4 id="org9128238"><span class="section-number-4">6.8.2</span> 1. Hello World from Workspace</h4>
<div class="outline-text-4" id="text-6-8-2">
<p>
Workspace is like the command line or REPL in Newspeak.
</p>

<p>
Steps to run Hello World from Workspace 
</p>

<ul class="org-ul">
<li>Open Workspace</li>
<li>Type there (including quotes) <code>'Hello World from Workspace' out</code></li>
<li>Select the text</li>
<li>Press "Shift+Enter" - this takes the selected text and evaluates it's expressions.  The single expression is the message "#out" send to the text object.</li>
<li>Notice that 'Hello World from Workspace' appears both right below the line, and also at the bottom of the page.  The text at the bottom of the page was appended at the end of the DOM.  We will see text showing at the bottom of the page again in all examples.</li>
</ul>


<div id="org62dee22" class="figure">
<p><img src="/img/newspeak---a-few-notes.org-hello-world-workspace.png" alt="nil"/> 
</p>
</div>
</div>
</div>


<div id="outline-container-orgf5b8d03" class="outline-4">
<h4 id="orgf5b8d03"><span class="section-number-4">6.8.3</span> 2. Hello World from general module</h4>
<div class="outline-text-4" id="text-6-8-3">
<p>
In this section, we will build a Hello World which is a <i>module</i> (a <i>instance of top level class</i> as we know already).  The <a href="#org98fdcd0">Newspeak modules API summary</a> section would classify this as "General" module, because it does not have any of the special convention methods in it's API.  The only method of this class is it's default <i>factory constructor</i> <code>#new</code>.
</p>

<p>
Steps to create the Hello World general module in the Newspeak IDE's
</p>

<ul class="org-ul">
<li>In "Newspeak Source", on the top left, click the "+ " button next to the link "Root"</li>
<li>In the popup, select "Add Class"</li>
<li><p>
Replace the text under "Defining a new class" with
</p>
<pre class="example">
class HelloWorldGeneralModule = ('Hello World ' out)()
</pre></li>

<li>It should now look like
<img src="/img/newspeak---a-few-notes.org-hello-world-general-module.png" alt="nil"/></li>
<li>Click the "Accept" <img src="/img/newspeak---a-few-notes.org-accept-image.png" alt="nil"/></li>
<li>Now the class link "HelloWorldGeneralModule" will appear in the list of classes</li>
<li>Click on the class link, and the class presented appears
<img src="/img/newspeak---a-few-notes.org-hello-world-general-module-class-viewer.png" alt="nil"/></li>
<li>What happened?
<ul class="org-ul">
<li>First of all the "Hello World" shows on the bottom again.</li>
<li>How did it get there?
<ul class="org-ul">
<li>Clicking the class link, prepares to present the class.  In the IDE, the class is presented inside an instance of itself.  So, an instance of <code>HelloWorldGeneralModule</code> is created, by calling the implicit "#new" factory constructor.  The code of the factory constructor is <code>'Hello World ' out</code>.  This code, when running, appends the text to the end of the body.</li>
<li>Similarly, every time we just click on the &gt; in the class list beside the class, a new instance is created (to serve the presented, and one more 'Hello World' appears
<img src="/img/newspeak---a-few-notes.org-hello-world-3-times-after-body.png" alt="nil"/></li>
</ul></li>
</ul></li>
</ul>

<p>
This concludes the section on General Module class.  Before the next step, please reload the page, and select the third option to start fresh.  Alternatively, remove the class HelloWorldGeneralModule.  Presence would repeatedly output "Hello World" at the end of the page body.  Class deletion can be done by clicking on the three dot popup menu  beside the classname, and selecting "Remove HelloWorldGeneralModule"
<img src="/img/newspeak---a-few-notes.org-remove-class-from-3-dot-menu.png" alt="nil"/>
</p>


<p>
For a more complex example of a general module, see <a href="#orgd9476b0">1. General module with NO dependencies: API of module with no dependencies</a>
</p>
</div>
</div>


<div id="outline-container-orgc4a4799" class="outline-4">
<h4 id="orgc4a4799"><span class="section-number-4">6.8.4</span> 3. Hello World App</h4>
<div class="outline-text-4" id="text-6-8-4">
<p>
By now, we know that <i>modules</i> are <i>instances of top level classes</i>, see <a href="#org6e890f7">Discussion of Modules</a>.  In <a href="#org98fdcd0">Newspeak modules API summary</a> we have shown that providing modules with convention API methods understood by tools such as the IDE, modules can behave as Apps, Libraries, or Tests.
</p>

<p>
The <a href="#org98fdcd0">Newspeak modules API summary</a> describes the API for a module to be able to behave as an App on the Newspeak platform. 
</p>

<p>
So to create a Newspeak App (as opposed to a general module or a library), we need different API. Here are the steps to create the <code>HelloWorldApp</code> <b>application</b> in the Newspeak IDE's
</p>

<ul class="org-ul">
<li><p>
As shown in the previous section, click the "+ ", paste the following class to the IDE, and click the "Accept" button.
</p>
<pre class="example">
class HelloWorldApp packageUsing: manifest = ()
(
  public main: platform args: args = (
    'Hello World from HelloWorldApp' out.
  )
)
</pre></li>
<li>You should see the class in the top classes list.  However, (as opposed to previous section <code>HelloWorldGeneralModule</code>), our class has the links <b>[deploy] [configurations] [run] [debug]</b> beside it.  This is because the presence of <code>#packageUsing: manifest</code> makes the class an App.  The tools (the IDE) understand this message and use it to show actions that can be done with an App: run, debug, deploy, show available configurations.  In addition, the presence of another method, the <code>#main: platform args: args</code> makes the module runnable as a standalone App.</li>
<li>Click the <b>[run]</b> link to run the app inside the IDE.  The IDE calls first the <code>#packageUsing: manifest</code>, then the <code>#main: platform args: args</code> which runs, and the text 'Hello World from HelloWorldApp' will be appended after the page body.
<img src="/img/newspeak---a-few-notes.org-hello-world-app-output.png" alt="nil"/></li>
</ul>


<p>
<b>Next, we will show how to deploy our <code>HelloWorldApp</code> as a standalone App.</b>
</p>

<p>
From the section <a href="#orgaadf932">5.4</a> we know an App can be packaged and deployed standalone into a local Newspeak webserver.
</p>

<p>
Follow steps below to create a deployable app <code>HelloWorldApp.vfuel</code>, then deploy it in a local Newspeak installation.
</p>

<ul class="org-ul">
<li>Action: In the class list, find the <code>HelloWorldApp</code> again, and click the [deploy] to the right.</li>
<li>Result: a popup showing deployment options, starting with <code>asVictoryFuel</code>: <img src="/img/newspeak---a-few-notes.org-click-deploy-on-counter-app.png" alt="nil"/></li>
<li>Action: Select <code>asVictoryFuel</code>.  We choose the faster option 'asVictoryFuel' because our App does not have GUI.  Otherwise, we would select 'asVictoryFuelWithMirrors'</li>
<li>Result: After a long wait, a file named <code>HelloWorldApp.vfuel</code> is created, and asked to be saved.</li>
<li>Action: Save the file <code>HelloWorldApp.vfuel</code> on our disk to the directory where local Newspeak was deployed - for example <code>$HOME/software/newspeak/my-serve-http/servable</code></li>
<li>Result: <b>Assuming you installed you local Newspeak webserver as in e <a href="#org5383775">5.3</a>, the app is now deployed to the local Newspeak webserver!</b></li>
<li>Action: Navigate to <a href="http://localhost:8080/primordialsoup.html?snapshot=HelloWorldApp.vfuel">http://localhost:8080/primordialsoup.html?snapshot=HelloWorldApp.vfuel</a></li>
<li>Result: We see the output of the standalone-running app
<img src="/img/newspeak---a-few-notes.org-hello-world-app-standalone-output.png" alt="nil"/></li>
</ul>

<p>
This concludes the section on App Module class.  We have shown how to create an App, run it in IDE, create a deployable .vfuel file, then deploy the App standalone in local Newspeak webserver.
</p>

<p>
For a more complex example of an App module, see <a href="#org818d945">4. App module: API of module that needs to be distributed as an App</a>
</p>
</div>
</div>


<div id="outline-container-org7bffa18" class="outline-4">
<h4 id="org7bffa18"><span class="section-number-4">6.8.5</span> 4. Hello World App using 3rd party dependency</h4>
<div class="outline-text-4" id="text-6-8-5">
<p>
This section builds on previous sections to create an App, <code>HelloWorldAppUsingLib</code>  which depend on a 3rd party library module. 
</p>

<p>
Let's pretend our App can use a Newspeak module produced by a 3rd party (3rd party to us). Call the 3rd party the <i>TranslatorCorp</i>. Let's pretend <i>TranslatorCorp</i> provides the module <code>HelloTranslator</code>, packaged as <code>HelloTranslatorLib</code>.
</p>

<p>
<i>TranslatorCorp</i> would implement and package their modules as follows:
</p>

<pre class="example">
class HelloTranslator = ()
(
    public translate: text = (
      text = 'Hello World from HelloWorldApp' ifTrue: [^ 'Hallo Welt von HelloWorldApp'.].

      ^ 'unable to translate'.
    )  
)
</pre>

<pre class="example">
class HelloTranslatorLib packageLibraryUsing: manifest = (

    (* Library (distribution) class provides packaging and building of the HelloTranslator module *) 
    | 
    HelloTranslator = manifest HelloTranslator. 
    |
)
(
   public buildUsing: platform = (
     |helloTranslator|
     helloTranslator:: HelloTranslator new.

     ^helloTranslator.
   )
)
</pre>

<p>
Note that for every module the <i>TranslatorCorp</i> wants to distribute (such as <code>HelloTranslator</code>), they need to create a library module for packaging and disctribution(such as <code>HelloTranslatorLib</code>)
</p>

<p>
The <code>HelloTranslator</code>, hence the <code>HelloTranslatorLib</code> 
</p>
<ul class="org-ul">
<li>could have used (depended on) other module <code>HelloTRanslatorHelper</code>  developed by the <i>TranslatorCorp</i></li>
<li>and also depend on a module <code>LanguageSelectorLib</code> developed by another entity <i>LanguageCorp</i> (so <i>LanguageCorp</i> is "3rd party to <i>TranslatorCorp</i>).</li>
</ul>

<p>
Then, the <i>TranslatorCorp</i> would work in their helper module and the <i>LanguageCorp's</i> module as follows:
</p>

<pre class="example">
class HelloTranslatorLibWithMoreDependencies packageLibraryUsing: manifest = (

  (* This version of HelloTranslatorLib is not ready yet due to missing
     HelloTranslatorHelper and LanguageSelectorLib.
     Use the above version in your IDE experiments
  *)
  | 
  HelloTranslator = manifest HelloTranslator.
  HelloTranslatorHelper = manifest HelloTranslatorHelper.
  LanguageSelectorLib = manifest LanguageSelectorLib packageLibraryUsingManifest: manifest.
  |
)
(
  public buildUsing: platform = (
    |defaultlanguageSelector helloTranslator|

    defaultlanguageSelector = LanguageSelectorLib buildUsing: platform.

    helloTranslator = HelloTranslator
                        helpedBy: (HelloTranslatorHelper new)
                        with3rdPartyLanguageSelector: defaultlanguageSelector.
    (* or #usingPlatform:helpedBy:with3rdPartyLanguageSelector: if platform was needed *)

    ^helloTranslator.
  )
)
</pre>


<p>
Either way, we would develop our App by packaging the 3rd party dependency and storing it on slot as <code>helloTranslatorLib</code>, then at runtime, build instance of the <code>helloTranslator</code> using the packaged <code>helloTranslatorLib</code>, and last, calling the method on <code>helloTranslator</code> which performs the translation:
</p>

<p>
This is how the App <code>HelloWorldAppUsingLib</code> would look. 
</p>

<pre class="example">
class HelloWorldAppUsingLib packageUsing: manifest = (
  |
  helloTranslatorLib = manifest HelloTranslatorLib packageLibraryUsing: manifest.
  |
)
(
  public main: platform args: args = (
    |helloTranslator|
    helloTranslator:: helloTranslatorLib buildUsing: platform.

    (helloTranslator translate: 'Hello World from HelloWorldApp') out.
  )
)
</pre>

<p>
As shown in the previous section <a href="#orgc4a4799">3. Hello World App</a>, we can both run the App from the IDE, or package it a ".vfuel" file, and distribute to run as a standalone App from a local Newspeak webserver (or as an Electon based on Android, iOS, or desktop, but this is not shown yet).
</p>

<p>
This concludes the 'Hello World' section, as well as the broader section <a href="#org427a0ce">Newspeak is different.  An ide-driven journey around the Newspeak platform</a>.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-orgc577a6a" class="outline-2">
<h2 id="orgc577a6a"><span class="section-number-2">7</span> Newspeak: Using it and installing it.  Online vs.  local installation</h2>
<div class="outline-text-2" id="text-7">
<p>
TL;DR There are several ways of using Newspeak:
</p>
<ul class="org-ul">
<li>Using Newspeak online web version from browser.  No installation required, see <a href="#org8825ff5">Installation method 1 (online, no local installation)</a></li>
<li>Using Newspeak locally from browser, after installing your local Newspeak webserver, see <a href="#org541fe06">Installation method 2 (local Newspeak webserver)</a></li>
<li>Using Newspeak on desktop or as a mobile App, see <a href="#org28ccd5c">Chapter System specific methods to install and run Newspeak</a>.  This includes installing and using an Electron-based version in <a href="#org5579420">Installation method 3</a>.</li>
</ul>

<p>
This section is describing all usage ways and installation methods.  Initially, users should consider either <a href="#org8825ff5">Installation method 1 (online, no local installation)</a> or <a href="#org541fe06">Installation method 2 (local Newspeak webserver)</a>.
</p>

<p>
In this hands-on document we use the Newspeak online version for most chapters; when describing installable Apps, we use the local Newspeak webserver. 
</p>
</div>

<div id="outline-container-orge001de9" class="outline-3">
<h3 id="orge001de9"><span class="section-number-3">7.1</span> Simple methods to install and run Newspeak</h3>
<div class="outline-text-3" id="text-7-1">
</div>
<div id="outline-container-org362edd2" class="outline-4">
<h4 id="org362edd2"><span class="section-number-4">7.1.1</span> <a id="org8825ff5"></a> Installation method 1: No installation or setup, run Newspeak online</h4>
<div class="outline-text-4" id="text-7-1-1">
<p>
TL;DR: This section describes the simplest setup - in fact, this is a "no setup, no installation" method.  We only need a browser and internet access.  This is the recommended method to start with Newspeak.
</p>

<ul class="org-ul">
<li>Action: Navigate your browser to Newspeak online at <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a>,</li>
<li>Result: You should see a page similar to this</li>
</ul>


<div id="org85bcf97" class="figure">
<p><img src="/img/newspeak---a-few-notes.org-newspeak-ide-start.png" alt="nil"/>
</p>
</div>


<p>
Notes:
</p>

<ul class="org-ul">
<li>By using this page, you are now using the Newspeak IDE</li>
<li>click the "Newspeak Source" link to view code, edit edit code and manipulate code.</li>
<li>Your changes will be stored in the browser local storage.</li>
<li>A more detailed description of what we can do with Newspeak is in the introduction section <a href="#org17c8680">5.1</a></li>
</ul>
</div>
</div>


<div id="outline-container-org8609b11" class="outline-4">
<h4 id="org8609b11"><span class="section-number-4">7.1.2</span> <a id="org541fe06"></a> Installation method 2: Download and start a local Newspeak webserver</h4>
<div class="outline-text-4" id="text-7-1-2">
<p>
This method downloads a pre-packaged Newspeak, and allows you to start your local Newspeak webserver, which starts the pre-packaged Newspeak.  This method is described in detail in the "hands on" section <a href="#org5383775">5.3</a>.  Follow the steps there.
</p>

<p>
Differences of this installation from using Newspeak online described in <a href="#org8825ff5">Installation method 1 (online, no local installation)</a>
</p>
<ul class="org-ul">
<li>If we install using this method 2 (local Newspeak webserver):</li>
<li>Pros:
<ul class="org-ul">
<li>No need for internet access</li>
<li>Your version does not change if you need stability (this may be a cons too)</li>
</ul></li>
<li>Cons:
<ul class="org-ul">
<li>We have to run our own Newspeak server, and reinstall to care of any updates or bugs fixed.</li>
</ul></li>
</ul>
</div>
</div>


<div id="outline-container-org3c90d9c" class="outline-4">
<h4 id="org3c90d9c"><span class="section-number-4">7.1.3</span> <a id="org1e17444"></a> Installation method 3: Download or setup a local Electron version of Newspeak on MacOS or Windows</h4>
<div class="outline-text-4" id="text-7-1-3">
<p>
To install using this method, download the available versions for Windows and Mac, see <a href="https://newspeaklanguage.org/downloads.html">https://newspeaklanguage.org/downloads.html</a>, section "Downloadable IDE App". 
</p>

<p>
Electron is basically Chromium underneath.  It's just set up to read from a page that's built in to the app.  So no server needs to be started.  It starts with starting the app.
</p>

<p>
An advantage of Electron that I have seen is a better integration with OS File access dialogues.  It doesn't insist on using a downloads directory for everything (and while browsers let you set the directory, they don't let you change it on the fly, on a file-by-file basis).
</p>
</div>
</div>
</div>


<div id="outline-container-org28ccd5c" class="outline-3">
<h3 id="org28ccd5c"><span class="section-number-3">7.2</span> System specific methods to install and run Newspeak</h3>
<div class="outline-text-3" id="text-7-2">
</div>
<div id="outline-container-org68de2cb" class="outline-4">
<h4 id="org68de2cb"><span class="section-number-4">7.2.1</span> <a id="org5579420"></a> Installation method 4: Setup a local Newspeak webserver from code on Github.</h4>
<div class="outline-text-4" id="text-7-2-1">
<p>
This method is described in the "Just in Case" section in <a href="https://github.com/newspeaklanguage/newspeak">https://github.com/newspeaklanguage/newspeak</a>.
</p>
</div>
</div>


<div id="outline-container-orgfde56e0" class="outline-4">
<h4 id="orgfde56e0"><span class="section-number-4">7.2.2</span> <a id="org5a0f105"></a> Installation method 5: Manual setup which will produce an equivalent of <a href="#org541fe06">Installation method 2 (local Newspeak webserver)</a></h4>
<div class="outline-text-4" id="text-7-2-2">
<p>
As this method produces an equivalent that is already downloadable, this is only if we want to dig in more details, but not going all the way to doing all the steps in <a href="#org5579420">Installation method 4</a>.
</p>

<p>
If the build isn't working for you there is one option that hasn't been discussed, which is relevant to Linux folk who don't have an Electron app.  You can get the web IDE vfuel file at:
</p>

<p>
<a href="https://newspeaklanguage.org/samples/HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/HopscotchWebIDE.vfuel</a> 
</p>

<p>
BUT &#x2026;  this isn't enough because you need a bunch more stuff, such as primordialsoup.html, primordialsoup.js, primordialsoup.wasm.
If you run that, you'll find that you also need a longish list of .png files for the various images used by the IDE.  Here they are (probably a few that are no longer used too).
</p>

<p>
accept16px.png				hsHistoryDownImage.png
accept16pxDown.png			hsHistoryImage.png
accept16pxOver.png			hsHistoryOutImage.png
arrowGreenLeft.png			hsHistoryOverImage.png
arrowGreenRight.png			hsHomeDownImage.png
arrowOrangeLeft.png			hsHomeImage.png
cancel16px.png				hsHomeOutImage.png
cancel16pxDown.png			hsHomeOverImage.png
cancel16pxOver.png			hsNewDownImage.png
classPresenterImage.png			hsNewImage.png
classUnknownImage.png			hsNewOutImage.png
clearImage.png				hsNewOverImage.png
conflictRed.png				hsRefreshDownImage.png
disclosureClosedImage.png		hsRefreshImage.png
disclosureMinusImage.png		hsRefreshOutImage.png
disclosureOpenImage.png			hsRefreshOverImage.png
disclosurePlusImage.png			hsReorderDownImage.png
disclosureTransitionImage.png		hsReorderImage.png
downloadImage.png			hsReorderOutImage.png
editImage.png				hsReorderOverImage.png
findImage.png				hsToolsDownImage.png
findSquareLeftDownImage.png		hsToolsImage.png
findSquareLeftImage.png			hsToolsOutImage.png
findSquareLeftOutImage.png		hsToolsOverImage.png
findSquareLeftOverImage.png		itemBothOverride.png
helpImage.png				itemDeleteImage.png
hsAddDownImage.png			itemMenuImage.png
hsAddImage.png				itemReferencesImage.png
hsAddOutImage.png			itemSubOverride.png
hsAddOverImage.png			itemSuperOverride.png
hsBackDownImage.png			languageJS.png
hsBackImage.png				languageM.png
hsBackOutImage.png			languageNewspeak3.png
hsBackOverImage.png			languageSmalltalk.png
hsCollapseDownImage.png			menu16px.png
hsCollapseImage.png			menu16pxDown.png
hsCollapseOutImage.png			menu16pxOver.png
hsCollapseOverImage.png			menuButtonImage.png
hsDropdownDownImage.png			metaMenuDownImage.png
hsDropdownImage.png			metaMenuImage.png
hsDropdownOutImage.png			metaMenuOutImage.png
hsDropdownOverImage.png			metaMenuOverImage.png
hsExpandDownImage.png			operateMenuDownImage.png
hsExpandImage.png			operateMenuImage.png
hsExpandOutImage.png			operateMenuOutImage.png
hsExpandOverImage.png			operateMenuOverImage.png
hsFindDownImage.png			peekingeye1610.png
hsFindImage.png				privateImage.png
hsFindOutImage.png			protectedImage.png
hsFindOverImage.png			publicImage.png
hsForwardDownImage.png			repositoryGit.png
hsForwardImage.png			repositoryMercurial.png
hsForwardOutImage.png			saveImage.png
hsForwardOverImage.png			tinySubclassResponsibilityImage.png
</p>

<p>
You can place it all in the directory of your choice and serve from there (the serve.sh script wants it in the repo, in the out directory).
It seems easier to build, but I'm putting it out there.
</p>
</div>
</div>
</div>
</div>



<div id="outline-container-org2cdf4f7" class="outline-2">
<h2 id="org2cdf4f7"><span class="section-number-2">8</span> <span class="todo IN_PROGRESS">IN-PROGRESS</span> Programming in Newspeak</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-orgcd8c075" class="outline-3">
<h3 id="orgcd8c075"><span class="section-number-3">8.1</span> The Newspeak IDE</h3>
<div class="outline-text-3" id="text-8-1">
</div>
<div id="outline-container-org899c43c" class="outline-4">
<h4 id="org899c43c"><span class="section-number-4">8.1.1</span> Updating the IDE</h4>
<div class="outline-text-4" id="text-8-1-1">
<p>
How to update the IDE? The answer differs depending on what version you are using.
</p>
</div>

<div id="outline-container-org2d7d91c" class="outline-5">
<h5 id="org2d7d91c"><span class="section-number-5">8.1.1.1</span> Updating the online version</h5>
<div class="outline-text-5" id="text-8-1-1-1">
<p>
If you use Newspeak as online from <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a>, no updating is necessary.  If a newer version is installed online, a reload will update.
</p>

<p>
After the update, the system will ask user if to re-apply your browser-local storage changes from the <i>backup</i> and <i>lastSaved</i>.  For details of the local changes re-application, see <a href="#orgafd7607">Saving changes in Newspeak</a>.
</p>
</div>
</div>

<div id="outline-container-org67c8205" class="outline-5">
<h5 id="org67c8205"><span class="section-number-5">8.1.1.2</span> Updating your local Newspeak webserver, installed for all platforms as shown in <a href="#org541fe06">Installation method 2 (local Newspeak webserver)</a>.</h5>
<div class="outline-text-5" id="text-8-1-1-2">
<p>
To update your local Newspeak webserver to the latest (thus getting fixes done since the last deployment), re-download and unzip as described in <a href="#org5383775">5.3</a>
</p>
</div>
</div>
</div>


<div id="outline-container-org2853966" class="outline-4">
<h4 id="org2853966"><span class="section-number-4">8.1.2</span> Updading a single class that was fixed on Github source into local Newspeak webserver (thus IDE)</h4>
<div class="outline-text-4" id="text-8-1-2">
<p>
Could there be situations we do not want to simply reinstall the local Newspeak webserver? Perhaps one example of such situation is that we run our local Newspeak webserver with changed files, and we want to patch a class that has a known fix, without reinstalling the local Newspeak webserver and losing changes.
</p>

<p>
To describe a concrete (somewhat artificial) situation: Let's say that on Github, there is a bug fix or change in a 'system' class, <code>Browsing.ns</code>, and we want to update this single class locally.  We can identify changed files or files with fixes, and compile them in (that is, start using them in) the local version, using the following process:
</p>

<ul class="org-ul">
<li>Look for files committed on Github.</li>
<li>Find files changed since your last local install - let's say file <code>Browsing.ns</code> changed today to fix a bug.  As your local server uses the servable.zip file, <code>Browser.ns</code> is already compiled in your local vfuel.</li>
<li>So from the browser IDE, <a href="http://localhost:8080/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">http://localhost:8080/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a> from the 3-dot I "compile" the new version of Browsing.ns</li>
<li>Save the changes from IDE (clicking the save diskette image)</li>
<li>You can confirm that your changes were "Compile"d, by exporting of Browsing.ns (click the "Save to file" button to export the code).</li>
<li>The result of the above process is your local server are now using the github-fixed <code>Browsing.ns</code>.</li>
</ul>
</div>
</div>
</div>



<div id="outline-container-orgafd7607" class="outline-3">
<h3 id="orgafd7607"><span class="section-number-3">8.2</span> Saving changes in Newspeak</h3>
<div class="outline-text-3" id="text-8-2">
<p>
TL;DR: Changes can be saved either <i>inside the browser</i> in the browser's local storage, or, <i>outside the browser</i> on the filesystem.  Any changes you make (for example: you add a class, change a class, evaluate something in the workspace) are stored in the browser local storage in two entries: <b>lastSaved</b> and <b>backup</b>.  Clicking the "Accept" button  <img src="/img/newspeak---a-few-notes.org-accept-image.png" alt="nil"/> saves the changes in local storage under the key <i>backup</i>, while clicking the "Save" button <img src="/img/newspeak---a-few-notes.org-save-button.png" alt="nil"/>, at any time after "Accept", saves the changes under the key <i>lastSaved</i>.  Alternatively, you can `export` code by clicking the "three dot menu" button to the right of the class, then clicking the "Save to file" item in the popup menu.  You can `import` code by clicking the "three dot menu" on the top, to the right of "Root +", then selecting the "Compile File(s)" in the popup menu.
</p>
</div>

<div id="outline-container-org1aa0e14" class="outline-4">
<h4 id="org1aa0e14"><span class="section-number-4">8.2.1</span> Saving changes inside the browser</h4>
<div class="outline-text-4" id="text-8-2-1">
<p>
How is the browser local storage handled, and how is <i>lastSaved</i> different from <i>backup</i>? Here is a detail description of how changes are saved and restored:
</p>

<ul class="org-ul">
<li>After making any code change or addition, to keep your changes, you have to click the "Accept" button <img src="/img/newspeak---a-few-notes.org-accept-image.png" alt="nil"/>.  Clicking "Accept" saves the changes in local storage under the key <i>backup</i>.</li>
<li>while</li>
<li>Clicking the "Save" button <img src="/img/newspeak---a-few-notes.org-save-button.png" alt="nil"/>, at any time after "Accept", saves the changes under the key <i>lastSaved</i> (the changes under <i>backup</i> are added and merged in to the changes under <i>lastSaved</i>).  Once saved using the "Save" button, changes are stored "forever", unless you reset browser local storage for the site.  We need to clarify, that making a change, followed by just clicking "Save" without a previous "Accept", nothing is saved.  So "Accept" and "Save" are sort of like two phase commit.</li>
<li>You can view the changes made, in the browser debugger.  For example, in Chrome or Chromium:
<ul class="org-ul">
<li>Press F12 to open Chrome debuger.</li>
<li>Then click the "Application" tab.</li>
<li>In the "Storage" section expand "Local Storage".</li>
<li>You can see our changes in the appropriate URL, both under the key <i>lastSaved</i> and the key <i>backup</i>.</li>
</ul></li>

<li>How does the/lastSaved/ and <i>backup</i> system work on browser restart? On restart, the Newspeak system checks to see if there are any changes under the key <i>backup</i> and/or under the key <i>lastSaved</i>.  If <i>lastSaved</i> changes exists, we check if there are any subsequent changes under <i>backup</i>.  If not, we use the <i>lastSaved</i> version.  If there are unsaved changes (<i>backup</i> entry exists), a dialog will come up asking you how to proceed:  <img src="/img/newspeak---a-few-notes.org-message-restore-from-backup.png" alt="nil"/>
<ul class="org-ul">
<li>This message tells us, we did make code changes, then clicked "Accept" <img src="/img/newspeak---a-few-notes.org-accept-image.png" alt="nil"/>, without pressing "Save" <img src="/img/newspeak---a-few-notes.org-save-button.png" alt="nil"/>, and reloaded the page.  In other words, changes are stored under the key <i>backup</i> but not(yet) under <i>lastSaved</i>.  In most situations, pressing <b>Restore from backup</b> is the best choice.  Your code will load the changes from the <i>backup</i> key, and contain all your changes.  At any time, you can click "Save" and merge the <i>backup</i> changes to <i>lastSaved</i>.</li>
<li>For search purposes, here is the text of the message: "You have backup changes that are newer than your last save.  Do you want to restore these changes, or load from the last save?"</li>
</ul></li>

<li>Note: There is a fine point we should make.  Crudely, we can say that "the Newspeak IDE is the file <code>HopscotchWebIDE.vfuel</code> interpreted by the browser when pointing to the URL <a href="https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel">https://newspeaklanguage.org/samples/primordialsoup.html?snapshot=HopscotchWebIDE.vfuel</a>.  However, we need to realize that the browser immediately downloads and caches this file.  Changing anything in Newspeak (adding a class, typing to the Workspace), causes the changes to be saved locally.  If we close the browser, and visit the same online URL again, we will see the site as we left it - with the local changes "added" to the vanilla Newspeak IDE! Which local changes are "added" (<i>backup</i> or <i>lastSaved</i> or both), is determined by your answer to the dialog above.</li>

<li>Caveats: There are a few caveats - a few classes are exempt from this "backup" and "lastSaved" method, due to bootstrap issues (things like KernelForPrimordialSoup and HopscotchWebIDE).  If you tamper with these - save the class explicitly! Also, web storage can surprise you on mobile platforms, where things can be thrown out after a certain amount of time (7 days on iOS?) and the system as a whole may exhibit bugs.</li>
</ul>
</div>
</div>

<div id="outline-container-orga7e210e" class="outline-4">
<h4 id="orga7e210e"><span class="section-number-4">8.2.2</span> Saving changes outside the browser:</h4>
<div class="outline-text-4" id="text-8-2-2">
<p>
Apart from the <i>lastSaved</i> and <i>backup</i> in-browser changes management, you can save changes outside the browser.  This is typically needed for development.
</p>


<ul class="org-ul">
<li>If you do clear your browser local storage, your changes will be lost, so saving outside the browser is valuable.</li>

<li>During development in Newspeak, you will want to save your work.  Until source control is integrated into the IDE, the current approach is to `export` ("Save to file") all classes you changed in a directory on your system as <b>.ns</b> files, and potentially create a code repository in that directory.  If we later want for Newspeak to use the repository version, we ("Compile File(s)") the <b>.ns</b> files back to Newspeak.  For how to access the "Save to file" and "Compile File(s)" buttons, see TL;DR in section <a href="#orgafd7607">Chapter Saving changes in Newspeak</a></li>
</ul>
</div>
</div>
</div>



<div id="outline-container-orga43a173" class="outline-3">
<h3 id="orga43a173"><span class="section-number-3">8.3</span> <span class="todo IN_PROGRESS_NOW">IN-PROGRESS-NOW</span> Snippets of wisdom from various sources</h3>
<div class="outline-text-3" id="text-8-3">
<p>
<b>Sources are rarely listed by URL BUT are generally those in <a href="#org3d484da">This document: Introduction to Newspeak on Webassembly (Wasm)</a>: Newspeak website, Room 101 and Newspeak user group.</b>
</p>

<p>
Snippets of wisdom
</p>


<ul class="org-ul">
<li>This is a recipy how to implement what would be static variables in other languages: Anything that you expected to put in a static variable goes in an instance variable of a module. What about singleton classes? How do I ensure that there is only one instance? The easiest way is to initialize a read only slot of a module with an object literal. What happens if there are multiple instances of the module declaration? Well, each module has its own "singleton". That's exactly what happens with singleton classes in Java when they are defined by multiple class loaders.</li>
<li>From <a href="https://bracha.org/newspeak-modules.pdf">https://bracha.org/newspeak-modules.pdf</a> Like Self, all computation - even an object's own access to its internal structure  is performed by invoking methods on objects. Newspeak is class-based. Classes can be nested arbitrarily. Since all names denote method invocations, all classes are virtual; in particular, superclasses are virtual, so all classes act as mixins. Unlike its predecessors, there is no static state in Newspeak, nor is there a global namespace. Modularity in Newspeak is based exclusively on class nesting. There are no separate modularity constructs such as packages. Top level classes act as module definitions, which are independent, immutable, self-contained parametric namespaces. They can be instantiated into modules which may be stateful and mutually recursive.</li>
<li><p>
StringTest&gt;&gt;#testShout is the Smalltalk way of identifying the testShout method of the StringTest class.  When you actually type the code into the browser, you don't have to type the class name or the &gt;&gt;; instead, you just make sure that the appropriate class is selected.  Documentation example in text should show abstract argument names:
</p>
<pre class="example" id="org0d972bc">
History&gt;&gt;goBackward
  self canGoBackward ifFalse: [self error: 'Already on the first element'].
  stream skip: --2.
  ^ self next.

History&gt;&gt;goTo: aPage
  stream nextPut: aPage.
</pre></li>
<li><p>
In Newspeak, a top level class declaration is always a module declaration.  So this is a module:
</p>
<pre class="example">
class HelloBraveNewWorld usingPlatform: platform = (
  platform squeak Transcript open show: 'Hello, Oh Brave new world'.
)
</pre>
<p>
If we had written
</p>
<pre class="example">
class HelloBraveNewWorld = (
  Transcript open show: 'Hello, Oh Brave new world'.
)
</pre>
<p>
and then created an instance via <code>HelloBraveNewWorld new</code> (if a class doesn't specify a message for creating instances, new is the default), we would get a doesNotUnderstand: error, because HelloBraveNewWorld does not understand the message Transcript.  There simply is no way to access the standard output stream, or any other system state, without having it passed in via a parameter when a module is instantiated.
</p></li>
<li>Workspace evaluation
<ul class="org-ul">
<li><code>ide namespacing manifest Collections</code> (* Collections class *)</li>
<li><code>collections</code>  (* instance of CollectionForPrimodialSoup *)</li>
<li><code>(ide namespacing manifest ATranslation) new translate: 'aaa'</code> (* 'cannot translate', good *)</li>
</ul></li>
<li>If you are learning, make everything public.  everything = each method, slot, and inner class.  It may not be the right thing, but it helps as the error messages are not the best currently.  You will just get "Does not understand" too many times.  First time it took me a day to figure out hehe.</li>
<li>so, basically, if I have an HTML string with a &lt;div class='helpButton'&gt;, this code in ClassPresenter&gt;&gt;helpText:  can insert a Hopscotch(?) instance of  HelpButton (assuming HelpButton was implemented) and the HelpButton instance will present itself as Html on that div? Hmm, maybe that org-to-ampleforth just got more exciting - but I have to hold myselt. &#x2013; answer: Pretty much.  You need to define the mapping from div classes to Newspeak widgets, as ClassPresenter&gt;&gt;helpText: does for the widgets it uses.</li>
<li>Library is an informal term.  Any Newspeak module definition (i.e., a top level class) is a library, and to use, it you call its class methods, most likely to instantiate it. If you want to deploy a module, you need to use it via an app (i.e, define something with #packageUsing: and #main:args:), directly or indirectly.</li>
<li>Hopscotch: Compositionality is one of the most crucial, and most often overlooked, properties in software design; it's what sets Hopscotch apart.</li>
</ul>
</div>
</div>
</div>



<div id="outline-container-orge701dcb" class="outline-2">
<h2 id="orge701dcb"><span class="section-number-2">9</span> <span class="todo IN_PROGRESS">IN-PROGRESS</span> Q&amp;A - answers should be either here directly, or link to an earlier section</h2>
<div class="outline-text-2" id="text-9">
<p>
Much of this Q&amp;A is sourced and expanded, or simply pasted from the Newspeak google group posts at <a href="https://groups.google.com/g/newspeaklanguage">https://groups.google.com/g/newspeaklanguage</a>
</p>
</div>


<div id="outline-container-org3c1c3d3" class="outline-3">
<h3 id="org3c1c3d3"><span class="section-number-3">9.1</span> How do I save my changes?</h3>
<div class="outline-text-3" id="text-9-1">
<p>
Newspeak doesn't have an image.  So what do I actually do to develop software? I mean, I presume I run a copy of Newspeak somehow, and start adding classes to it.  But then where / how do my additions get saved if there isn't an image? When I've added a couple of classes to a running Newspeak environment, I presume they don't just disappear when I switch my computer off? So where do they go? Or where do I put them?
</p>

<p>
Changes in Newspeak are always saved locally, as long as you click the "Accept" button after making changes.
</p>

<p>
It won't save your state, but it will save your code.  Bear in mind that the web-based system is young and will crash occasionally, but also that <b>the system saves your changes as backup regardless of whether you saved explicitly</b>. 
</p>

<p>
For a complete discussion, see <a href="#orgafd7607">Chapter Saving changes in Newspeak</a>.
</p>
</div>
</div>


<div id="outline-container-org35d76b7" class="outline-3">
<h3 id="org35d76b7"><span class="section-number-3">9.2</span> How would I build and deploy a Newspeak application?</h3>
<div class="outline-text-3" id="text-9-2">
<p>
For <code>HelloWorldApp</code>, see <a href="#org3f7b274">Hello World in Newspeak</a>.
</p>

<p>
For the <code>CounterApp</code> example, see section <a href="#orgba53dc6">5.2</a>
</p>
</div>
</div>



<div id="outline-container-orgd61b4a2" class="outline-3">
<h3 id="orgd61b4a2"><span class="section-number-3">9.3</span> How do I bring dependencies into modules to be distributed?</h3>
<div class="outline-text-3" id="text-9-3">
<p>
As discussed in <a href="#orgb4743ce">Dependencies and modularity: Perhaps the hardest part of Newspeak difference</a>:
</p>

<ul class="org-ul">
<li>Due to Newspeak's modularity, the process of bringing dependencies into a Newspeak program is different from mainstream language platforms. See the above linked section for an introduction and more links regarding dependencies in Newspeak.</li>
<li>The <code>manifest</code> and <code>platform</code> objects, along with the module APIs where these objects are used, are the mechanism to bring dependencies into modules (and their nested classes and their instances).</li>
</ul>

<p>
Folow the above link and also the <a href="#org3f7b274">Hello World in Newspeak</a> section for concrete examples of bringing dependencies.
</p>

<p>
Text below provides an additional example introduced by Gilad Bracha on the Newspeak Google groups list.
</p>

<p>
Imagine a convention whereby <b>every library intended for distribution is sent out as a class which:</b>
</p>

<ul class="org-ul">
<li>has a factory (or in general, class method) method <code>#packageLibraryUsingManifest: manifest</code> -</li>
<li>has a <code>#buildUsing: platform</code> method - this method, given a platform object, produces a working instance of the module we actually want to distribute</li>
</ul>

<p>
Now developer A (Alice) intends to distribute a module MyMod1.
It depends on some other code she developed, say, MyMod2, which in turn depends on a 3rd party library from developer B (Bob).
The module Alice distributes is below.
</p>

<pre class="example">
class MyMod1DistributionLib packageLibraryUsingManifest: manifest = ( 
 (* packageManager: ...  metadata describing the expected dependencies *)
  |
  MyMod1 = manifest MyMod1.
  MyMod2 = manifest MyMod2.
  My3rdPartyDep = manifest My3rdPartyDep packageLibraryUsingManifest: manifest.
  |
) (
   public buildUsing: platform = (
      |
      my3rdPartDependency = My3rdPartyDep buildUsing: platform.
      myMod2 = MyMod2 usingPlatform: platform and: my3rdPartDependency.
      myMod1 = MyMod1 usingPlatform: platform mod2: myMod2.
      |
     ^myMod1
   )
)
</pre>

<p>
The <code>#build: platform</code> method encapsulates the knowledge of how to build Alice's code, using an internal library she wrote (MyMod2) and Bob's library.  
</p>

<p>
Note that Alice is using the same convention as Bob, and builds Bob's code with no knowledge of its internal dependencies.
Developer C (Carol) uses these same conventions to build Alice's code.  She can do so regardless of whether
</p>
<ul class="org-ul">
<li>she is <b>building an app</b> (where she'd call <code>#packageLibraryUsing: manifest</code> from the app's factory, and <code>#build: platform</code> from <code>#main: platform args: args</code></li>
<li>or she is <b>building another library</b> (where she'd call <code>#packageLibraryUsing:</code> from the library factory).</li>
</ul>

<p>
If Alice decides to replace Bob's code with code from developer D (David), she changes MyModules, but Carol's code does not change.  Likewise, if Bob or David change their dependencies, neither Alice nor Carol change their code.
</p>

<p>
It isn't necessary for everyone to follow the exact same convention - what's critical is that a given module maintains its convention so its build API is stable.  Of course, a common convention is good, especially for tools. 
</p>

<p>
Alice could just distribute an instance of MyModules, but this hard-wires the versions of all the dependencies.  Assuming she doesn't do that, it is true that Carol needs to download all the pieces and their sub-pieces from Bob and Alice etc.  She loads them into the IDE (or the IDE does so by reading the metadata) and the IDE's namespace is used to produce the manifest object passed in when anyone builds an app.
</p>

<p>
Note that <code>platform</code> and <code>manifest</code> need are quite different.  Manifests are a development thing.  Platforms are a deployment thing.
</p>

<ul class="org-ul">
<li><code>Platforms</code> are for runtime capabilities and are security critical.  The platform is something that gives you the only connections to the world outside Newspeak.</li>
<li><code>Manifest</code> are for code construction (see <code>#packageUsing: manifest</code>).  The Newspeak IDE provides a global namespace, which is a real object that you can pass around.  That object is a manifest.</li>
</ul>


<p>
Anyway, hopefully this helps to answer the question. 
</p>

<p>
&#x2013;
Cheers, Gilad
Gilad Bracha
29 Apr 2021, 19:32:52
to newspeak&#x2026;@googlegroups.com
(slightly edited and merged from other posts by Milan Zimmermann)
</p>
</div>
</div>


<div id="outline-container-org15a4f6c" class="outline-3">
<h3 id="org15a4f6c"><span class="section-number-3">9.4</span> When or why to refresh the online IDE?</h3>
<div class="outline-text-3" id="text-9-4">
<p>
Why will you refresh? Apart from the odd crash, the more common problem is the performance issues that have been discussed in this forum in December/January.  Basically, we have an unresolved problem that the system slows down painfully under prolonged/heavy use.  Refreshing and loading from backup works fairly well.  This is obviously unacceptable as you lose IDE state (debuggers, workspace/inspector contents, unsaved editors, presenter state such as what method presenters are expanded or collapsed) but it's better than an unresponsive (sluggish to dead) system.
</p>
</div>
</div>


<div id="outline-container-org2400758" class="outline-3">
<h3 id="org2400758"><span class="section-number-3">9.5</span> Why do some classes show the [deploy] [run] [debug[ links?</h3>
<div class="outline-text-3" id="text-9-5">
<p>
Only classes that the IDE considers apps (applications) show these links.
</p>

<p>
IDE concludes a class is an app based on a convention: the presence of the method <code>#packageUsing: manifest</code>.
</p>

<p>
For details see  <a href="#org98fdcd0">Newspeak modules API summary</a> and <a href="#org3f7b274">Hello World in Newspeak</a>.
</p>
</div>
</div>


<div id="outline-container-org9bf4124" class="outline-3">
<h3 id="org9bf4124"><span class="section-number-3">9.6</span> Why do some test classes show the [run tests] [show tests] links?</h3>
<div class="outline-text-3" id="text-9-6">
<p>
Only classes that the IDE considers a test configuration show these links.
</p>

<p>
IDE concludes a class is an app based on a convention: the presence of the method  <code>#packageTestsUsing: manifest</code>.
</p>

<p>
For details see <a href="#org98fdcd0">Newspeak modules API summary</a>.
</p>
</div>
</div>


<div id="outline-container-org87db60b" class="outline-3">
<h3 id="org87db60b"><span class="section-number-3">9.7</span> How would I create and distribute a Newspeak App to run on the web, on mobile, or on desktop?</h3>
<div class="outline-text-3" id="text-9-7">
<p>
TL;DR: For a detail description of developing, packaging, running and deploying a concrete Newspeak app, read the section <a href="#org8b291c4">5</a>. This process is also described more succintly in the 'Hello World' programs section <a href="#orgc4a4799">3. Hello World App</a>.
</p>

<p>
The text below is a general introduction of how a Newspeak App can be made ready for deployment.
</p>

<p>
How would I go about building and running a "Hello world" application? I know I can create a class, in the browser IDE ..  ok ..  but from there, how to I "create and deploy the application" so I end up with something like the Todo app &#x2026;  any high level notes on that?
</p>

<p>
<b>There are two options to build an app</b>
</p>

<ol class="org-ol">
<li>Easy but flaky.  There is a 'deploy' option that the IDE displays
for apps.  It's buggy and slow, but mostly works if you are
prepared to wait a ridiculous amount of time, and tolerate the fact
that the app will be too large due to bugs in the serialization
code :-(.  We need to fix that, but you can deploy apps that way,
especially if they are small.  You choose the option
'asVictoryFuelWithMirrors' if your app uses the GUI (there's some, probably gratuitous, mirror dependency in the UI)  and 'asVictoryFuel' otherwise.
<ul class="org-ul">
<li>Details:  where is the [deploy] button.  Go to "Newspeak source".  Look at HopscotchWebIDE class (it's the one app pre-loaded in the system).  You'll see the deploy link in two places.  In the Root namespace itself - if your window is wide enough, it will show on the same line as the link for the class.  If you open the class, it will be at the top, to the right of the class name.</li>
</ul></li>

<li>Slightly more complex, but works better.  You use a script that runs the C version of the PSoup VM to do  the deployment.  This is faster, more reliable and produces smaller deployments.</li>
</ol>

<p>
In either case, .vfuel file is produced.  Assuming you are running Newspeak using option 1 (a local server, <a href="#org8825ff5">7.1.1</a>), you can then serve that file and run your app.
</p>

<p>
<b>Deployment of the app</b>
</p>

<p>
This .vfuel can then be deployed into a (locally installed) Newspeak server.
</p>

<ul class="org-ul">
<li>For instructions on how to install the server see <a href="#org8825ff5">7.1.1</a></li>
<li>For instructions on how to deploy a sample app, in particular the <code>CounterApp</code>, see <a href="#orgaadf932">5.4</a>.</li>
</ul>
</div>
</div>



<div id="outline-container-org080cbe2" class="outline-3">
<h3 id="org080cbe2"><span class="section-number-3">9.8</span> How does Ampleforth work to create live literate Newspeak demos such as <a href="http://bracha.org/Literate/literate.html">http://bracha.org/Literate/literate.html</a>?</h3>
<div class="outline-text-3" id="text-9-8">
<p>
TL;DR: Newspeak has a module which allows to present the Newspeak objects (the IDE, classes, instances, workspaces etc) live in any suitably marked up HTML page. This results in an experience of a live document and a literate program - a document containing multiple program snippets or whole programs. The program(s) snippet(s) inside the document can be changed, changing the results right inside the document. The program can also be explored (introspected), drilled into, etc. Everything described in this section can be played with in any of the above links:
</p>

<ul class="org-ul">
<li><a href="http://bracha.org/Literate/literate.html">http://bracha.org/Literate/literate.html</a></li>
<li><a href="https://blog.bracha.org/illiterateProgramming/out/illiterateProgramming.html">https://blog.bracha.org/illiterateProgramming/out/illiterateProgramming.html</a></li>
<li><a href="https://mzimmerm.github.io/2021/07/writing-live-documents-in-newspeak-ampleforth-in-org-mode">https://mzimmerm.github.io/2021/07/writing-live-documents-in-newspeak-ampleforth-in-org-mode</a></li>
</ul>

<p>
The last link also shows instructions on how to create an emacs org mode document which, after export to HTML (C-c C-e), supports such lively HTML interaction.
</p>

<p>
<b>Having provided a TL;DR:, let's describe this in more details.</b>
</p>

<p>
The module providing the experience a live document and a literate Newspeak program is called <code>Ampleforth</code>.
</p>

<p>
Ampleforth is already described in <a href="https://blog.bracha.org/illiterateProgramming/out/illiterateProgramming.html">https://blog.bracha.org/illiterateProgramming/out/illiterateProgramming.html</a> by it's author Gilad Bracha. That is definitely the reference description!
</p>

<p>
This section starts from a slightly different angle.
</p>

<p>
The Newspeak module <code>AmpleforthEmbedder</code> (source in AmpleforthEmbedder.ns) is responsible for "presenting" Newspeak objects to HTML, and user interaction with the objects. The module, <code>Ampleforth</code> is simply a wrapper, wrapping <code>AmpleforthEmbedder</code> as a Newspeak application.
</p>

<p>
The liveliness in HTML pages is provided by <code>Ampleforth.js</code>, which is converted from <code>Ampleforth.ns</code> to Javascript.
</p>

<p>
When <code>Ampleforth.js</code> is placed at the end of any HTML page, it works as follows:
</p>

<p>
After the HTML is opened in a browser, the included script with  <code>Ampleforth.js</code> looks for &lt;div&gt; elements with specific class names, and inserts Newspeak objects converted to HTML in thos places.
</p>

<p>
For example, if the HTML contains a div with <code>class="evaluator"</code>, such as
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fce94f;">div</span> <span style="color: #fcaf3e;">class</span>=<span style="color: #e9b96e;">"evaluator"</span> expression = <span style="color: #e9b96e;">"11+22"</span>&gt; &lt;/<span style="color: #fce94f;">div</span>&gt;
</pre>
</div>

<p>
<code>Ampleforth.js</code> evaluates the expression, then inserts Newspeak result objects converted to HTML to the page (before, after, or instead of such specific elements). The 
</p>

<p>
The HTML is processed in the following call sequence: <code>AmplefortEmbeddor&gt;&gt;#start</code> -&gt; <code>AmplefortEmbeddor&gt;&gt;#processEvaluators</code> and the methods that follow.
</p>

<p>
Here is the relevant code:
</p>

<pre class="example" id="org042389f">
(* AmplefortEmbeddor&gt;&gt;#start *)
public start = (
  processEvaluators.
  processMinibrowsers.
  processClassPresenters.
)

(* AmplefortEmbeddor&gt;&gt;#processEvaluators *)
public processEvaluators = (
  domElementsWithClass: 'evaluator' do:
    [:element |
    | 
    expression = element getAttribute: 'expression'. 
    om &lt;ObjectMirror&gt; = platformMirror. 
    es = EvaluatorSubject onModel: (EvaluationViewState onModel: om).
    |
    es initialSource: expression.
    es evaluateLive: expression.
    EmbeddedHopscotchWindow
      into: element
      openSubject: es].
)
</pre>

<p>
In the above code we see that for each <code>domElementsWithClass:</code> 'evaluator' found in the HTML, the code will look for contents of attribute named <code>expression</code>. The <code>expression</code> contents is evaluated, then the result of evaluation is passed to EmbeddedHopscotchWindow which is inserted to the DOM after the &lt;div&gt; with class 'evaluator'.
</p>

<p>
So, as long as the HTML contains a div with class <code>evaluator</code>, such as
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fce94f;">div</span> <span style="color: #fcaf3e;">class</span>=<span style="color: #e9b96e;">"evaluator"</span> expression = <span style="color: #e9b96e;">"11+22"</span>&gt; &lt;/<span style="color: #fce94f;">div</span>&gt;
</pre>
</div>

<p>
the above code (or rather it's converted Javascript equivalent <code>Ampleforth.js</code>) evaluates the expression <code>11+22</code>, creates a <code>EmbeddedHopscotchWindow</code> from the evaluated result. The <code>EmbeddedHopscotchWindow</code> then embeds the result (instance of Number 33 presented as a div) in the DOM inside the original div.
</p>

<p>
We can look in the browser debugger how the result looks after the result div is inserted. After evaluating 11+22, the result 33 is inserted in it's own &lt;a href&gt; link:
</p>


<div id="orgd45af28" class="figure">
<p><img src="/img/newspeak---a-few-notes.org-ampleforth-evaluator-expression-in-debuger.png" alt="nil"/>
</p>
</div>


<p>
Not only that, clicking on the 33 link leads to Newspeak class presenting the instance of 33! See TL;DR for links.
</p>
</div>
</div>


<div id="outline-container-org66700fd" class="outline-3">
<h3 id="org66700fd"><span class="section-number-3">9.9</span> How does Newspeak displays itself in DOM and HTML?</h3>
<div class="outline-text-3" id="text-9-9">
<p>
In addition to the <code>Ampleforth</code> class which can "insert" Newspeak elements live in any HTML page, there is a method that does a similar work for the purpose of presenting Newspeak IDE elements in the browser (when we run the IDE).
</p>

<p>
This method that does this work is <code>HopscotchForHTML5&gt;&gt;Presenter#:ampleforth: h &lt;String&gt; mapping: m &lt;Map[String, Fragment]&gt;</code>. It is responsible for presenting the whole Newspeak IDE as HTML.
</p>

<p>
Let us look at this method first, before we look at an example of it's application: 
</p>

<pre class="example" id="orgee1352f">
ampleforth: h &lt;String&gt; mapping: m &lt;Map[String, Fragment]&gt; = (
  ^AmpleforthFragment html: h mapping: m
  )
</pre>

<p>
<b>To investigate how <code>HopscotchForHTML5&gt;&gt;Presenter&gt;&gt;#:ampleforth:mapping:</code> results in presenting something in the IDE (that is, in the DOM) on an example, let us look at the <code>Browsing&gt;&gt;ObjectPresenter</code> class in the <code>Browsing.ns</code> module.</b>
</p>

<p>
We will show how clicking on the "Help" button <img src="/img/newspeak---a-few-notes.org-help-button.png" alt="nil"/> on an object will call a method of <code>Browsing&gt;&gt;ObjectPresenter&gt;&gt;helpText</code>, and how this results in presenting the help text in the IDE.
</p>

<p>
The <code>ObjectPresenter</code> class provides a viewer for objects in the IDE. An example of <code>Browsing&gt;&gt;ObjectPresenter</code>'s work is result of clicking on the "Help" button <img src="/img/newspeak---a-few-notes.org-help-button.png" alt="nil"/> on an object.
</p>

<p>
For the <code>Browsing&gt;&gt;ObjectPresenter</code> to be used, we need a place in the IDE where we see a blue link which presents an object (rather than for example class, which would use Browsing&gt;&gt;ClassPresenter). Go to "Workspaces" where we see a situation similar to
</p>


<div id="orga0a24cb" class="figure">
<p><img src="/img/newspeak---a-few-notes.org-workspaces.png" alt="nil"/>
</p>
</div>

<p>
This shows instance of an object. To activate <code>Browsing&gt;&gt;ObjectPresenter&gt;&gt;helpText</code>, click on the <img src="/img/newspeak---a-few-notes.org-help-button.png" alt="nil"/> beside Workspace1. The help coming from the ObjectPresenter shows:
</p>

<p>
<img src="/img/newspeak---a-few-notes.org-help-from-object-presenter.png" alt="nil"/>
(we cut the text here)
</p>

<p>
Let us investigate how the Newspeak IDE arrives at presenting the above shown help in the IDE's DOM. As mentioned above, the core of this functionality is the method <code>HopscotchForHTML5&gt;&gt;Presenter&gt;&gt;#:ampleforth: h &lt;String&gt; mapping: m &lt;Map[String, Fragment]&gt;</code> .
</p>

<p>
But we need to start one level above to explore this step by step:
</p>

<ol class="org-ol">
<li>Open code for <code>Browsing&gt;&gt;ObjectPresenter&gt;&gt;#helpText</code>.</li>

<li><p>
It shows clearly the text is the same as the one displayed in the help text above:
</p>
<pre class="example" id="orge5b2307">
  helpText ^ &lt;Fragment&gt; = (
  | mapping = Map new. |
  mapping 
    at: #hopscotchClearResultsButton put: subject evaluator presenter clearResultsButton;
    at: #classExpander put: classExpansionLink;
    at: #evaluateSelectionButton put: subject evaluator presenter evaluateSelectionButton;
    at: #invertEvalStatusButton put: subject evaluator presenter invertEvalStatusButton.

  ^ampleforth: 'This is an object presenter (aka  inspector).  At the top you''ll see its description, a link to the object''s enclosing object, and an expandable link to its class: &lt;div class="classExpander"&gt; &lt;/div&gt; Expanding it in place allows you to see the class in the context of the instance, which can be very handy.
  &lt;br&gt;&lt;br&gt;
  You can enter and evaluate Newspeak expressions in the editor pane below. They will be evaluated in the scope of the object being inspected. Shift-Return evaluates the currently selected text; if no text is selected, the current line (i.e., the line where the cursor is) is evaluated. You can also initiate evaluation of any selected text by pressing: &lt;div class = "evaluateSelectionButton"&gt;&lt;/div&gt; which is located above the editor on the left.
  &lt;br&gt;&lt;br&gt;
The editor can also evaluate at every keystroke; you can toggle this behavior using &lt;div class = "invertEvalStatusButton"&gt;&lt;/div&gt;
also located above the editor.
&lt;br&gt;&lt;br&gt;
Evaluation results, if any, are displayed below the editor pane. Each result is a link; clicking on it takes you an object inspector on the result.  You can clear the results list by pressing the clear button to its right: &lt;div class="hopscotchClearResultsButton"&gt; &lt;/div&gt;
&lt;br&gt;
If  there are no results to display, the  results list area is blank. Below the results list you will typically see the slots of the object listed; this the basic view of objects. Some objects, such as integers or strings, have customized views. An object can have multiple views (and you can define new views as well). If there are multiple views, tab links appear underneath the results list, and you can select between them.' mapping: mapping
)
</pre></li>

<li>In the code, we can see how it first prepares a <code>mapping</code> map, then returns a result of message send to self <code>ampleforth: aHTMLString mapping: mapping</code>. The message accepts the long pure HTML string we see above, and the mapping.
<ul class="org-ul">
<li>In the Html snippet, we can find references to 'special' class names:
<ul class="org-ul">
<li><code>&lt;div class="hopscotchClearResultsButton"&gt; &lt;/div&gt;</code></li>
<li><code>&lt;div class="classExpander"&gt;</code></li>
<li>.. etc ..</li>
<li>Note those class names (e.g. classExpander) are equivalent to the 'special' class name evaluator used by AmpleforthEmbedder, in the section <a href="#org080cbe2">9.8</a></li>
</ul></li>
<li><p>
Clearly those class names are keys in the <code>mappings</code> map.
</p>
<pre class="example" id="org9a28e1f">
mapping 
  at: #hopscotchClearResultsButton put: subject evaluator presenter clearResultsButton;
  at: #classExpander put: classExpansionLink;
  .. etc ..
</pre></li>
</ul></li>
<li><p>
We can look at "find references" on this method, and find it is defined by <code>HopscotchForHTML5&gt;&gt;Presenter&gt;&gt;#ampleforth:mapping:</code>
</p>
<pre class="example" id="org4f0aa38">
ampleforth: h &lt;String&gt; mapping: m &lt;Map[String, Fragment]&gt; = (
  ^AmpleforthFragment html: h mapping: m
)
</pre>
<ul class="org-ul">
<li>Also note that from the ObjectPresenter factory constructor it is clear ObjectPresenter implements ProgrammingPresenter which implements Presenter where the method <code>HopscotchForHTML5&gt;&gt;Presenter&gt;&gt;#ampleforth:mapping:</code> is defined.</li>
</ul></li>

<li><p>
The above method constructs instance of <code>HopscotchForHTML5&gt;&gt;AmpleforthFragment</code> as follows
</p>

<pre class="example" id="org34f4809">
public class AmpleforthFragment html: h &lt;String&gt; mapping: m &lt;Map[String, Fragment]&gt; = HTMLFragment html: h (
  |
  mapping &lt;Map[String, Fragment]&gt; = m.
    document_slot &lt;Alien[Document]&gt;
  |
    processMappings.
)
</pre></li>

<li><p>
In turn the <code>HopscotchForHTML5&gt;&gt;AmpleforthFragment&gt;&gt;#processMappings</code> does the following work - the core of the work is call the method <code>#visual</code> on all Fragments in the <code>mappings</code>:
</p>

<pre class="example" id="orgdb9ff1e">
public processMappings = (
  mapping keysAndValuesDo: [:k &lt;String&gt; :v &lt;Fragment&gt; |
    v parent: self.
  	domElementsWithClass: k do:
  		[:element | element appendChild: v visual]
  ]
)
</pre></li>

<li><p>
The <code>#visual</code> simply calls <code>#createVisual</code> and decorates it. But where is <code>#createVisual</code> defined?  
</p>
<pre class="example" id="orge072d76">
public visual = (
  visualX isNil ifTrue: [visualX:: decorate: createVisual].
  ^visualX
)
</pre></li>
<li>which in turn calls <code>HopscotchForHTML5&gt;&gt;Fragment&gt;&gt;createVisual</code>, then decorates the visual result.</li>
<li><p>
The important item here is
</p>
<pre class="example" id="org358d75a">
createVisual = (
  subclassResponsibility
)
</pre></li>
<li><p>
which is implemented in a large number of <code>Fragment</code> subclasses, such as:
</p>
<pre class="example" id="org1e42601">
createVisual in CheckboxFragment in HopscotchForHTML5
createVisual in ColorPickerFragment in HopscotchForHTML5
createVisual in DatePickerFragment in HopscotchForHTML5
createVisual in PickerFragment in HopscotchForHTML5
createVisual in ProgressBarFragment in HopscotchForHTML5
createVisual in RadioButtonFragment in HopscotchForHTML5
createVisual in RectangleFragment in HopscotchForHTML5
</pre></li>

<li><p>
From the last list, we can see those are all UI elements- checkboxes, pickers, radio buttons etc. Their concrete <code>createVisual</code> implementations use the document object to create a representation of UI elements which are clearly equivalent to DOM object, and can be converted to DOM objects. Let's look at <code>CheckboxFragment#createVisual</code> as an example:
</p>

<pre class="example" id="orgcca4e57">
createVisual = (
    | 
    container &lt;Alien[Div]&gt; = document createElement: 'div'.
    label &lt;Alien[Element]&gt; = document createTextNode: text.
    |

  container at: 'id' put: 'CheckboxContainer'.

    (container at: 'style')
        at: 'display' put: 'flex';
        at: 'flex-direction' put: 'row';
        at: 'align-items' put: 'center';
        at: 'justify-content' put: 'flex-start'.

    checkbox:: document createElement: 'input'. 
    checkbox
        at: 'type' put: 'checkbox';
        at: 'checked' put: checked;
        at: 'oninput' put: [:event |    
            checked:: checked not.
            holder isNil ifFalse: [         
                holder value: checked.
            ].
            action isNil ifFalse: [
                action value: checked.
            ].
            false
        ].
    container appendChild: checkbox.

    container appendChild: label.

    (checkbox at: 'style')
        at: 'min-width' put: styleCheckboxSize;
        at: 'min-height' put: styleCheckboxSize;
        at: 'margin-right' put: '5px'.

    ^container.

</pre></li>
</ol>

<p>
Seeing the creation of an Alien DOM &lt;div&gt; equivalent object in this last method, we conclude our discovery of "How does Newspeak displays itself in DOM and HTML?"
</p>

<p>
<b>Summary of the discovery:</b>
</p>

<ul class="org-ul">
<li><p>
The <code>#helpText</code> contains a (almost) pure HTML and <code>mappings</code> of special class names such as <code>hopscotchClearResultsButton</code>, <code>classExpander</code>, etc.
</p>
<pre class="example" id="orgeff759e">
mapping 
  at: #hopscotchClearResultsButton put: subject evaluator presenter clearResultsButton;
  at: #classExpander put: classExpansionLink;
  .. etc ..
</pre></li>
<li>We saw the <code>#helpText</code>, by calling <code>#ampleforth:mapping:</code>  created and returned an instance of class <code>HopscotchForHTML5&gt;&gt;ApleforthFragment</code></li>
<li>During creation, in it's factory <code>HopscotchForHTML5&gt;&gt;AmpleforthFragment class&gt;&gt;#html:mapping:</code> applies on each value from <code>mapping</code> the <code>HopscotchForHTML5&gt;&gt;Fragment&gt;&gt;#createVisual</code> at the end of the chain - building the DOM-like objects (called Fragments). Those visual instances are then inserted in the DOM, putting together the Newspeak IDE!.</li>
</ul>


<p>
<b>Conclusion of sequence of calls from the "Help button" click to create DOM elements with Help contents</b>
</p>

<p>
We followed the sequence of method calls after the "Help button" was clicked:
</p>

<ul class="org-ul">
<li><code>Browsing&gt;&gt;ObjectPresenter&gt;&gt;#helpText</code>                             - calls Presenter self by returning:</li>
<li><code>HopscotchForHTML5&gt;&gt;Presenter&gt;&gt;#ampleforth:mapping:</code>               - Presenter constructs and returns a Fragment <code>^AmpleforthFragment html: h mapping: m</code> by calling:</li>
<li><code>HopscotchForHTML5&gt;&gt;AmpleforthFragment class&gt;&gt;#html:mapping:</code>      - This AmpleforthFragment constructor does the core of the DOM-like child fragments creation by looping through mappings in:</li>
<li><code>HopscotchForHTML5&gt;&gt;AmpleforthFragment&gt;&gt;#processMappings</code>          - For each mapping entry, one visual is created from "entry value" in the calls below; once the visual is returned back here, it is immediately inserted here into element with class="entry key" into <code>domElementsWithClass</code></li>
<li><code>HopscotchForHTML5&gt;&gt;Fragment&gt;&gt;#visual</code>                             - which calls "#createVisual" below</li>
<li><code>CheckboxFragment#createVisual</code>                                    - This uses "document createElement" to create, for each mapping entry, and return an Alien DOM &lt;div&gt; equivalent - it contains a DOM element such as a checkbox.</li>
</ul>

<p>
We saw how this sequence is responsible of presenting Help Text (with embedded Newspeak objects) as an navigatable live HTML browser-presented in the IDE, where we can explore and drill in instances, classes, or other Newspeak artifacts.
</p>
</div>
</div>
</div>



<div id="outline-container-org2a458d6" class="outline-2">
<h2 id="org2a458d6"><span class="section-number-2">10</span> The Newspeak UI, <code>HopscotchForHTML5</code>: Analysing it by digging though code; discovering <code>Subject</code> <code>Model</code> <code>Presenter</code> and <code>Fragment</code>; writing <code>CheckedItemApp</code> sample App with a UI app based on what we learned</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-org4910947" class="outline-3">
<h3 id="org4910947"><span class="section-number-3">10.1</span> If you wish to start at the end: Full code of HopscotchForHTML5 sample app</h3>
<div class="outline-text-3" id="text-10-1">
<p>
If you wish to start at the end, look at the full code of HopscotchForHTML5 sample app
</p>

<p>
<a href="https://github.com/mzimmerm/newspeak-doc/tree/main/newspeak---a-few-notes-code/checked-item-app">https://github.com/mzimmerm/newspeak-doc/tree/main/newspeak---a-few-notes-code/checked-item-app</a>
</p>

<p>
and some final comments of this section in <a href="#org7661033">5. Complete code and UI of the <b>CheckedItemApp</b></a>.
</p>
</div>
</div>


<div id="outline-container-org9cfef77" class="outline-3">
<h3 id="org9cfef77"><span class="section-number-3">10.2</span> Discovery of the <b>HopscotchForHTML5</b> class basics</h3>
<div class="outline-text-3" id="text-10-2">
</div>
<div id="outline-container-org701506c" class="outline-4">
<h4 id="org701506c"><span class="section-number-4">10.2.1</span> Chapter goal</h4>
<div class="outline-text-4" id="text-10-2-1">
<p>
<b>Hopscotsch is the Newspeak module used to write UIs in Newspeak.</b> The version of Hopscotch used in today's (year 2021) Newspeak is called <b>Hopscotch for HTML5</b>.  It is implemented in classes nested in the module's class (top level class) named <code>HopscotchForHTML5</code>.
</p>

<p>
The intent of this chapter is to discover things about <code>HopscotchForHTML5</code> mostly by browsing it's code in the IDE, plus some previously developed intuition :)
</p>

<p>
I am trying to make the process of this chapter to be like discovering things about nature by observation. In our discovery, observation = browsing code only the Newspeak IDE. By observing, we should be able to extract knowledge and make generalizations and predictions.  In our discovery, extract knowledge = understand the core API;  make generalizations and predictions = be able to write a simple UI App of our own.
</p>

<p>
Note: One important discovery tool is missing - in the current Newspeak, debugging anything in the UI is impossible, due to some known bugs.
</p>

<p>
In other words, during our discovery process in this chapter:
</p>

<ul class="org-ul">
<li>Most of the information should come from browsing through the Newspeak IDE in the top level class <code>HopscotchForHTML5</code>.</li>

<li>The end goal of our process is to write a simple Newspeak App with UI in Hopscotch. This simple Newspeak App is developed in chapter <a href="#orgb3a4bfa">Using chapters above to write a simple Hopscotch UI App, the <b>CheckedItemApp</b></a>.</li>

<li>There was also the benefit of previously looking at the <code>CounterApp</code> (aka cheating), but as much as possible, we are trying to extract everything we need from the "first principles" of browsing the Newspeak IDE top level class <code>HopscotchForHTML5</code>.</li>
</ul>


<p>
Two most important nested classes in <code>HopscotchForHTML5</code> are <code>Subject</code>, <code>Presenter</code>.  This statement did not come necessarily from observation (although we could claim that), but from a bit of a "previously developed intuition", as well as from the paper "Hopscotch: Towards User Interface Composition" by Vassili Bykov, 8 pages <a href="https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.478.1098&amp;rep=rep1&amp;type=pdf">https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.478.1098&amp;rep=rep1&amp;type=pdf</a>. Note that the paper is about the original Hopscotch, not the HTML5 specific version. But I feel the core of the two versions seems close enough to start with the paper.
</p>


<p>
So this chapter makes a reasonable assumption that the <code>Subject</code> and <code>Presenter</code> classes are of core importance in building UIs in Newspeak. Further, opening class <code>Presenter</code> in the Newspeak IDE, we see that it has a parent class <code>Fragment</code>.  <code>Fragment</code> is new to the new version <code>HopscotchForHTML5</code> as opposed to the original <code>Hopscotch</code>.  Because we consider <code>Presenter</code> important, so must be <code>Fragment</code>. 
</p>

<p>
So, enough meta talk, and let us browse the most important code of classes  <code>Subject</code> and <code>Presenter</code> - their <b>factory constructors</b>. As with any Newspeak class, we should start at the factory constructors to understand the class. Factory constructor is the only code which defines slots (slots as similar to members in other OO languages). Also we see that Fragment is parent of Presenter. So <code>Fragment</code> must be important; we added it's factory constructor to the constructor summary as well.
</p>

<pre class="example" id="orgd202404">
public class Subject onModel: aModel = (
  |
	public model = aModel.
  presenterSlot &lt;Presenter&gt;
  public helpActive &lt;Boolean&gt; ::= false.
  |)

public class Presenter onSubject: aSubject &lt;Subject&gt; = Fragment (
  |
  public subject &lt;Subject&gt; ::= aSubject.
  substanceSlot &lt;Fragment&gt;
  public generation &lt;Number&gt; = uiGeneration.
  |)

class Fragment = (
  |
	visualX
	public parent
	public size ::= nil.
	public expansibility ::= 0.
	public compressibility ::= 0.
	decorators
	|)  
</pre>

<p>
From the factory constructors, it is immediately clear that:
</p>

<ol class="org-ol">
<li>For a subject to be created, a model is required. So model must be created before subject.</li>
<li>For a presenter to be created, a subject is required. So subject must be created before presenter.</li>
</ol>
</div>
</div>


<div id="outline-container-orgb71cfea" class="outline-4">
<h4 id="orgb71cfea"><span class="section-number-4">10.2.2</span> Chapter conclusion</h4>
<div class="outline-text-4" id="text-10-2-2">
<p>
<b>Lifecycle of any Hopscotch UI code:</b>
</p>
<ul class="org-ul">
<li><b>We need to instantiate a Model first.</b></li>
<li><b>We need to instantiate a Subject on the model next.</b></li>
<li><b>We need to instantiate a Presenter on the subject last.</b></li>
</ul>

<p>
This is quite clear from the signatures of those classes factory constructors - there can be no other way.
</p>

<p>
A note on Newspeak syntax: while the <code>Subject&gt;&gt;model</code> slot and <code>Presenter&gt;&gt;subject</code> slots are public, they have no setters, so they are final. The value they acquire in the factory constructor cannot be changed. This is because the slots are defined using " = ", for example in <code>public model = aModel.</code> If the " ::= " was used instead of " = " to define the slot <code>model</code>, then the slot  would not be final - a setter would exist. But as is, we cannot, even in principle, create the instances of Model/Subject/Presenter with null slots, change the creation order, and set the slots later.
</p>

<p>
Next two chapters will look into details of <b>Presenter, Subject, and Model</b> classes, and associations between them.  The associations may not be important for writing UIs, but they are for understanding the Hopscotch framework.
</p>
</div>
</div>
</div>


<div id="outline-container-orgc85ff4d" class="outline-3">
<h3 id="orgc85ff4d"><span class="section-number-3">10.3</span> The formulaic required repetitive methods of #isMyKind: and #isKindOfX</h3>
<div class="outline-text-3" id="text-10-3">
<p>
This chapter is jumping right into a piece that is a bit difficult to understand: The required repetitive methods of <code>#isMyKind: other</code> and <code>#isKindOfX</code>.
</p>

<p>
Comments in <code>Fragment</code> and <code>Subject</code> talk about this:
</p>

<p>
<b>Subclasses must implement #isMyKind: which tests whether another instance is of the same kind. The implementation is #isMyKind: is formulaic, calling #isKindOfX for whatever type X the instance represents</b>
</p>

<p>
Because <code>Presenter</code> is a subclass of <code>Fragment</code>, the equivalent of the above statement applies to <code>Presenter</code>.
</p>

<p>
Let us summarize a practical translation of this piece of documentation:
</p>

<p>
<b>Any time we write a concrete implementation of <code>Presenter</code>, <code>Subject</code> or <code>Fragment</code>, we must implement two methods.  Suppose a concrete Presenter class is named <code>MyConcretePresenter</code>.  In this class, we have to implement methods <code>#isMyKind: other</code> and <code>#isKindOfMyConcretePresenter</code> as follows:</b>
</p>

<pre class="example" id="org553faaf">
isMyKind: other &lt;Fragment&gt; ^ &lt;Boolean&gt; = (
  ^other isKindOfMyConcretePresenter.
)

isKindOfMyConcretePresenter &lt;Boolean&gt; = (
  ^true.
)
</pre>

<p>
Similar code needs to be added to any concrete implementation of <code>Fragment</code> or <code>Subject</code>. Just replace the "Presenter" with "Fragment" or "Subject".
</p>

<p>
In the chapters below, we will not come back to this in too much detail, and always add such methods in our code.
</p>
</div>
</div>


<div id="outline-container-org3fbff6f" class="outline-3">
<h3 id="org3fbff6f"><span class="section-number-3">10.4</span> The <b>Subject</b> class: Factory constructor, instance methods, how Subject knows Presenter</h3>
<div class="outline-text-3" id="text-10-4">
</div>
<div id="outline-container-org95f479c" class="outline-4">
<h4 id="org95f479c"><span class="section-number-4">10.4.1</span> Chapter goal: Overview of the <b>Subject</b> class</h4>
<div class="outline-text-4" id="text-10-4-1">
<p>
This chapter is about the <code>Subject</code> class, in particular about three "important parts" we should know to understand the Newspeak UI.  Those parts are also important when we write code for concrete implementations of <code>Subject</code>.
</p>

<p>
Let us show the code for the <code>Subject</code> class, keeping only the "important parts" - each of them is discussed in subchapters below.
</p>

<p>
<code>From class Subject</code>
</p>
<pre class="example" id="org7ca1d4b">

(* 1. The factory constructor *)

public class Subject onModel: aModel = (
  |
  public model = aModel.
  presenterSlot &lt;Presenter&gt;
  public helpActive &lt;Boolean&gt; ::= false.
  |
) (


  (* 2. The methods that deal with associating Subject and Presenter instances *)
  
  public createPresenter ^&lt;Presenter&gt; = (
    subclassResponsibility
  )
  public presenter ^&lt;Presenter&gt; = (
    presenterSlot isNil ifTrue: [presenterSlot:: createPresenter].
    presenterSlot generation &lt; uiGeneration ifTrue: [
      presenterSlot:: createPresenter.
      ].
    ^presenterSlot
  )

  
  (* 3. Unimplemented (abstract) methods which a concrete Subject implementation must provide *)
  
  isMyKind: s &lt;Subject&gt; ^ &lt;Boolean&gt; = (
    subclassResponsibility
  )

  
  (* Several other methods *)
)
</pre>

<p>
In the subchapters below, we go over each of the "important parts".
</p>
</div>
</div>


<div id="outline-container-orgc723230" class="outline-4">
<h4 id="orgc723230"><span class="section-number-4">10.4.2</span> The factory constructor <b>public class Subject onModel: aModel = (..)</b></h4>
<div class="outline-text-4" id="text-10-4-2">
<p>
This is the code which creates instances, and should be called from implementations' factory constructors. The code hold slots for <code>model</code>, the associated <code>presenterSlot</code> and a help slot. For a practical purpose of writing UIs, this is the most important code.
</p>

<p>
Concrete implementations of Subject, should (in fact must, it is enforced) invoke the Subject's factory as 
</p>

<p>
<code>public class MyConcreteSubject onModel: model = Subject onModel: aModel ()</code>  
</p>

<p>
This should be sufficient for most concrete implementations of Subject.
</p>
</div>
</div>


<div id="outline-container-orgfe0b0d0" class="outline-4">
<h4 id="orgfe0b0d0"><span class="section-number-4">10.4.3</span> The unimplemented (abstract) methods: <b>Subject&gt;&gt;#createPresenter</b> and <b>Subject&gt;&gt;#isMyKind: otherSubject</b></h4>
<div class="outline-text-4" id="text-10-4-3">
<p>
The full signatures of the unimplemented methods which each concrete Subject implementation must provide are:
</p>

<ul class="org-ul">
<li><code>Subject&gt;&gt;#public createPresenter ^&lt;Presenter&gt;</code> should return the concrete Presenter instance which will present the subject. This was also discussed in the chapter above.</li>
<li><code>Subject&gt;&gt;#isMyKind: otherSubject ^&lt;Boolean&gt;</code>   is repetitive but required. We have a common chapter for this, see <a href="#orgc85ff4d">The formulaic required repetitive methods of #isMyKind: and #isKindOfX</a></li>
</ul>

<pre class="example" id="orgd29061c">
public createPresenter ^&lt;Presenter&gt; = (
  subclassResponsibility
)

isMyKind: s &lt;Subject&gt; ^ &lt;Boolean&gt; = (
  subclassResponsibility
)
</pre>

<p>
In any concrete implementation of Presenter, those methods must be provided.
</p>
</div>

<div id="outline-container-orge556f34" class="outline-5">
<h5 id="orge556f34"><span class="section-number-5">10.4.3.1</span> The method <code>#Subject&gt;&gt;createPresenter</code> discovery from existing implementations</h5>
<div class="outline-text-5" id="text-10-4-3-1">
<p>
Let us discover, from code browsing, what a concrete implementation of <code>Subject&gt;&gt;#createPresenter</code> should do.
</p>

<p>
From the name and signature, clearly the <code>Subject&gt;&gt;#createPresenter</code> should return a new instance of <code>Presenter</code>. Supposedly this is the actual UI instance.
</p>

<p>
We can get some hints about Presenter implementations in existing Subject extensions from the IDE.  Here is an example of <code>#createPresenter</code> from <code>HomeSubject</code>. All Subject implementations do something equivalent:
</p>

<p>
<code>From class HomeSubject</code>
</p>
<pre class="example" id="org77d12fd">
public createPresenter = (
	^HomePresenter onSubject: self
)
</pre>

<p>
<b>Conclusion: It seems clear that in any concrete implementation of <code>Subject</code> the method  <code>#createPresenter</code> is intended to create and return the Presenter we want to use to present the Subject.</b>
</p>
</div>
</div>
</div>




<div id="outline-container-orgebfc0c9" class="outline-4">
<h4 id="orgebfc0c9"><span class="section-number-4">10.4.4</span> The method <b>Subject&gt;&gt;#presenter</b> creates the subject's presenter by calling the <b>Subject&gt;&gt;#createPresenter</b>, then associate the instances</h4>
<div class="outline-text-4" id="text-10-4-4">
</div>
<div id="outline-container-org2b9d4ac" class="outline-5">
<h5 id="org2b9d4ac"><span class="section-number-5">10.4.4.1</span> Chapter goal</h5>
<div class="outline-text-5" id="text-10-4-4-1">
<p>
Goal is to discuss how a <code>Presenter</code> instance is created, and where are the Subject &lt;-&gt; Presenter associations created.
</p>
</div>
</div>




<div id="outline-container-org801c63a" class="outline-5">
<h5 id="org801c63a"><span class="section-number-5">10.4.4.2</span> Where is Subject -&gt; Presenter association created? In <b>Subject&gt;&gt;#presenter</b></h5>
<div class="outline-text-5" id="text-10-4-4-2">
<p>
The exact signature is <code>Subject&gt;&gt;#public presenter ^&lt;Presenter&gt;</code>.
</p>

<p>
<code>Subject</code> holds association to it's <code>Presenter</code> in the <code>Subject&gt;&gt;presenterSlot</code>. This slot is instantiated lazily in <code>Subject&gt;&gt;#presenter</code> by calling <code>Subject&gt;&gt;#createPresenter</code>, then storing the instantiated presenter on the <code>presenterSlot</code>:
</p>

<pre class="example" id="org9dd4197">
public presenter ^&lt;Presenter&gt; = (
  presenterSlot isNil ifTrue: [presenterSlot:: createPresenter].
  presenterSlot generation &lt; uiGeneration ifTrue: [
    presenterSlot:: createPresenter.
    ].
  ^presenterSlot
)
</pre>

<p>
So as long as something calls <code>Subject&gt;&gt;#presenter</code>, after a Subject is created, then <b>the <code>Subject</code> knows about it's <code>Presenter</code> and keeps in on slot <code>presenterSlot</code>, establishing the Subject-&gt;Presenter association</b> - which is what we wanted to show.
</p>
</div>
</div>



<div id="outline-container-org40671b6" class="outline-5">
<h5 id="org40671b6"><span class="section-number-5">10.4.4.3</span> Where is Presenter -&gt; Subject association created? In the Presenter factory constructor <b>Presenter&gt;&gt;#class Presenter onSubject: aSubject = Fragment</b></h5>
<div class="outline-text-5" id="text-10-4-4-3">
<p>
The exact signature is public class <code>Presenter onSubject: aSubject &lt;Subject&gt; = Fragment (..)</code>
</p>

<p>
We can find our answer in a few steps, starting with <code>Subject&gt;&gt;#presenter</code>:
</p>

<ol class="org-ol">
<li><code>Subject&gt;&gt;#public presenter ^&lt;Presenter&gt;</code> calls <code>Subject&gt;&gt;#public createPresenter ^&lt;Presenter&gt;</code></li>

<li><code>Subject&gt;&gt;#public createPresenter ^&lt;Presenter&gt;</code> creates the Presenter. While this method is abstract, we can discover what it is intended to do:
<ul class="org-ul">
<li>a) From its signature <code>Subject&gt;&gt;#public createPresenter ^&lt;Presenter&gt;</code></li>
<li><p>
b) By looking as a concrete Presenter implementations in the IDE.  Here is an example of a concrete <code>#createPresenter</code> from <code>HomeSubject</code>
</p>

<p>
<code>From class HomeSubject</code>
</p>
<pre class="example" id="orgcc2e85e">
public createPresenter = (
  ^HomePresenter onSubject: self
)
</pre>
<p>
Clearly the conclusion from both is this: The intent of <code>Subject&gt;&gt;#public createPresenter ^&lt;Presenter&gt;</code> is to create a presenter which presents the <code>Subject</code> instance, and return it
</p></li>
</ul></li>
<li><p>
Next, let us study the concrete discovered example of <code>HomePresenter</code>'s factory constructor.
</p>
<pre class="example" id="org1fff7f8">
class HomePresenter onSubject: s = Presenter onSubject: s (
)
</pre>
<p>
This is a standard Newspeak syntax for a super call. The factory constructor <code>HomePresenter&gt;&gt;#onSubject: subject</code> calls the superclass <code>Presenter&gt;&gt;#onSubject: subject</code> 
</p>

<p>
Having shown that, we can get back to this line:
</p>

<p>
<code>HomePresenter onSubject: self</code> - note that self is subject
</p>

<p>
This will cause the call to the "super" <code>Presenter&gt;&gt;#onSubject: subject</code>. This "super" <code>Presenter&gt;&gt;#onSubject: subject</code> call places the passed subject on slot "subject" in the Presenter's factory constructor:
</p>

<pre class="example" id="org47bc94f">
public class Presenter onSubject: aSubject &lt;Subject&gt; = Fragment (
  |
  public subject &lt;Subject&gt; ::= aSubject.
  substanceSlot &lt;Fragment&gt;
  public generation &lt;Number&gt; = uiGeneration.
  |)
</pre></li>

<li>So this line <code>public subject &lt;Subject&gt; ::= aSubject</code> creates the association from Presenter -&gt; Subject. The associated subject instance is kept on slot <code>Presenter&gt;&gt;subject</code>.</li>
</ol>


<p>
This is what we have shown in summary: Calling a concrete subject's #presenter such as <code>HomeSubject#presenter</code> will associate Presenter -&gt; Subject.
</p>

<p>
Also, along with the previous chapter, callin <code>Subject&gt;&gt;#presenter</code> also creates the association "the other way". By calling <code>Subject&gt;&gt;#presenter</code>, the bidirectional associations Presenter &lt;-&gt; Subject is established.
</p>

<p>
"Some code" must call the <code>Subject&gt;&gt;#presenter</code> though.
</p>
</div>
</div>
</div>


<div id="outline-container-org42e82ed" class="outline-4">
<h4 id="org42e82ed"><span class="section-number-4">10.4.5</span> Chapter conclusion about principles of writing rudimentary Hopscotch UI</h4>
<div class="outline-text-4" id="text-10-4-5">
<p>
In the conclusion of chapter <a href="#org9cfef77">Discovery of the <b>HopscotchForHTML5</b> class basics</a> we already discovered an important lifecycle any UI code need to perform: <b>Create an instance of a Model first, a Subject next, a Presenter last</b>.
</p>

<p>
In this chapter <a href="#org3fbff6f">The <b>Subject</b> class: Factory constructor, instance methods, how Subject knows Presenter</a> we added the following conclusions:
</p>

<p>
<b>Conclusion 1: As long as the <code>Subject&gt;&gt;#presenter</code> is invoked (on an existing subject instance), two important things happen:</b>
</p>
<ul class="org-ul">
<li>A <code>Presenter</code> instance is created.</li>
<li>The bidirectional association between the subject and presenter instances is established.</li>
</ul>

<p>
<b>Conclusion 2: So, when creating UIs, our code must invoke the <code>Subject&gt;&gt;#presenter</code> method, directly, or indirectly by calling some other method that ends up calling <code>Subject&gt;&gt;#presenter</code>.</b>
</p>

<p>
<b>Conclusion 3: Model can be any object.  <code>ConcreteSubject</code> must extend the <code>Subject</code>.  Also the <code>ConcreteSubject</code> factory constructor must call the parent <code>Subject</code> factory constructor - see <a href="#orgc723230">The factory constructor <b>public class Subject onModel: aModel = (..)</b></a> ; chapters below come to the equivalent conclusion for <code>ConcretePresenter</code>.</b>
</p>

<p>
Based on the conclusions 1, 2, 3, we can already write some pseudocode for writing core UI:
</p>

<p>
<b>intermediary code - do not use yet</b>
</p>
<pre class="example" id="org44047eb">
|concreteModel concreteSubject concretePresenter|
concreteModel:: ConcreteModel new.
concreteSubject:: ConcreteSubject onModel: concreteModel.
concreteSubject presenter.
</pre>

<p>
Note the last line <code>concreteSubject presenter.</code>: Why did we not use <code>concreteSubject:: ConcretePresenter onSubject: concreteSubject.</code> instead, as seemingly this would achieve the presenter creation anyway?
</p>

<p>
The answer to this question is as follows: While the latter code is certainly possible to use in principle, we have seen in the overview of Subject APIs above, that Hopscotch provides the method <code>Subject&gt;&gt;#presenter</code> which not only creates the Presenter instance by calling <code>Subject&gt;&gt;#createPresenter</code>, but also wires up the Presenter &lt;-&gt; Subject associations!
</p>

<p>
Clearly, the framework intents application code not to create Presenter instances directly, but intends for application code to call <code>Subject&gt;&gt;#presenter</code>. However, this call should not be made directly in application code either. In chapter <a href="#org56fb847">HopscotchForHTML5: Analyzing senders of <b>Subject&gt;&gt;#presenter</b> and why <b>HopscotchWindow&gt;&gt;#openSubject: subject</b> should be invoked instead</a> we provided some long reasoning for the following conclusion:
</p>

<p>
<b>Conclusion 4: The root level of an application should not create <code>Presenter</code> directly or by calling <code>Subject&gt;&gt;#presenter</code> directly. Instead, application should invoke</b>
</p>

<p>
<code>HopscotchWindow&gt;&gt;#openSubject: subject</code>
</p>

<p>
This invocation eventually invokes <code>Subject&gt;&gt;#presenter</code> as intended, but does additional work of placing the creater <code>Presenter</code> instance in the context of the container body.
</p>

<p>
So we arrived at a summary conclusion.
</p>

<p>
<b>Summary conclusion: Here is the code for a barebones Hopscotch App</b>
</p>

<pre class="example" id="org65d7927">
|concreteModel concreteSubject concretePresenter|
concreteModel:: ConcreteModel new.
concreteSubject:: ConcreteSubject onModel: concreteModel.
hopscotchWindow openSubject: concreteSubject.
</pre>

<p>
The last line will create instance of ConcretePresenter by calling <code>ConcreteSubject&gt;&gt;#presenter</code> and open it in a new window where the App will live! This snippet does not show definitions of <code>ConcreteModel</code> <code>ConcreteSubject</code> <code>ConcretePresenter</code>, or how we obtain the <code>hopscotchWindow</code>. We will get to that when creating a concrete App in <a href="#orgb3a4bfa">Using chapters above to write a simple Hopscotch UI App, the <b>CheckedItemApp</b></a>
</p>
</div>
</div>
</div>


<div id="outline-container-orge00d8b1" class="outline-3">
<h3 id="orge00d8b1"><span class="section-number-3">10.5</span> The <b>Presenter</b> class: Factory constructor, instance methods, how Presenter knows Subject</h3>
<div class="outline-text-3" id="text-10-5">
</div>
<div id="outline-container-org89011f5" class="outline-4">
<h4 id="org89011f5"><span class="section-number-4">10.5.1</span> Chapter goal: Overview of the <b>Presenter</b> class</h4>
<div class="outline-text-4" id="text-10-5-1">
<p>
This chapter is about the <code>Presenter</code> class, in particular about three "important parts" we should know to understand the Newspeak UI.  Those parts are also important when we write code for concrete implementations of <code>Presenter</code>.
</p>

<p>
Let us show the code for the <code>Presenter</code> class, keeping only the "important parts" - each of them is discussed in subchapters below.
</p>

<pre class="example" id="org7b00bea">

(* The factory constructor.
   The constructor also creates the association from Presenter instance to Subject instance
   by keeping the associated subject slot
*)

public class Presenter onSubject: aSubject &lt;Subject&gt; = Fragment (
  |
  public subject &lt;Subject&gt; ::= aSubject.
  substanceSlot &lt;Fragment&gt;
  public generation &lt;Number&gt; = uiGeneration.
  |
) (
  
  
  (* The unimplemented (abstract) method "definition"
     which a concrete Presenter implementation must provide
  *)
  
  public definition ^&lt;Fragment&gt; = (
    subclassResponsibility
  )

  (* Further unimplemented (abstract) methods inherited from Fragment *)

  isMyKind: f &lt;Fragment&gt; ^ &lt;Boolean&gt; = (
    subclassResponsibility
  )
  
  (* A few selected methods which allow Presenter instances to create instances of Fragments - Fragments are UI Widgets
  *)

  row: definitions = (
	  ^RowComposer definitions: definitions
  )
  button: label &lt;String&gt; action: block &lt;[]&gt; = (
    ^ButtonFragment label: label action: block
  )
  checkbox: text &lt;String&gt; value: v &lt;Holder&gt; action: a &lt;[:Boolean]&gt; = (
    ^CheckboxFragment text: text value: v action: a
  )
  radioButton: text &lt;String&gt; value: v &lt;Holder&gt; group: g &lt;Integer&gt; action: a &lt;[:Boolean]&gt; = (
    ^RadioButtonFragment text: text value: v group: g action: a
  )
  rectangle = (
    ^RectangleFragment new
  )
)
</pre>

<p>
In the subchapters below, we go over each of the "important parts".
</p>
</div>
</div>


<div id="outline-container-org14dbdd3" class="outline-4">
<h4 id="org14dbdd3"><span class="section-number-4">10.5.2</span> The factory constructor <b>class Presenter onSubject: aSubject = Fragment (..)</b></h4>
<div class="outline-text-4" id="text-10-5-2">
<p>
The factory constructor has the exact signature 
</p>

<p>
<code>public class Presenter onSubject: aSubject &lt;Subject&gt; = Fragment (..)</code>
</p>

<p>
It creates a presenter on subject, and also establishes the  association from Presenter instance to Subject instance as slot <code>Presenter&gt;&gt;subject</code>.
</p>
</div>
</div>



<div id="outline-container-org557a928" class="outline-4">
<h4 id="org557a928"><span class="section-number-4">10.5.3</span> The unimplemented (abstract) methods: <b>Presenter&gt;&gt;#definition</b> and <b>Presenter&gt;&gt;#isMyKind: fragment</b></h4>
<div class="outline-text-4" id="text-10-5-3">
<p>
The precise signatures of unimplemented methods that each concrete Presenter must provide:
</p>

<ul class="org-ul">
<li><code>Presenter&gt;&gt;#public definition ^&lt;Fragment&gt;</code> should create and return the actual "widget" (presentation view)</li>

<li><code>Presenter&gt;&gt;#isMyKind: f &lt;Fragment&gt; ^&lt;Boolean&gt;</code> is repetitive but required. It is inherited from class <code>Fragment</code>. We have a common chapter for this, see <a href="#orgc85ff4d">The formulaic required repetitive methods of #isMyKind: and #isKindOfX</a></li>
</ul>
</div>

<div id="outline-container-org93e4f08" class="outline-5">
<h5 id="org93e4f08"><span class="section-number-5">10.5.3.1</span> The method <b>Presenter&gt;&gt;#definition</b> - provides the UI view</h5>
<div class="outline-text-5" id="text-10-5-3-1">
<p>
Full signature is <code>Presenter&gt;&gt;#definition ^&lt;Fragment&gt;</code>.
</p>

<p>
This method is of core significance when writing UIs.
</p>

<p>
The concrete implementations should return the actual "widget" (presentation) - basically, <b>this method returns the widget we want to see in the UI</b>.
</p>

<pre class="example" id="org11dc363">
public definition ^&lt;Fragment&gt; = (
  subclassResponsibility
)
</pre>

<p>
For a sample implementation, see the <code>#definition</code> method in <a href="#orgfd0c34f">Class CheckedItemPresenter</a>, or in the complete code in <a href="#org7661033">5. Complete code and UI of the <b>CheckedItemApp</b></a>.
</p>
</div>
</div>
</div>


<div id="outline-container-org39267e9" class="outline-4">
<h4 id="org39267e9"><span class="section-number-4">10.5.4</span> Instance methods on Presenter that create instances of Fragments</h4>
<div class="outline-text-4" id="text-10-5-4">
<p>
Fragments are UI Widgets.
</p>

<p>
It is worth realizing there are instance methods on Presenter which can create Fragments (widgets). Such widgets perform
</p>
<ul class="org-ul">
<li>layout (see method <code>#row:</code> or <code>#column:</code> on class Presenter)</li>
<li>"atomic" widgets (see method <code>#button: label</code> or <code>checkbox: text</code></li>
</ul>

<p>
Browse the IDE for more details.
</p>
</div>
</div>



<div id="outline-container-orgc4a7a1a" class="outline-4">
<h4 id="orgc4a7a1a"><span class="section-number-4">10.5.5</span> Presenter extends Fragment</h4>
<div class="outline-text-4" id="text-10-5-5">
<p>
In addition, from the Presenter factory
</p>

<pre class="example" id="org2195a36">
public class Presenter onSubject: aSubject &lt;Subject&gt; = Fragment (
  |
  public subject &lt;Subject&gt; ::= aSubject.
  substanceSlot &lt;Fragment&gt;
  public generation &lt;Number&gt; = uiGeneration.
  |)
</pre>

<p>
we see that Presenter extends Fragment.
</p>

<p>
What is Fragment and what is it's role? Let us look at Fragment in a separate chapter.
</p>
</div>
</div>
</div>



<div id="outline-container-orgaf78778" class="outline-3">
<h3 id="orgaf78778"><span class="section-number-3">10.6</span> The <b>Fragment</b> class</h3>
<div class="outline-text-3" id="text-10-6">
<p>
From looking at <code>Presenter</code>, we have already seen that <code>Fragment</code> is a base class for Presenter. <code>Fragment</code> is the root of the hierarchy for logical UI tree nodes.
</p>

<p>
Although an important part of HopscotchForHTML5, we will not talk about Fragments beside showing it's slots - reason is we will not need Fragment to write our concrete simple app.
</p>

<pre class="example" id="org3d14bd2">
class Fragment = (

  |
	visualX
	public parent
	public size ::= nil.
	public expansibility ::= 0.
	public compressibility ::= 0.
	decorators
	|)
</pre>
</div>
</div>


<div id="outline-container-org7cbf877" class="outline-3">
<h3 id="org7cbf877"><span class="section-number-3">10.7</span> Summary of <b>Subject</b> and it's model, <b>Presenter</b> and <b>Fragment</b>, their associations, and their lifecycle</h3>
<div class="outline-text-3" id="text-10-7">
<p>
Let us summarize the core classes of Hopscotch: <b>Subject</b> and it's model, <b>Presenter</b> and <b>Fragment</b> described in chapters above.
</p>

<ol class="org-ol">
<li><p>
<code>Subject</code>: can be thought of as "address + viewport"; is passed to NavigationHistory; instantiates it's Presenter;
</p>

<p>
See <a href="#org3fbff6f">The <b>Subject</b> class: Factory constructor, instance methods, how Subject knows Presenter</a>
</p></li>

<li><p>
<code>Presenter</code>: presents domain objects; is part of hierarchical structure of presenters; instantiates and controls Widgets (Fragments); once instantiated, is the UI presentation of it's Subject;
</p>

<p>
See <a href="#orge00d8b1">The <b>Presenter</b> class: Factory constructor, instance methods, how Presenter knows Subject</a>
</p></li>

<li>Important methods:

<ul class="org-ul">
<li><code>Subject&gt;&gt;#presenter</code> - calls <code>Subject&gt;&gt;#createPresenter</code> then <b>associates Subject -&gt; Presenter</b>. See <a href="#org801c63a">Where is Subject -&gt; Presenter association created? In <b>Subject&gt;&gt;#presenter</b></a></li>
<li><code>Subject&gt;&gt;#createPresenter</code> creates and returns the presenter instance by calling the concrete Presenter's factory method. See <a href="#orgfe0b0d0">The unimplemented (abstract) methods: <b>Subject&gt;&gt;#createPresenter</b> and <b>Subject&gt;&gt;#isMyKind: otherSubject</b></a></li>
<li><code>Presenter&gt;&gt;#definition</code> creates the Fragment the presenter uses to present itself (view). See <a href="#org557a928">The unimplemented (abstract) methods: <b>Presenter&gt;&gt;#definition</b> and <b>Presenter&gt;&gt;#isMyKind: fragment</b></a></li>
<li><code>class Subject&gt;&gt;#onModel: aModel</code> - <b>factory constructor associates Subject -&gt; Model</b>. See <a href="#orgc723230">The factory constructor <b>public class Subject onModel: aModel = (..)</b></a></li>
<li><code>class Presenter&gt;&gt;#onSubject: selfSubject</code> - <b>factory constructor associates Presenter -&gt; Subject</b>. See <a href="#org14dbdd3">The factory constructor <b>class Presenter onSubject: aSubject = Fragment (..)</b></a></li>
</ul></li>

<li><p>
We established that associations between <code>*Subject* and it's model, *Presenter* and *Fragment*</code> are as follows:
</p>
<ul class="org-ul">
<li><b>Presenter -&gt; Subject -&gt; Model</b></li>
<li><b>Presenter &lt;- Subject &lt;-w Model</b> (-&gt; and &lt;- means association, &lt;-w means weak association- my not exist)</li>
<li>Both directions in the <b>Presenter &lt;-&gt; Subject</b> association are established by calling the <code>Subject&gt;&gt;#presenter</code> method</li>
<li>The <b>Subject -&gt; Model</b> association is established in the Subject factory constructor <code>Subject class&gt;&gt;#onModel: aModel</code>.</li>
</ul>

<p>
See <a href="#org801c63a">Where is Subject -&gt; Presenter association created? In <b>Subject&gt;&gt;#presenter</b></a> and <a href="#org40671b6">Where is Presenter -&gt; Subject association created? In the Presenter factory constructor <b>Presenter&gt;&gt;#class Presenter onSubject: aSubject = Fragment</b></a>
</p></li>

<li>Lifecycle discoveries: We need to create a model first, a subject next, a presenter last. See <a href="#org42e82ed">Chapter conclusion about principles of writing rudimentary Hopscotch UI</a> for many details and also  <a href="#org9cfef77">Discovery of the <b>HopscotchForHTML5</b> class basics</a></li>

<li>Presenter should not be constructed in code directly using it's factory constructor. It should be constructed indirectly as <code>hopscotchWindow openSubject: concreteSubject.</code>. See <a href="#org42e82ed">Chapter conclusion about principles of writing rudimentary Hopscotch UI</a>.</li>

<li>To implement some concrete UI, developer should:
<ul class="org-ul">
<li>implement classes for <code>ConcreteModel</code>,  <code>ConcreteSubject</code>, and <code>ConcretePresenter</code></li>
<li>All abstract methods in the above classes must be implemented. In particular, code methods to implement are
<ul class="org-ul">
<li><code>ConcreteSubject&gt;&gt;#createPresenter</code> which should create and return presenter for the subject. This should return typically, <code>ConcretePresenter onSubject: self</code></li>
<li><code>ConcretePresenter&gt;&gt;#define</code> which should create and return the Fragment (Presenter). This is a widget or multiple widgets layed out (e.g. row with a checkbox, label, and an icon)</li>
</ul></li>
<li>Write rudimentary code in <a href="#org42e82ed">Chapter conclusion about principles of writing rudimentary Hopscotch UI</a></li>
</ul></li>
</ol>


<p>
The above steps should be sufficient to write a basic App with Hopscotch UI, which we will do in later chapter <a href="#orgb3a4bfa">Using chapters above to write a simple Hopscotch UI App, the <b>CheckedItemApp</b></a>.
</p>
</div>
</div>



<div id="outline-container-orgefdb0e8" class="outline-3">
<h3 id="orgefdb0e8"><span class="section-number-3">10.8</span> Back to <b>HopscotchForHTML5</b> and how it relates to <b>HopscotchForHTML5Runtime</b></h3>
<div class="outline-text-3" id="text-10-8">
</div>
<div id="outline-container-org4d11815" class="outline-4">
<h4 id="org4d11815"><span class="section-number-4">10.8.1</span> Chapter goal</h4>
<div class="outline-text-4" id="text-10-8-1">
<p>
The goal of this chapter is to discover more about <code>HopscotchForHTML5</code> and how it relates to <code>HopscotchForHTML5Runtime</code>.
</p>

<p>
Ok, so we "know" that <code>HopscotchForHTML5</code> provides the Newspeak UI for the web version. We have seen it defines (as nested classes) the core UI classes <code>Subject</code>, <code>Presenter</code>, and <code>Fragment</code>.
</p>

<p>
Looking at the top level, we see two related classes, <code>HopscotchForHTML5</code> and <code>HopscotchForHTML5Runtime</code>. So what is the latter class good for?
</p>
</div>
</div>



<div id="outline-container-orga02c8f9" class="outline-4">
<h4 id="orga02c8f9"><span class="section-number-4">10.8.2</span> The <b>HopscotchForHTML5</b> class</h4>
<div class="outline-text-4" id="text-10-8-2">
<p>
Let us get back for a minute to <code>HopscotchForHTML5</code>. We have seen, that is has a ton of slots and classes we would associate with UI elements, such as
</p>

<pre class="example" id="org22fe040">
(* Factory constructor *)
class HopscotchForHTML5 usingPlatform: p images: images ducts: ds = (
  |
  (* Imports *)
  private Color = p graphics Color.
  private Context = p graphics Context.
  private Holder = ds Holder.
  private Font = p fonts Font.
  .. etc ..
  public styleZebraPrimaryColor = Color white.
  public styleZebraSecondaryColor = Color gray: 0.97.
  |)
</pre>

<pre class="example" id="org1380c00">
(* Selected nested classes *)
class ButtonFragment
class DatePickerFragment
.. etc ..
class Subject
class Presented
class Fragment
.. etc ..
</pre>

<p>
We alreary concluded that we will need an instance of <code>HopscotchForHTML5</code> if we want to build any UI for our Apps.
</p>
</div>
</div>


<div id="outline-container-orgf718780" class="outline-4">
<h4 id="orgf718780"><span class="section-number-4">10.8.3</span> The <b>HopscotchForHTML5Runtime</b> class</h4>
<div class="outline-text-4" id="text-10-8-3">
<p>
Analyzing the class <code>HopscotchForHTML5Runtime</code>, we see that:
</p>

<ul class="org-ul">
<li>It has the factory constructor <code>#packageUsing: manifest</code>. From the Api chapters, for example  <a href="#org818d945">4. App module: API of module that needs to be distributed as an App</a> we know that such top level classes are apps, but, lacking the <code>#main: platform args: args</code> method, such module is used as library module.</li>

<li>It packages the UI class, <code>HopscotchForHTML5</code>, on it's slot</li>

<li>It has a instance method <code>#using: platform</code>, which calls the factory method of <code>PlatformWithHopscotch</code> and returns it's instance.</li>
</ul>

<p>
<code>HopscotchForHTML5Runtime</code>
</p>
<pre class="example" id="org5fe1038">
(* Factory constructor *)
class HopscotchForHTML5Runtime packageUsing: manifest = (
	|
	private Fonts = manifest FontsForHTML5.
  private Graphics = manifest GraphicsForHTML5.
	private TextModule = manifest TextModule.
	private Hopscotch = manifest HopscotchForHTML5.
  private Ducts = manifest Ducts.
	private images = Images packageUsing: manifest.
	|
)

(* instance method *)
public using: platform = (
	^PlatformWithHopscotch usingPlatform: platform
)
</pre>

<p>
The presence of the two methods clearly shows  <code>HopscotchForHTML5Runtime</code> packages all three classes (HopscotchForHTML5, Ducts, images) that we will need to create <code>HopscotchForHTML5</code> using its factory constructor <code>HopscotchForHTML5&gt;&gt;#usingPlatform: p images: images ducts: ds</code>.
</p>

<p>
<b>So, the HopscotchForHTML5Runtime packages everything we need for HopscotchForHTML5</b>
</p>

<p>
In addition, we see that the inner class <code>HopscotchForHTML5Runtime&gt;&gt;PlatformWithHopscotch</code> is a convenience class which already pre-creates instance of <code>HopscotchForHTML5</code> in this <code>PlatformWithHopscotch</code> snippet:
</p>

<pre class="example" id="org9dfe7f3">
(* Factory constructor *)
class PlatformWithHopscotch usingPlatform: platform = (
	|
    public isKindOfPlatformWithElectron = platform isKindOfPlatformWithElectron.	
    public kernel = platform kernel.
    public collections = platform collections.
    public actors = platform actors.
    public mirrors = platform mirrors.    
    public js = platform js.
    public operatingSystem = platform operatingSystem.
    public fonts = Fonts usingPlatform: self.
    public graphics = Graphics usingPlatform: self.
    public text = TextModule usingPlatform: self.
    public hopscotch = Hopscotch usingPlatform: self images: images ducts: (Ducts usingPlatform: self).
    public local = platform.
    public victoryFuel = platform operatingSystem = 'emscripten' ifTrue: [platform victoryFuel].
	|
)
</pre>

<p>
<b>A core question: what object is in the slot <code>hopscotch</code> in the above factory?</b> Let's follow these points:
</p>

<ol class="org-ol">
<li><p>
<code>HopscotchForHTML5Runtime</code>, the outer class of <code>PlatformWithHopscotch</code> creates this slot:
</p>

<p>
<code>private Hopscotch = manifest HopscotchForHTML5.</code>
</p>

<p>
clearly, the <code>Hopscotch</code> slot on <code>HopscotchForHTML5Runtime</code> holds the class <code>HopscotchForHTML5</code>.
</p></li>

<li><p>
Next we see this line in the <code>PlatformWithHopscotch</code> factory constructor above - the <code>class PlatformWithHopscotch usingPlatform: platform</code>:
</p>

<p>
<code>public hopscotch = Hopscotch usingPlatform: self images: images ducts: (Ducts usingPlatform: self)</code>
</p>

<p>
uses the expression <code>Hopscotch</code>. What does it refer to?? In Newspeak, an expression like this used in a factory constructor slot, must be somewhere in the scope of the factory constructor's scope! The only items in scope there, must be in a slot of a parent class! Parent class of <code>PlatformWithHopscotch</code> is <code>HopscotchForHTML5Runtime</code>. So this <code>Hopscotch</code> we are talking about here refers to a <code>Hopscotch</code> slot in <code>HopscotchForHTML5Runtime</code>. And we have seen in item 1, that it holds the class <code>HopscotchForHTML5</code>. As a result, the factory constructor in
</p>

<p>
<code>public hopscotch = Hopscotch usingPlatform: self images: images ducts: (Ducts usingPlatform: self)</code>
</p>

<p>
is the same as
</p>

<p>
<code>public hopscotch = HopscotchForHTML5 usingPlatform: self images: images ducts: (Ducts usingPlatform: self)</code>
</p></li>
</ol>



<p>
From there we have the answer to our core question of this paragraph: <b>The slot <code>hopscotch</code> in the factory for PlatformWithHopscotch is instance of <code>HopscotchForHTML5</code></b>
</p>

<p>
<b>Now let's draw two conclusions we arrived at in this paragraph:</b>
</p>

<ol class="org-ol">
<li><b>Conclusion 1. The module HopscotchForHTML5Runtime is a packaging library for instances of HopscotchForHTML5. By packaging the runtime, everything we need to write UI code is available in the HopscotchForHTML5 instance. How do we get such instance? This is described in Conclusion 2.</b></li>

<li><p>
<b>Conclusion 2. Any code that is able to create <code>hopscotchForHTML5Runtime</code>, an instance of <code>HopscotchForHTML5Runtime</code> will have access to instance of <code>HopscotchForHTML5</code> using the second line below:</b>
</p>

<p>
<code>hopscotchForHTML5Runtime using: platform.</code> &lt;== this is instance of PlatformWithHopscotch
<code>(hopscotchForHTML5Runtime using: platform) hopscotch.</code> &lt;== hopscotch is the slot on PlatformWithHopscotch. It is instance of HopscotchForHTML5 as we have seen above.
</p></li>
</ol>


<p>
Summary: In this chapter, we deduced code we need to obtain <code>hopscotch</code>, an instance of <code>HopscotchForHTML5</code>. This instance is all we need to write any Newspeak UI!
</p>
</div>
</div>
</div>


<div id="outline-container-orgb3a4bfa" class="outline-3">
<h3 id="orgb3a4bfa"><span class="section-number-3">10.9</span> Using chapters above to write a simple Hopscotch UI App, the <b>CheckedItemApp</b></h3>
<div class="outline-text-3" id="text-10-9">
</div>
<div id="outline-container-org053d6d0" class="outline-4">
<h4 id="org053d6d0"><span class="section-number-4">10.9.1</span> Chapter goal</h4>
<div class="outline-text-4" id="text-10-9-1">
<p>
This chapter goal is to use the intuition and knowledge acquired in the above chapters, to write a sample UI App in Newspeak. 
</p>

<p>
Let us name the app class <code>CheckedItemApp</code>. The reason for the name is clarified in <a href="#orged2b03b">3. Write code for <b>CheckedItemUI</b>, the class showing the UI</a>.
</p>

<p>
We will do our best by deducting the App structure and UI and code just by browsing and applying the knowledge developed by browsing the <code>HopscotchForHTML5</code> in chapters above - without looking at the pre-existing <code>CounterApp</code> sample app, see <a href="#orgba53dc6">Build, run, and debug the CounterApp in Newspeak (in the online version)</a>.
</p>

<p>
The App and it's UI are built step by step in the subchapters below.
</p>

<p>
Note that only Step 3, <a href="#orged2b03b">3. Write code for <b>CheckedItemUI</b>, the class showing the UI</a> will be using the knowledge from this chapter.  The rest of the steps use the knowledge about APIs needed to write a Newspeak App. This knowledge was developed in 
</p>
</div>
</div>


<div id="outline-container-org7ebbfcc" class="outline-4">
<h4 id="org7ebbfcc"><span class="section-number-4">10.9.2</span> 1. Start coding the Application class <b>CheckedItemApp</b></h4>
<div class="outline-text-4" id="text-10-9-2">
<p>
We will use information about APIs that define a Newspeak App from chapter  <a href="#org818d945">4. App module: API of module that needs to be distributed as an App</a>  and  <a href="#orgc4a4799">3. Hello World App</a>  to create the application class <code>CheckedItemApp</code>.
</p>

<p>
As a start, we borrow code from the Hello World App to create a top level App class:
</p>

<p>
<code>class CheckedItemApp</code>
</p>
<pre class="example" id="org46f86a8">
class CheckedItemApp packageUsing: manifest = ()
(
  public main: platform args: args = (
    'Hello World from HelloWorldApp' out.
  )
)
</pre>

<p>
To recap, the methods <code>#packageUsing: manifest</code> and <code>#main: platform args: args</code> make this top level class a packageble, distributable, and runnable Newspeak app.
</p>
</div>
</div>


<div id="outline-container-orgc9ffbf8" class="outline-4">
<h4 id="orgc9ffbf8"><span class="section-number-4">10.9.3</span> 2. Add code to the <b>CheckedItemApp</b> which allows to "import" the Hopscotch module</h4>
<div class="outline-text-4" id="text-10-9-3">
</div>
<div id="outline-container-orgcffb4da" class="outline-5">
<h5 id="orgcffb4da"><span class="section-number-5">10.9.3.1</span> Add the packaging of the HopscotchForHTML5 module</h5>
<div class="outline-text-5" id="text-10-9-3-1">
<p>
In this chapter, we to progress the code of the app we want to build by adding things that allow us to build a UI.
</p>

<p>
We start with renaming <code>HelloWorldApp</code> to <code>CheckedItemApp</code>, that is simple.
</p>

<p>
In chapter  <a href="#org818d945">4. App module: API of module that needs to be distributed as an App</a>  and modularity chapters earlier, we saw that an App must package (bring along) all classes and instances that it will need to create the deployment artifact. Packaging is done in factory constructors of Apps - the <code>#packageUsing: manifest</code>.
</p>

<p>
We need to package the HopscotchForHTML5 module. We use Conclusion 2 at the end of chapter <a href="#orgf718780">The <b>HopscotchForHTML5Runtime</b> class</a> to package an instance of <code>HopscotchForHTML5Runtime</code>. (This will will carry the <code>HopscotchForHTML5</code> instance in it, as discussed there).
</p>

<p>
Note that for the packaged instance to be usable when running the app, we need to keep the packaged instance <code>hopscotchForHTML5Runtime</code> on a slot (as a member). So we also need to add the slots section | .. |. 
</p>


<p>
<code>class CheckedItemApp</code>
</p>
<pre class="example" id="org43d8f75">
class CheckedItemApp packageUsing: manifest = (
  (* Added this 3-line section *)
  |
  hopscotchForHTML5Runtime = manifest HopscotchForHTML5Runtime packageUsing: manifest.
  |
)
(
  public main: platform args: args = (
    
    'Hello World from HelloWorldApp' out.
  )
)
</pre>

<p>
While we keep the full code listed here, to only paste the added section, find the <code>CheckedItemApp&gt;&gt;#packageUsing: manifest</code> method in the IDE, and paste the 3-line section there.
</p>


<div id="orged299c1" class="figure">
<p><img src="/img/newspeak---a-few-notes.org-checked-item-app-step-3.png" alt="nil"/>
</p>
</div>
</div>
</div>


<div id="outline-container-org5d457b0" class="outline-5">
<h5 id="org5d457b0"><span class="section-number-5">10.9.3.2</span> Add the hopscotchForHTML5 module that will allow us to build UI</h5>
<div class="outline-text-5" id="text-10-9-3-2">
<p>
Next, we know that in the <code>main: platform args: args</code> method where the App starts, we will need to obtain or create an instance of <code>HopscotchForHTML5</code> to be able to build any UI. 
</p>

<p>
In the conclusion of chapter <a href="#orgf718780">The <b>HopscotchForHTML5Runtime</b> class</a>, we saw that we can get at instance of the UI creating object hopscotchForHTML5, as follows:
</p>

<p>
<code>hopscotchForHTML5Runtime using: platform.</code> &lt;== this is instance of PlatformWithHopscotch
<code>(hopscotchForHTML5Runtime using: platform) hopscotch.</code> &lt;== hopscotch is the slot on PlatformWithHopscotch. It is instance of HopscotchForHTML5
</p>

<p>
So let us add that code to our <code>CheckedItemApp&gt;&gt;#main:args</code>:
</p>

<p>
<code>class CheckedItemApp</code>
</p>
<pre class="example" id="org34a4343">
class CheckedItemApp packageUsing: manifest = (
  |
  hopscotchForHTML5Runtime = manifest HopscotchForHTML5Runtime packageUsing: manifest.
  |
)
(
  public main: platform args: args = (
    (* Added this 5-line section *)
    |
    platformWithHopscotch = platform isKindOfPlatformWithHopscotch ifTrue: [platform]
                                                                   ifFalse: [hopscotchForHTML5Runtime using: platform].   
    hopscotchForHTML5 = platformWithHopscotch hopscotch.
    |
    
    'Hello World from HelloWorldApp' out.
  )
)
</pre>

<p>
In the IDE, find the already created method <code>CheckedItemApp&gt;&gt;#main: platform args: args</code> and paste the added 5-line section there. If you skipped the chapter where <code>#main:args:</code> was first created, in the IDE, use + to add an instance method to <code>CheckedItemApp</code> (make sure it is an instance method, not a constructor).
</p>

<p>
The expression defining the <code>platformWithHopscotch</code> is perhaps the only thing we did not fully explain in this exploration. We did explain the "true" branch but not the "false" branch. There is a detail description in the final code, see <a href="#org7661033"> 5. Complete code and UI of the <b>CheckedItemApp</b></a>.
</p>
</div>
</div>
</div>


<div id="outline-container-orged2b03b" class="outline-4">
<h4 id="orged2b03b"><span class="section-number-4">10.9.4</span> 3. Write code for <b>CheckedItemUI</b>, the class showing the UI</h4>
<div class="outline-text-4" id="text-10-9-4">
<p>
Chapter introduction and goal: In this chapter, we will write the core of the UI for the application. This code will be added as several nested classes to a top level class we will name <code>CheckedItemUI</code>.  To write this UI, we will use the knowledge discovered and summarized in chapter <a href="#org7cbf877">Summary of <b>Subject</b> and it's model, <b>Presenter</b> and <b>Fragment</b>, their associations, and their lifecycle</a>.   We will need to create concrete classes for the <b>Model, Subject and Presenter</b>, then we will need to instantiate those classes (in that order) to form the UI.
</p>

<p>
The UI will be extremely simple: a label with text "check this", and one check box. We should be able to check the checkbox. That is all.
</p>

<p>
Note that we will not write any <b>Fragment</b> (Widget) classes, we only use some preexisting fragment-creation methods discovered by browsing <code>HopscotchForHTLM5&gt;&gt;Presenter</code> such as <code>#row:</code>, <code>#label:</code> and <code>#checkbox:</code>.
</p>

<p>
Chapters below describe writing the code step by step.
</p>
</div>

<div id="outline-container-org8ea8a77" class="outline-5">
<h5 id="org8ea8a77"><span class="section-number-5">10.9.4.1</span> Class CheckedItemUI</h5>
<div class="outline-text-5" id="text-10-9-4-1">
<p>
Let's add a new top level class <code>CheckedItemUI</code>.
</p>

<p>
Note: We recall, instances of top level classes are called modules, and behave that way.  The top level class <code>CheckedItemUI</code>, provides a natural namespace, so the classes' naming prefix <code>CheckedItem</code> in <code>CheckedItemModel</code> and other nested classes introduced in this chapter is not needed. We will keep the class names prefix for the purpose of clarity of the text.
</p>

<p>
We plan for the new top level class <code>CheckedItemUI</code> to contain:
</p>

<ol class="org-ol">
<li>Slots needed to create elements in the instance of this class.</li>

<li>Nested classes <code>CheckedItemModel</code>, <code>CheckedItemSubject</code> and <code>CheckedItemPresenter</code> which we will create below. Important: Notice that these classes are nested in the top level class <code>CheckedItemUI</code>.  This is a natural modularization we would use in Newspeak. Also notice this nesting mimics the nesting of <code>Subject</code> and <code>Presenter</code> in the module <code>HopscotchForHTML5</code>.</li>
</ol>


<p>
At this point, we create only the barenones of our UI, like this:
</p>

<p>
<code>class CheckedItemUI</code>
</p>
<pre class="example" id="org2e2eb5e">
class CheckedItemUI = () ()
</pre>

<p>
We will add it's factory constructor, slots, and it's nested classes along the way in later chapters, describing why each such element is needed.  In particular we will add:
</p>

<ul class="org-ul">
<li>The nested classes will be added naturally by adding them inside <code>CheckedItemUI</code> in the IDE. This happens in chapters <a href="#orgdfadd5b">Class CheckedItemModel</a>,  <a href="#orga25db13">Class CheckedItemSubject</a>,  and <a href="#orgfd0c34f">Class CheckedItemPresenter</a> .</li>

<li>The factory constructor and slots will be added once we finish the rest of the app code and the UI code - in chapter <a href="#org74ed277">When the app runs in the <b>#main:args:</b> method, instantiate the <b>CheckedItemUI</b></a> and its subchapters.</li>
</ul>
</div>
</div>


<div id="outline-container-orgdfadd5b" class="outline-5">
<h5 id="orgdfadd5b"><span class="section-number-5">10.9.4.2</span> Class CheckedItemModel</h5>
<div class="outline-text-5" id="text-10-9-4-2">
<p>
As discussed in <a href="#org7cbf877">Summary of <b>Subject</b> and it's model, <b>Presenter</b> and <b>Fragment</b>, their associations, and their lifecycle</a>, we start writing UI with writing the model class. As this is a part of the UI, a natural way to express such composition is to make the model class <b>a nested class in <code>CheckedItemUI</code>.</b>
</p>

<p>
Let's name the model class <code>CheckedItemModel</code>.
</p>

<p>
To support the UI, we need two items in our  model: a string for label, and a Boolean representing if the checkbox was selected. Our model class extends Object by default; it's factory constructor is the default <code>#new</code> method. Neither the default parent class Object nor the default factory constructor <code>#new</code> need to be specified in Newspeak. 
</p>

<p>
<code>class CheckedItemModel</code>
</p>
<pre class="example" id="org46f45be">
public class CheckedItemModel = (
|
  public label ::= 'check to complete'.
  public isChecked ::= false.
  |
)
()
</pre>

<p>
Add the above code as a nested class of <code>CheckedItemUI</code>, by clicking the + beside "Classes" inside CheckedItemUI, and pasting the code in the text area.
</p>


<div id="org8ac7f02" class="figure">
<p><img src="/img/newspeak---a-few-notes.org-add-nested-class-checked-item-model.png" alt="nil"/>
</p>
</div>

<p>
Click the "Accept" button <img src="/img/newspeak---a-few-notes.org-accept-image.png" alt="nil"/> to save the added class.
</p>
</div>
</div>



<div id="outline-container-orga25db13" class="outline-5">
<h5 id="orga25db13"><span class="section-number-5">10.9.4.3</span> Class CheckedItemSubject</h5>
<div class="outline-text-5" id="text-10-9-4-3">
<p>
Having defined a model class <code>CheckedItemModel</code>, we need to define our UI's concrete Subject class, let's name it <code>CheckedItemSubject</code>. Naturally, it will be an extension of Subject. As mentioned, it will be nested in <code>CheckedItemUI</code>.
</p>

<p>
Recall from <a href="#org3fbff6f">The <b>Subject</b> class: Factory constructor, instance methods, how Subject knows Presenter</a> that the factory constructor of Subject is <code>Subject&gt;&gt;#onModel: model</code>. This will associate subject with it's model.  We will use the same name for the factory constructor for our <code>CheckedItemSubject</code> and call the super factory from Subject.
</p>

<p>
We will also use the knowledge from the same chapter regarding it's factory constructor and abstract methods we need to implement. Let us summarize it here again: 
</p>

<ul class="org-ul">
<li>The factory constructor of our <code>CheckedItemSubject</code> will call the factory constructor of it's parent, <code>Subject&gt;&gt;#onModel: model</code>.  This is expressed by the signature <code>public class CheckedItemSubject onModel: model = Subject onModel: model</code> where our new class calls the super constructor <code>Subject&gt;&gt;#onModel: model</code>.</li>

<li><code>Subject</code> class has an abstract method <code>#createPresenter</code> (indicated by "subclassResponsibility") which should return a presenter. In the same link, we saw that <code>#createPresenter</code> should create an instance of Presenter (the yet-to-be-created <code>CheckedItemPresenter</code>). The instance should then be returned.</li>

<li>We need to add the formulaic implementations of <code>#isMyKind</code> and <code>#isKindOfCheckedItemSubject</code>. See <a href="#orgc85ff4d">The formulaic required repetitive methods of #isMyKind: and #isKindOfX</a>.</li>
</ul>

<p>
So the code for our concrete Subject <code>CheckedItemSubject</code> which implements the desired factory constructor and all abstract methods implemented should be:
</p>

<p>
<code>class CheckedItemSubject</code>
</p>
<pre class="example" id="org984bddc">
public class CheckedItemSubject onModel: model = Subject onModel: model (
)(
  createPresenter = (
    ^CheckedItemPresenter onSubject: self.
  )

  (* required isMyKind and isKindOfX formulaic methods *)
  isMyKind: other = (
    ^ other isKindOfCheckedItemSubject.
  )
  isKindOfCheckedItemSubject = (
    ^ true.
  )
)
</pre>

<p>
As with the model, add an inner class of CheckedItemUI by clicking the + beside Classes inside CheckedItemUI, then paste the code above in the text area:
</p>


<div id="orgf0bb53a" class="figure">
<p><img src="/img/newspeak---a-few-notes.org-add-inner-class-checked-item-subject.png" alt="nil"/>
</p>
</div>

<p>
Click the "Accept" button <img src="/img/newspeak---a-few-notes.org-accept-image.png" alt="nil"/> to save the added class.
</p>
</div>
</div>


<div id="outline-container-orgfd0c34f" class="outline-5">
<h5 id="orgfd0c34f"><span class="section-number-5">10.9.4.4</span> Class CheckedItemPresenter</h5>
<div class="outline-text-5" id="text-10-9-4-4">
<p>
Having defined a model class <code>CheckedItemModel</code> and a subject class <code>CheckedItemSubject</code>, we will need the last piece of our UI, the concrete Presenter class.
</p>

<p>
Presenter is the class which does the work of creating the UI widgets. We have seen in chapter <a href="#orge00d8b1">The <b>Presenter</b> class: Factory constructor, instance methods, how Presenter knows Subject</a> that Presenter is created in the factory constructor <code>Presenter&gt;&gt;#onSubject: subject</code>, and it contains important wiring of the subject and presenter associations. Our concrete class factory constructor must do the same, so it needs to call this parent factory. This is done using factory method <code>CheckedItemPresenter onSubject: subject = Presenter onSubject: subject ()</code>  
</p>

<p>
For a concrete UI, method which creates the UI view is <code>#definition</code>. It does that by creating and returning Fragmets or Presenter objects. The created objects can be a composition of both layout elements such as rows and columns, and widgets such as checkboxes and labels.
</p>

<p>
Also, we will need <a href="#orgc85ff4d">The formulaic required repetitive methods of #isMyKind: and #isKindOfX</a>.
</p>

<p>
Add the following code for class <code>CheckedItemPresenter</code>. As with the model and presenter, we make the <code>CheckedItemPresenter</code> an inner class of CheckedItemUI, by clicking the + beside Classes inside CheckedItemUI.
</p>

<p>
<code>class CheckedItemPresenter</code>
</p>
<pre class="example" id="org9664fb1">

public class CheckedItemPresenter onSubject: subject = Presenter onSubject: subject (
) (
public definition = (

    ^column: {
      label: 'column label: Rudiments of Todo list.'.
      (checkbox: subject model label
       value: subject model isChecked
       action: [  :aaachecked | updateGUI: 
                           [  (subject model isChecked)
                                  ifTrue: [subject model isChecked: false]
                                  ifFalse: [subject model isChecked: true]
                            ]
                        ]
      ).
    }. 
  )

  isMyKind: other = (
    ^other isKindOfCheckedItemPresenter.
  )

  isKindOfCheckedItemPresenter = (
    ^true.
  )

)
</pre>
</div>
</div>
</div>



<div id="outline-container-org519e122" class="outline-4">
<h4 id="org519e122"><span class="section-number-4">10.9.5</span> 4. Integrate the <b>CheckedItemUI</b> into the <b>CheckedItemApp</b></h4>
<div class="outline-text-4" id="text-10-9-5">
<p>
So far we have prepared two separate classes:
</p>

<ol class="org-ol">
<li><code>CheckedItemApp</code>: We added this class in <a href="#org5d457b0">Add the hopscotchForHTML5 module that will allow us to build UI</a>, as a the top level class. We equipped the class with API methods that make the class instance an application. We also added the <code>hopscotchForHTML5</code> object on a slot with the same name in the <code>#main:args</code> method. The <code>hopscotchForHTML5</code> object has everything we need to write our simple UI - but of course we also need to write code for the UI.  We did that as well - see next item on the list</li>
<li><code>CheckedItemUI</code>: We added this class in step <a href="#orged2b03b">3. Write code for <b>CheckedItemUI</b>, the class showing the UI</a>. In that step, we also added the code that creates a row of widgets (fragments) in the <code>CheckedItemUI&gt;&gt;#define</code> method.</li>
</ol>


<p>
In the rest of this chapter, we finish integrating the <code>CheckedItemUI</code> into the <code>CheckedItemApp</code> by creating an instance of <code>CheckedItemUI</code>.  This instance creation will perform the process of showing our UI, defined in the <code>CheckedItemUI&gt;&gt;#define</code> method.
</p>
</div>

<div id="outline-container-org81fc064" class="outline-5">
<h5 id="org81fc064"><span class="section-number-5">10.9.5.1</span> Package the <b>CheckedItemUI</b> class into the <b>CheckedItemApp</b></h5>
<div class="outline-text-5" id="text-10-9-5-1">
<p>
As we know, Newspeak must explicitly package all dependencies that may not exist on the target system where we deploy our <code>CheckedItemApp</code> app.
</p>

<p>
The packaging is done inside the IDE in convention named method <code>CheckedItemApp&gt;&gt;#packageUsing: manifest</code>.
</p>

<p>
The code changes we need to make to achieve the dependency packaging is marked here:
</p>

<p>
<code>class CheckedItemApp</code>
</p>
<pre class="example" id="org2cfab0d">
class CheckedItemApp packageUsing: manifest = (
  |
  hopscotchForHTML5Runtime = manifest HopscotchForHTML5Runtime packageUsing: manifest.
  (* Added 1-line to package the CheckedItemUI class on slot with same name *)
  CheckedItemUI = manifest CheckedItemUI.
  |
)
</pre>

<p>
The <code>CheckedItemUI</code> class is pulled (from manifest) and stored on a slot named <code>CheckedItemUI</code> (this is customary, to name the slot same as the class name, but does not have to be). This is similar to importing <code>CheckedItemUI</code> into <code>CheckedItemApp</code> in other languages.
</p>

<p>
However, packaging in Newspeak performed by placing some object or class on slot does more.  Apart from declaring the dependency of <code>CheckedItemApp</code> on <code>CheckedItemUI</code>, the actual class  <code>CheckedItemUI</code> will be serialized and shipped with the  <code>CheckedItemApp</code>.
</p>
</div>
</div>

<div id="outline-container-org74ed277" class="outline-5">
<h5 id="org74ed277"><span class="section-number-5">10.9.5.2</span> When the app runs in the <b>#main:args:</b> method, instantiate the <b>CheckedItemUI</b></h5>
<div class="outline-text-5" id="text-10-9-5-2">
<p>
When the <code>CheckedItemApp</code> starts (which we know is in the <code>#main:args</code> method), we need to create an instance of <code>CheckedItemUI</code>. Once we have the instance, we need to create instances of the nested model, then subject, then presenter. 
</p>

<p>
In the summary conclusion in <a href="#org42e82ed">Chapter conclusion about principles of writing rudimentary Hopscotch UI</a> we have summarized how a rudimentary Hopscotch UI should be created. Let us repeat it here:
</p>

<pre class="example" id="org661a21b">
|concreteModel concreteSubject concretePresenter|
concreteModel:: ConcreteModel new.
concreteSubject:: ConcreteSubject onModel: concreteModel.
hopscotchWindow openSubject: concreteSubject.
</pre>

<p>
So let us use this snippet in our core UI code (instead of starting names with <i>Concrete</i> start them with <i>CheckedItem</i>).
</p>

<p>
Add the "3-lines" section on the bottom of <code>#main:args:</code>, so it looks like this:
</p>

<p>
We are making this code unnecessarily verbatim and long, to spell out what we discussed:
</p>

<p>
<code>class CheckedItemApp</code>
</p>
<pre class="example" id="orga5f865b">
public main: platform args: args = (
   |
   (* WHILE WE DEDUCED HOW THIS BEHAVES IN THE IDE, THE VFUEL BEHAVIOR IS ONLY DESCRIBED HERE.
      In IDE: When main is invoked by clicking [run] or [debug] in the IDE,
        we just return platform. Because in the IDE, platform is already created
        by the IDE by 'hopscotchForHTML5Runtime using: platform' (returns PlatformWithHopscotch).
        so calling 'platform hopscotch' returns hopscotchForHTML5.

      Electron: platform behaves same as IDE platform.

      In vfuel: When main is invoked in the vfuel app, the passed platform
                does not contain hopscotch. It is constructed so that
                isKindOfPlatformWithHopscotch returns false.
                We need to re-create hopscotchForHTML5Runtime,
                by calling 'hopscotchForHTML5Runtime using: platform' (returns PlatformWithHopscotch);
                This will be same PlatformWithHopscotch as in the IDE.
   *)
   platformWithHopscotch = platform isKindOfPlatformWithHopscotch ifTrue: [platform]
                                                                  ifFalse: [hopscotchForHTML5Runtime using: platform].   

   hopscotchForHTML5 = platformWithHopscotch hopscotch.
   (* Added 1-line to instantiate CheckedItemUI from the platform - which has hopscotch available *)
   checkedItemUI = CheckedItemUI usingPlatform: platformWithHopscotch.

   (* Added 3 temporary slots to verbosely process *)
   checkedItemModel
   checkedItemSubject
   checkedItemPresenter
   |

   (* Added 3-lines to show steps very verbosely.
      The last line creates a window, instantiates a Presenter
      and it's definition fragments.
   *)
   checkedItemModel:: checkedItemUI CheckedItemModel new.
   checkedItemSubject:: checkedItemUI CheckedItemSubject onModel: checkedItemModel.
   hopscotchForHTML5 HopscotchWindow openSubject: checkedItemSubject.

   (* also removed: 'Hello World from HelloWorldApp' out. *)
 )
</pre>

<p>
Let's go over the added lines, and why they were added this way.
</p>
</div>


<div id="outline-container-org5708783" class="outline-6">
<h6 id="org5708783"><span class="section-number-6">10.9.5.2.1</span> Why did we added the line calling factory constructor of CheckedItemUI? Also, this leads to a change in CheckedItemUI.</h6>
<div class="outline-text-6" id="text-10-9-5-2-1">
<p>
So, why did we add this line to the <code>CheckedItemApp&gt;&gt;#main:args:</code> method:
</p>

<p>
<code>checkedItemUI = CheckedItemUI usingPlatform: platformWithHopscotch.</code>?
</p>

<p>
Explanation:
</p>

<ul class="org-ul">
<li>The CheckedItemApp is merely an application wrapper around the module CheckedItemUI. This is how modules are distributed and run. Our module (top level class instance) CheckedItemUI needs a factory constructor which is passed a platform object.  At runtime, instances of top level classes "import" dependencies from the <code>platform</code>.  All top level classes that are general modules need such factory constructor. It was discussed at length in the early sections, around and after section <a href="#org4ee700c">Application and library modules in Newspeak</a>.</li>

<li>So from above links, we know our CheckedItemUI will need a factory constructor such as <code>CheckedItemUI&gt;&gt;#usingPlatform: platformWithHopscotch.</code> This is what the added line expresses: It creates an instance of CheckedItemUI and stores it on a local variable.</li>

<li>Looking back to chapter <a href="#org8ea8a77">Class CheckedItemUI</a>, we did not add any slots or constructors for the top level class <code>CheckedItemUI</code> so far.  Our <code>CheckedItemUI</code> will definitely need to "import" and "hold on" classes or instances of <code>Subject</code> and <code>Presenter</code> for use in it's nested classes <code>CheckedItemSubject</code> and <code>CheckedItemPresenter</code>.</li>
</ul>

<p>
This explanation also leads to the need to beef up the <code>CheckedItemUI</code> by adding both a factory constructor and slots for classes needed by nested children.
</p>

<p>
So as discussed in the explanation, let's add the factory constructor and it's slots to <code>CheckedItemUI</code>.
</p>

<p>
Replace the <code>#new</code> constructor with the following:
</p>

<p>
<code>class CheckedItemUI</code>
</p>
<pre class="example" id="org82cb5c8">
(* Added this factory constructor and slots for Subject and Presenter *)
class CheckedItemUI usingPlatform: platformWithHopscotch = (
|
Subject   = platformWithHopscotch hopscotch Subject.
Presenter = platformWithHopscotch hopscotch Presenter.
|
)
</pre>

<p>
Also, we recall from <a href="#org5d457b0">Add the hopscotchForHTML5 module that will allow us to build UI</a> that
</p>

<p>
<code>platformWithHopscotch hopscotch</code>
</p>

<p>
returns instance of HopscotchForHTML5 which has access to the <code>Subject</code> and <code>Presenter</code> nested classes (among others).  The added code above just stores them on slots of <code>CheckedItemUI</code> with same names.
</p>

<p>
To recap, the slots are needed in the <code>CheckedItemUI</code> for use by its nested classes, the  <code>CheckedItemPresenter</code> and  <code>CheckedItemSubject</code>.  When the nested classes refer to <code>Subject</code> and <code>Presenter</code> in their code - for example in the constructor line <code>CheckedItemSubject onModel: model = Subject onModel:</code> - the <code>Subject</code> can only be found if it is on a slot of either the CheckedItemSubject or the parent CheckedItemUI. As always, all dependencies must be found somewhere in the slot scope going up.
</p>

<p>
A note: The need to put <code>Subject</code> on slot of <code>CheckedItemUI</code> rather than (for example) on the <code>CheckedItemSubject</code> is due to the fact that any element used in the constructor of <code>CheckedItemSubject</code> must be available in the scope of slots in nesting classes all the way up, when the contructor is called.
</p>

<p>
In summary, as the <code>#main:args:</code> is called, it first uses it's instance slot <code>hopscotchForHTML5Runtime</code> to create local variables <code>platformWithHopscotch</code>, <code>hopscotchForHTML5</code> (unused), and <code>checkedItemUI</code>.
</p>

<p>
The local variable <code>checkedItemUI</code> will be used to create and show the UI in the code detailed in the next chapter.
</p>
</div>
</div>


<div id="outline-container-orge9a6caa" class="outline-6">
<h6 id="orge9a6caa"><span class="section-number-6">10.9.5.2.2</span> What are the lines at the of <b>#main:args</b>?</h6>
<div class="outline-text-6" id="text-10-9-5-2-2">
<p>
This is the last step we need to discuss!
</p>

<p>
The last three lines below create the rudimentary Hopscotch UI with a window, and an instance of <code>CheckedItemPresenter</code> placed in the window. For details, see <a href="#org74ed277">When the app runs in the <b>#main:args:</b> method, instantiate the <b>CheckedItemUI</b></a> and in detail in <a href="#org42e82ed">Chapter conclusion about principles of writing rudimentary Hopscotch UI</a>.
</p>

<p>
<code>class CheckedItemApp</code>
</p>
<pre class="example" id="orgf273bb7">
(* Added 3-lines to show steps very verbosely.
   The last line creates a window, instantiates a Presenter
   and it's definition fragments.
*)
checkedItemModel:: checkedItemUI CheckedItemModel new.
checkedItemSubject:: checkedItemUI CheckedItemSubject onModel: checkedItemModel.
hopscotchForHTML5 HopscotchWindow openSubject: checkedItemSubject.
</pre>

<p>
Notice this code is at the very end of the method <code>CheckedItemApp&gt;&gt;#main:args:</code> which we know is a convention API called to run the app.  The line
</p>

<p>
<code>hopscotchForHTML5 HopscotchWindow openSubject: checkedItemSubject.</code>
</p>

<p>
is the last line of our application. In this method, Hopscotch takes over, creates the UI and starts interaction with user's input devices. 
</p>

<p>
In the last chapter, we merely summarize code for all classes we created for our App, the <code>CheckedItemApp</code>.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org7661033" class="outline-4">
<h4 id="org7661033"><span class="section-number-4">10.9.6</span> 5. Complete code and UI of the <b>CheckedItemApp</b></h4>
<div class="outline-text-4" id="text-10-9-6">
<p>
The complete code and UI of the <code>CheckedItemApp</code> can be found here:
</p>

<p>
<a href="https://github.com/mzimmerm/newspeak-doc/tree/main/newspeak---a-few-notes-code/checked-item-app">https://github.com/mzimmerm/newspeak-doc/tree/main/newspeak---a-few-notes-code/checked-item-app</a>
</p>

<p>
If you prefer not to follow all the detail steps of buiding the <code>CheckedItemApp</code>, you can just install the complete code from there.
</p>

<p>
To install the complete code to Newspeak, download the ".ns" files from there, then, from your Newspeak IDE (local or online) use the "Compile file(s)" link to import the files into your IDE. If you are not sure what that means, read the section around <a href="#org151c9f3">"Compile file(s)"</a>.
</p>

<p>
Running the app from the IDE, presents the UI we built as in this screenshot. 
</p>


<div id="org3fd1601" class="figure">
<p><img src="/img/newspeak---a-few-notes.org-checked-item-app-ui-running.png" alt="nil"/>
</p>
</div>

<p>
You can also package it and run the App as a standalone .vfuel file from the IDE, by clicking the <b>[deploy]</b> link beside the class name, then selecting "As VictoryFuel with Mirrors".
</p>


<div id="org4bc001e" class="figure">
<p><img src="/img/newspeak---a-few-notes.org-deploy-checked-item-app.png" alt="nil"/>
</p>
</div>

<p>
More details on deployment for another sample App is in the intro section around <a href="#orgd3e5383">Make deployment file for CounterApp</a>
</p>


<p>
Note: The code for the <b>CheckedItemApp</b> built here is as simple as it can be, to focus on understanding <code>HopscotchForHTML5</code>. The App should be improved in the future. The main weakness of the current version is that it exposes model publicly - model functions should be wrapped in Subject.
</p>

<p>
This concludes the chapter that explores <code>HopscotchForHTML5</code>.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org6c58fab" class="outline-2">
<h2 id="org6c58fab"><span class="section-number-2">11</span> Some of the more boring details</h2>
<div class="outline-text-2" id="text-11">
</div>
<div id="outline-container-org56fb847" class="outline-3">
<h3 id="org56fb847"><span class="section-number-3">11.1</span> HopscotchForHTML5: Analyzing senders of <b>Subject&gt;&gt;#presenter</b> and why <b>HopscotchWindow&gt;&gt;#openSubject: subject</b> should be invoked instead</h3>
<div class="outline-text-3" id="text-11-1">
<p>
Motivation: We know that <code>Subject&gt;&gt;#presenter</code> is a crucial method that creates a presenter for an existing subject, and establishes their association. We want to find the method or methods applications should invoke that eventually lead to calling <code>Subject&gt;&gt;#presenter</code>.
</p>


<p>
We know <code>Subject&gt;&gt;#presenter</code> invokes <code>Subject&gt;&gt;#createPresenter</code>. This seems a good indication that the Hopscotch framework creators wanted us to invoke <code>Subject&gt;&gt;#presenter</code> to get us from a Subject instance to a Presenter instance (the one created in <code>Subject&gt;&gt;#createPresenter</code>); the Presenter instantiated there would then present the UI. (We already discussed that it is reasonable to assume that implementations of <code>Subject&gt;&gt;#createPresenter</code> should create and return a concrete Presenter.)
</p>

<p>
But do we know whether:
</p>

<ol class="org-ol">
<li>We are supposed to invoke <code>Subject&gt;&gt;#presenter</code> directly in our application?</li>

<li>Or is the intent of Hopscotch that our application should invoke some other method and through several steps inside the Hopscotsch framework eventually call <code>Subject&gt;&gt;#presenter</code>?</li>
</ol>

<p>
Well that is a good detective story. Let us take a wild assumption that item 2 is the intended method.
</p>

<p>
There is a vague weak supporting reason for possibility 2. An App will have to create something like a Window, a Frame, or some such object into which our app will be presented. So maybe, a good place to look for a method our application should invoke (instead of <code>Subject&gt;&gt;#presenter</code>, is some kind of Window creation in HopscotchForHTML5 (where we would expect <code>Subject#presenter</code> to be invoked).
</p>

<p>
Let us investigate that direction.
</p>

<p>
A) First, let's look for senders of <code>Subject&gt;&gt;#presenter</code>, all the way up.  There are only four senders of <code>#presenter</code> in Hopscotch classes:
</p>

<ol class="org-ol">
<li><code>#enterSubject:</code> in Subject in HopscotchForHTML5</li>
<li><code>#enterSubject:</code> in HopscotchShell in HopscotchForHTML5</li>
<li><code>#refresh</code> in HopscotchShell in HopscotchForHTML5</li>
<li><code>#refreshmentPresenter</code> in Presenter in HopscotchForHTML5</li>
</ol>

<p>
The first just calls the second
</p>

<p>
<code>class Subject</code>
</p>
<pre class="example" id="orgaa128e8">
enterSubject: s = (
	(* TODO: use sendUp and open a new window if undelivered *)
	^shell enterSubject: s
)
</pre>
<p>
We can ignore the third and forth, as they have to do with refresh. That leaves us with the second, <code>HopscotchShell&gt;&gt;enterSubject:</code>. If we find who sends this message, (maybe following up a few of its senders) we should arrive at the method our application should invoke (which then would end up calling #createSubject, the method we are intrested in calling. 
</p>

<p>
B) So next, let's look for senders of <code>HopscotchShell&gt;&gt;#enterSubject: subject</code> only in Hopscotch classes, we get
</p>

<ol class="org-ol">
<li>enterSubject: in ToolbarPresenter in HopscotchWindow in HopscotchForHTML5</li>
<li>enterSubject: in Presenter in HopscotchForHTML5</li>
<li>enterSubject:fromSnippet: in EmbeddedHopscotchWindow in HopscotchForHTML5</li>
<li>find: in ToolbarPresenter in IDEWindow in Browsing</li>
<li>goHome in HopscotchShell in HopscotchForHTML5</li>
<li>homeButton in Presenter in HopscotchForHTML5</li>
<li><code>into:openSubject: in HopscotchWindow in HopscotchForHTML5</code></li>
<li>openSubject: in Window in HopscotchProxy in AppPlatform in Browsing</li>
</ol>

<p>
Now a detective story becomes more of a guessing game. But anything that is creating a Window or invoked from Window is a good guess, as any application would have to place it's Presenter into a Window or Frame or some such.
</p>

<p>
So let's look further at 7.
</p>

<p>
<code>HopscotchWindow&gt;&gt;#into: container openSubject: subject</code>
</p>

<p>
This seems to be doing something useful, it creates a toolbar, adds it to container, etc.
</p>

<p>
C) So let's look for senders of <code>HopscotchWindow&gt;&gt;#into:openSubject:</code> only in Hopscotch classes, we get
</p>


<ol class="org-ol">
<li>into:openSubject: in EmbeddedHopscotchWindow in HopscotchForHTML5</li>
<li>openSubject: in EmbeddedHopscotchWindow in HopscotchForHTML5</li>
<li>openSubject: in HopscotchWindow in HopscotchForHTML5</li>
</ol>


<p>
<code>HopscotchWindow&gt;&gt;#openSubject: subject</code>
</p>

<p>
public openSubject: s = (
	^into: body openSubject: s
)
</p>

<p>
is promising.
</p>

<p>
<code>HopscotchWindow&gt;&gt;#openSubject: subject</code> looks like may be the method that we should invoke in our app to eventually create the Presenter.
</p>

<p>
The invocations sequence would be
</p>

<p>
<code>HopscotchWindow&gt;&gt;#openSubject: subject</code> invokes -&gt;
<code>HopscotchWindow&gt;&gt;#into: container openSubject: subject</code>  invokes -&gt;
<code>HopscotchShell&gt;&gt;#enterSubject: subject</code>   invokes -&gt;
<code>Subject&gt;&gt;#presenter</code> invokes -&gt;
<code>Subject&gt;&gt;#createPresenter</code>
</p>

<p>
The last method creates and returns the presenter; which is then entered and placed to the page container (body).
</p>

<p>
<b>Conclusion: We found through some assumption, a bit of detective work through code that included guesses, that our application should not create <code>Presenter</code> directly or by calling <code>Subject&gt;&gt;#presenter</code> directly. Instead, our application should invoke</b>
</p>


<p>
<code>HopscotchWindow&gt;&gt;#openSubject: subject</code>
</p>

<p>
<b>this invocation will do the work of creating the Presenter for the Subject, and entering the presenter into the appropriate place in the container body.</b>
</p>

<p>
We will use this conclusion as a core conclusion when writing our sample Application.
</p>
</div>
</div>
</div>
